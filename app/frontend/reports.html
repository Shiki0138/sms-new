<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#f8e5e1">
    <title>レポート設定 - Salon Lumière</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/legacy/main-unified.css?v=20250907">
    <link rel="stylesheet" href="/css/mobile-navigation.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .reports-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .reports-header {
            background: linear-gradient(135deg, #f8e5e1 0%, #f4d1c7 100%);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        .report-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .filter-group label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            font-weight: 500;
        }
        .filter-group select,
        .filter-group input {
            padding: 8px 12px;
            border: 2px solid #d4a574;
            border-radius: 8px;
            outline: none;
        }
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        .report-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-left: 4px solid #d4a574;
        }
        .report-card.full-width {
            grid-column: 1 / -1;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }
        .chart-container.large {
            height: 400px;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .metric-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #d4a574;
        }
        .metric-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-top: 5px;
        }
        .metric-change {
            font-size: 12px;
            margin-top: 5px;
        }
        .metric-change.positive {
            color: #4caf50;
        }
        .metric-change.negative {
            color: #f44336;
        }
        .export-btn {
            background: #d4a574;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .export-btn:hover {
            background: #c49660;
        }
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .report-table th,
        .report-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .report-table th {
            background: #f8f9fa;
            font-weight: 500;
            color: #666;
        }
        .report-table tr:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <button class="mobile-menu-toggle" id="mobileMenuToggle">☰</button>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo-wrapper">✨</div>
            <h2 class="salon-name">Salon Lumière</h2>
            <span class="plan-badge">PREMIUM</span>
        </div>

        <nav class="nav-menu">
            <a href="/dashboard.html" class="nav-item">
                <span class="nav-icon">🏠</span>
                <span>ホーム</span>
            </a>
            <a href="/appointments.html" class="nav-item">
                <span class="nav-icon">📅</span>
                <span>予約</span>
            </a>
            <a href="/customers.html" class="nav-item">
                <span class="nav-icon">👥</span>
                <span>顧客</span>
            </a>
            <a href="/messages.html" class="nav-item">
                <span class="nav-icon">💬</span>
                <span>連絡</span>
            </a>
            <a href="/reports.html" class="nav-item active">
                <span class="nav-icon">📈</span>
                <span>売上</span>
            </a>
            <a href="/settings.html" class="nav-item">
                <span class="nav-icon">⚙️</span>
                <span>設定</span>
            </a>
        </nav>

        <div class="user-section">
            <div class="user-info">
                <div class="user-avatar">管</div>
                <div class="user-details">
                    <div class="user-name">管理者</div>
                    <div class="user-role">Administrator</div>
                </div>
            </div>
            <button class="logout-btn" id="logoutBtn">ログアウト</button>
        </div>
    </aside>

    <main class="main-content">
        <div class="reports-container">
        <div class="reports-header">
            <h1 style="color: #8b4513; margin: 0; font-size: 2.5rem; font-family: 'Playfair Display', serif;">
                📊 レポート・分析
            </h1>
            <p style="color: #666; margin: 10px 0 0; font-size: 1.1rem;">
                売上と業績の分析・レポート
            </p>
        </div>

        <div class="report-filters">
            <div class="filter-group">
                <label>期間</label>
                <select id="periodFilter">
                    <option value="today">今日</option>
                    <option value="week">今週</option>
                    <option value="month" selected>今月</option>
                    <option value="quarter">四半期</option>
                    <option value="year">今年</option>
                    <option value="custom">カスタム期間</option>
                </select>
            </div>
            <div class="filter-group" id="customDateGroup" style="display: none;">
                <label>開始日</label>
                <input type="date" id="startDate">
            </div>
            <div class="filter-group" id="customDateGroup2" style="display: none;">
                <label>終了日</label>
                <input type="date" id="endDate">
            </div>
            <div class="filter-group">
                <label>レポート種別</label>
                <select id="reportType">
                    <option value="sales">売上レポート</option>
                    <option value="services">サービス分析</option>
                    <option value="staff">スタッフ実績</option>
                    <option value="customers">顧客分析</option>
                </select>
            </div>
            <div class="filter-group">
                <label>アクション</label>
                <button class="export-btn" onclick="generateReport()">レポート生成</button>
            </div>
        </div>

        <div class="reports-grid" id="reportsGrid">
            <!-- Report cards will be loaded here -->
        </div>
        </div>
    </main>

    <script>
        // Mock data for reports
        const mockData = {
            sales: {
                totalRevenue: 2850000,
                previousRevenue: 2640000,
                totalBookings: 156,
                previousBookings: 142,
                avgBookingValue: 18269,
                previousAvgValue: 18592,
                dailySales: [
                    { date: '2025-09-01', revenue: 95000 },
                    { date: '2025-09-02', revenue: 87000 },
                    { date: '2025-09-03', revenue: 92000 },
                    { date: '2025-09-04', revenue: 110000 },
                    { date: '2025-09-05', revenue: 105000 },
                    { date: '2025-09-06', revenue: 88000 }
                ]
            },
            services: [
                { name: 'カット&カラー', bookings: 45, revenue: 1260000, avgPrice: 28000 },
                { name: 'カット', bookings: 38, revenue: 532000, avgPrice: 14000 },
                { name: 'パーマ', bookings: 25, revenue: 675000, avgPrice: 27000 },
                { name: 'トリートメント', bookings: 32, revenue: 288000, avgPrice: 9000 },
                { name: 'ヘッドスパ', bookings: 16, revenue: 128000, avgPrice: 8000 }
            ],
            staff: [
                { name: '佐藤 美香', bookings: 48, revenue: 1250000, rating: 4.9 },
                { name: '田中 涼子', bookings: 42, revenue: 980000, rating: 4.8 },
                { name: '山田 健太', bookings: 36, revenue: 720000, rating: 4.7 },
                { name: '鈴木 咲良', bookings: 20, revenue: 380000, rating: 4.5 },
                { name: '高橋 花子', bookings: 10, revenue: 120000, rating: 4.3 }
            ]
        };

        // Initialize reports page
        document.addEventListener('DOMContentLoaded', function() {
            generateReport();
            initializeFilters();
            
            // Initialize sidebar functionality
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                    sidebarOverlay.classList.toggle('active');
                    document.body.classList.toggle('sidebar-open');
                });
            }

            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', function() {
                    sidebar.classList.remove('active');
                    sidebarOverlay.classList.remove('active');
                    document.body.classList.remove('sidebar-open');
                });
            }
        });

        function initializeFilters() {
            const periodFilter = document.getElementById('periodFilter');
            periodFilter.addEventListener('change', function() {
                const customGroups = document.querySelectorAll('[id^="customDateGroup"]');
                if (this.value === 'custom') {
                    customGroups.forEach(group => group.style.display = 'flex');
                } else {
                    customGroups.forEach(group => group.style.display = 'none');
                }
                generateReport();
            });

            const reportType = document.getElementById('reportType');
            reportType.addEventListener('change', generateReport);
        }

        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const period = document.getElementById('periodFilter').value;
            
            clearReports();
            
            switch(reportType) {
                case 'sales':
                    generateSalesReport();
                    break;
                case 'services':
                    generateServicesReport();
                    break;
                case 'staff':
                    generateStaffReport();
                    break;
                case 'customers':
                    generateCustomersReport();
                    break;
            }
        }

        function clearReports() {
            document.getElementById('reportsGrid').innerHTML = '';
        }

        function generateSalesReport() {
            const grid = document.getElementById('reportsGrid');
            
            // Sales metrics
            const metricsCard = createReportCard('売上メトリクス', 'full-width');
            metricsCard.innerHTML += `
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-value">¥${(mockData.sales.totalRevenue / 1000000).toFixed(1)}M</div>
                        <div class="metric-label">総売上</div>
                        <div class="metric-change positive">+${(((mockData.sales.totalRevenue - mockData.sales.previousRevenue) / mockData.sales.previousRevenue) * 100).toFixed(1)}%</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${mockData.sales.totalBookings}</div>
                        <div class="metric-label">予約数</div>
                        <div class="metric-change positive">+${mockData.sales.totalBookings - mockData.sales.previousBookings}</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">¥${mockData.sales.avgBookingValue.toLocaleString()}</div>
                        <div class="metric-label">平均単価</div>
                        <div class="metric-change ${mockData.sales.avgBookingValue > mockData.sales.previousAvgValue ? 'positive' : 'negative'}">
                            ${mockData.sales.avgBookingValue > mockData.sales.previousAvgValue ? '+' : ''}¥${(mockData.sales.avgBookingValue - mockData.sales.previousAvgValue).toLocaleString()}
                        </div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${Math.round(mockData.sales.totalRevenue / mockData.sales.totalBookings / 1000)}K</div>
                        <div class="metric-label">客単価</div>
                        <div class="metric-change positive">+5.2%</div>
                    </div>
                </div>
            `;
            grid.appendChild(metricsCard);

            // Daily sales chart
            const chartCard = createReportCard('日別売上推移');
            chartCard.innerHTML += '<div class="chart-container"><canvas id="dailySalesChart"></canvas></div>';
            grid.appendChild(chartCard);

            // Create chart after DOM is updated
            setTimeout(() => {
                createDailySalesChart();
            }, 100);

            // Sales by time chart
            const timeChartCard = createReportCard('時間帯別売上');
            timeChartCard.innerHTML += '<div class="chart-container"><canvas id="timeSalesChart"></canvas></div>';
            grid.appendChild(timeChartCard);

            setTimeout(() => {
                createTimeSalesChart();
            }, 200);
        }

        function generateServicesReport() {
            const grid = document.getElementById('reportsGrid');
            
            // Services table
            const tableCard = createReportCard('サービス別実績', 'full-width');
            tableCard.innerHTML += `
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>サービス名</th>
                            <th>予約数</th>
                            <th>売上</th>
                            <th>平均単価</th>
                            <th>売上シェア</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${mockData.services.map(service => {
                            const totalRevenue = mockData.services.reduce((sum, s) => sum + s.revenue, 0);
                            const share = ((service.revenue / totalRevenue) * 100).toFixed(1);
                            return `
                                <tr>
                                    <td><strong>${service.name}</strong></td>
                                    <td>${service.bookings}</td>
                                    <td>¥${service.revenue.toLocaleString()}</td>
                                    <td>¥${service.avgPrice.toLocaleString()}</td>
                                    <td>${share}%</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            grid.appendChild(tableCard);

            // Services pie chart
            const chartCard = createReportCard('サービス別売上割合');
            chartCard.innerHTML += '<div class="chart-container"><canvas id="servicesPieChart"></canvas></div>';
            grid.appendChild(chartCard);

            setTimeout(() => {
                createServicesPieChart();
            }, 100);
        }

        function generateStaffReport() {
            const grid = document.getElementById('reportsGrid');
            
            // Staff performance table
            const tableCard = createReportCard('スタッフ実績', 'full-width');
            tableCard.innerHTML += `
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>スタッフ名</th>
                            <th>予約数</th>
                            <th>売上</th>
                            <th>平均評価</th>
                            <th>効率</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${mockData.staff.map(staff => {
                            const efficiency = (staff.revenue / staff.bookings / 1000).toFixed(1);
                            return `
                                <tr>
                                    <td><strong>${staff.name}</strong></td>
                                    <td>${staff.bookings}</td>
                                    <td>¥${staff.revenue.toLocaleString()}</td>
                                    <td>${staff.rating}</td>
                                    <td>¥${efficiency}K/件</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            grid.appendChild(tableCard);

            // Staff performance chart
            const chartCard = createReportCard('スタッフ別売上');
            chartCard.innerHTML += '<div class="chart-container"><canvas id="staffChart"></canvas></div>';
            grid.appendChild(chartCard);

            setTimeout(() => {
                createStaffChart();
            }, 100);
        }

        function generateCustomersReport() {
            const grid = document.getElementById('reportsGrid');
            
            // Customer metrics
            const metricsCard = createReportCard('顧客メトリクス', 'full-width');
            metricsCard.innerHTML += `
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-value">847</div>
                        <div class="metric-label">総顧客数</div>
                        <div class="metric-change positive">+12</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">23</div>
                        <div class="metric-label">新規顧客</div>
                        <div class="metric-change positive">+8</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">78%</div>
                        <div class="metric-label">リピート率</div>
                        <div class="metric-change positive">+3.2%</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">2.3</div>
                        <div class="metric-label">平均来店回数</div>
                        <div class="metric-change positive">+0.1</div>
                    </div>
                </div>
            `;
            grid.appendChild(metricsCard);

            // Customer retention chart
            const chartCard = createReportCard('顧客リテンション分析');
            chartCard.innerHTML += '<div class="chart-container"><canvas id="retentionChart"></canvas></div>';
            grid.appendChild(chartCard);

            setTimeout(() => {
                createRetentionChart();
            }, 100);
        }

        function createReportCard(title, className = '') {
            const card = document.createElement('div');
            card.className = `report-card ${className}`;
            card.innerHTML = `
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; color: #8b4513;">${title}</h3>
                    <button class="export-btn" onclick="exportReport('${title}')">エクスポート</button>
                </div>
            `;
            return card;
        }

        function createDailySalesChart() {
            const ctx = document.getElementById('dailySalesChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: mockData.sales.dailySales.map(d => new Date(d.date).toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' })),
                    datasets: [{
                        label: '日別売上',
                        data: mockData.sales.dailySales.map(d => d.revenue),
                        borderColor: '#d4a574',
                        backgroundColor: 'rgba(212, 165, 116, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '¥' + (value / 1000) + 'K';
                                }
                            }
                        }
                    }
                }
            });
        }

        function createTimeSalesChart() {
            const ctx = document.getElementById('timeSalesChart');
            if (!ctx) return;

            const timeData = [
                { time: '9:00', sales: 45000 },
                { time: '10:00', sales: 67000 },
                { time: '11:00', sales: 89000 },
                { time: '12:00', sales: 54000 },
                { time: '13:00', sales: 78000 },
                { time: '14:00', sales: 92000 },
                { time: '15:00', sales: 103000 },
                { time: '16:00', sales: 87000 },
                { time: '17:00', sales: 72000 },
                { time: '18:00', sales: 38000 }
            ];

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: timeData.map(d => d.time),
                    datasets: [{
                        label: '時間帯別売上',
                        data: timeData.map(d => d.sales),
                        backgroundColor: '#d4a574',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '¥' + (value / 1000) + 'K';
                                }
                            }
                        }
                    }
                }
            });
        }

        function createServicesPieChart() {
            const ctx = document.getElementById('servicesPieChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: mockData.services.map(s => s.name),
                    datasets: [{
                        data: mockData.services.map(s => s.revenue),
                        backgroundColor: [
                            '#d4a574',
                            '#c49660',
                            '#b8874d',
                            '#a67b42',
                            '#946f37'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createStaffChart() {
            const ctx = document.getElementById('staffChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: mockData.staff.map(s => s.name.split(' ')[0]),
                    datasets: [{
                        label: '売上',
                        data: mockData.staff.map(s => s.revenue),
                        backgroundColor: '#d4a574',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '¥' + (value / 1000000).toFixed(1) + 'M';
                                }
                            }
                        }
                    }
                }
            });
        }

        function createRetentionChart() {
            const ctx = document.getElementById('retentionChart');
            if (!ctx) return;

            const retentionData = [100, 85, 72, 65, 58, 54, 50, 47, 44, 42, 40, 38];
            const months = ['1ヶ月', '2ヶ月', '3ヶ月', '4ヶ月', '5ヶ月', '6ヶ月', '7ヶ月', '8ヶ月', '9ヶ月', '10ヶ月', '11ヶ月', '12ヶ月'];

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'リテンション率',
                        data: retentionData,
                        borderColor: '#d4a574',
                        backgroundColor: 'rgba(212, 165, 116, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function exportReport(title) {
            alert(`${title}のエクスポート機能 - 実装予定\n\nエクスポート可能な形式:\n- PDF\n- Excel\n- CSV`);
        }
    </script>
</body>
</html>