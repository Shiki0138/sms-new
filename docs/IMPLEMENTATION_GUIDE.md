# SMS ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ã‚¬ã‚¤ãƒ‰ - ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—

## ğŸ¯ ã“ã®ã‚¬ã‚¤ãƒ‰ã®ç›®çš„

ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ã€SMSã‚·ã‚¹ãƒ†ãƒ ã‚’æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚¼ãƒ­ã‹ã‚‰æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®å®Œå…¨ãªå®Ÿè£…æ‰‹é †ã‚’æä¾›ã—ã¾ã™ã€‚å„ã‚¹ãƒ†ãƒƒãƒ—ã«ã¯å…·ä½“çš„ãªã‚³ãƒãƒ³ãƒ‰ã¨ã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

---

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–ï¼ˆ30åˆ†ï¼‰
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
- [ ] package.jsonã®åˆæœŸåŒ–
- [ ] åŸºæœ¬çš„ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®ä½œæˆ
- [ ] ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### Phase 2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆ2æ™‚é–“ï¼‰
- [ ] Express.jsã‚µãƒ¼ãƒãƒ¼ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…
- [ ] APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ä½œæˆ
- [ ] ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™

### Phase 3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆ3æ™‚é–“ï¼‰
- [ ] HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä½œæˆ
- [ ] SPAãƒ«ãƒ¼ã‚¿ãƒ¼ã®å®Ÿè£…
- [ ] APIé€šä¿¡ã®å®Ÿè£…
- [ ] UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

### Phase 4: çµ±åˆã¨ãƒ†ã‚¹ãƒˆï¼ˆ1æ™‚é–“ï¼‰
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®æ¥ç¶š
- [ ] èªè¨¼ãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
- [ ] CRUDæ“ä½œã®ãƒ†ã‚¹ãƒˆ

### Phase 5: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆï¼ˆ30åˆ†ï¼‰
- [ ] Vercelè¨­å®š
- [ ] ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
- [ ] ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ

---

## ğŸš€ Phase 1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–

### Step 1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
mkdir sms-salon-system
cd sms-salon-system

# Gitãƒªãƒã‚¸ãƒˆãƒªã®åˆæœŸåŒ–
git init
echo "node_modules/\n.env\n.env.local\n.DS_Store" > .gitignore
```

### Step 2: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®ä½œæˆ

```bash
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ä¸€æ‹¬ä½œæˆ
mkdir -p api src/frontend src/backend public docs scripts

# å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¿ãƒƒãƒ
touch api/index.js api/package.json
touch src/frontend/index.html src/frontend/app.js src/frontend/auth.html
touch src/backend/server.js src/backend/package.json
touch index.html vercel.json package.json
```

### Step 3: ãƒ¡ã‚¤ãƒ³package.jsonã®ä½œæˆ

```json
{
  "name": "sms-salon-management",
  "version": "1.0.0",
  "description": "Salon Management System",
  "main": "api/index.js",
  "scripts": {
    "dev": "cd src/backend && node server.js",
    "dev:frontend": "cd src/frontend && node server.cjs",
    "build": "npm run build:frontend",
    "build:frontend": "mkdir -p public && cp index.html public/ && cp src/frontend/app.prod.js public/app.js",
    "vercel-build": "npm run build",
    "start": "node api/index.js",
    "test": "echo \"No tests configured\""
  },
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "jsonwebtoken": "^9.0.2",
    "bcryptjs": "^2.4.3"
  },
  "devDependencies": {
    "nodemon": "^3.0.0"
  },
  "engines": {
    "node": ">=14.0.0"
  }
}
```

### Step 4: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¾å­˜é–¢ä¿‚
npm install

# APIç”¨ã®ä¾å­˜é–¢ä¿‚
cd api
echo '{
  "name": "sms-api",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "jsonwebtoken": "^9.0.2",
    "bcryptjs": "^2.4.3"
  }
}' > package.json
npm install

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºç”¨ã®ä¾å­˜é–¢ä¿‚
cd ../src/backend
echo '{
  "name": "sms-backend-dev",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "jsonwebtoken": "^9.0.2",
    "bcryptjs": "^2.4.3"
  }
}' > package.json
npm install

cd ../..
```

---

## ğŸ’» Phase 2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…

### Step 1: ãƒ¡ã‚¤ãƒ³APIã‚µãƒ¼ãƒãƒ¼ (api/index.js)

```javascript
const express = require('express');
const cors = require('cors');
const jwt = require('jsonwebtoken');
const bcrypt = require('bcryptjs');

const app = express();

// CORSè¨­å®š
app.use(cors({
  origin: process.env.NODE_ENV === 'production' 
    ? ['https://sms-new.vercel.app']
    : ['http://localhost:3000', 'http://localhost:3001'],
  credentials: true
}));

app.use(express.json());

// JWT Secret
const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-change-in-production';

// ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
const db = {
  users: [
    {
      id: 1,
      email: 'admin@salon.com',
      password: '$2a$10$kFVBZMghl0Y4dGz1ktSjXOmGawrEj3SJZQqcXKxOvvGzFBKu1Qjmq', // admin123
      name: 'ç®¡ç†è€…',
      role: 'admin'
    }
  ],
  customers: [],
  appointments: [],
  staff: []
};

// ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆé–¢æ•°
function generateMockCustomers(count) {
  const customers = [];
  const statuses = ['VIP', 'å¸¸é€£', 'æ–°è¦', 'ä¼‘çœ '];
  const names = ['å±±ç”°å¤ªéƒ', 'éˆ´æœ¨èŠ±å­', 'ç”°ä¸­ä¸€éƒ', 'ä½è—¤ç¾å’²', 'ä¼Šè—¤å¥å¤ª'];
  
  for (let i = 1; i <= count; i++) {
    customers.push({
      id: i,
      name: names[Math.floor(Math.random() * names.length)] + i,
      phone: `090-${Math.floor(1000 + Math.random() * 9000)}-${Math.floor(1000 + Math.random() * 9000)}`,
      email: `customer${i}@example.com`,
      lastVisit: new Date(Date.now() - Math.random() * 90 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
      visitCount: Math.floor(Math.random() * 50) + 1,
      status: statuses[Math.floor(Math.random() * statuses.length)],
      notes: 'ãŠå®¢æ§˜ã®ãƒ¡ãƒ¢æƒ…å ±',
      createdAt: new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000).toISOString()
    });
  }
  return customers;
}

function generateMockAppointments(count) {
  const appointments = [];
  const services = ['ã‚«ãƒƒãƒˆ', 'ã‚«ãƒ©ãƒ¼', 'ãƒ‘ãƒ¼ãƒ', 'ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ', 'ã‚«ãƒƒãƒˆãƒ»ã‚«ãƒ©ãƒ¼'];
  const times = ['10:00', '11:00', '14:00', '15:00', '16:00'];
  
  for (let i = 1; i <= count; i++) {
    appointments.push({
      id: i,
      customerId: Math.floor(Math.random() * 45) + 1,
      customerName: `é¡§å®¢${Math.floor(Math.random() * 45) + 1}`,
      date: new Date().toISOString().split('T')[0],
      time: times[Math.floor(Math.random() * times.length)],
      service: services[Math.floor(Math.random() * services.length)],
      staffId: Math.floor(Math.random() * 6) + 1,
      staffName: `ã‚¹ã‚¿ãƒƒãƒ•${Math.floor(Math.random() * 6) + 1}`,
      status: Math.random() > 0.2 ? 'ç¢ºå®š' : 'æœªç¢ºå®š',
      createdAt: new Date().toISOString()
    });
  }
  return appointments;
}

function generateMockStaff(count) {
  const staff = [];
  const roles = ['ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ', 'ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ', 'ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼'];
  const statuses = ['å‹¤å‹™ä¸­', 'å¾…æ©Ÿä¸­', 'ä¼‘æ†©ä¸­', 'é€€å‹¤'];
  
  for (let i = 1; i <= count; i++) {
    staff.push({
      id: i,
      name: `ã‚¹ã‚¿ãƒƒãƒ•${i}`,
      role: roles[Math.floor(Math.random() * roles.length)],
      status: statuses[Math.floor(Math.random() * statuses.length)],
      skills: ['ã‚«ãƒƒãƒˆ', 'ã‚«ãƒ©ãƒ¼', 'ãƒ‘ãƒ¼ãƒ'].slice(0, Math.floor(Math.random() * 3) + 1),
      rating: (Math.random() * 2 + 3).toFixed(1)
    });
  }
  return staff;
}

// ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–
db.customers = generateMockCustomers(45);
db.appointments = generateMockAppointments(8);
db.staff = generateMockStaff(6);

// èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
const authenticateToken = (req, res, next) => {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];

  if (!token) {
    return res.status(401).json({ error: 'Access token required' });
  }

  jwt.verify(token, JWT_SECRET, (err, user) => {
    if (err) {
      return res.status(403).json({ error: 'Invalid token' });
    }
    req.user = user;
    next();
  });
};

// ============ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ============

// ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
app.get('/api/health', (req, res) => {
  res.json({ 
    status: 'ok', 
    timestamp: new Date().toISOString(),
    version: '1.0.0'
  });
});

// ãƒ­ã‚°ã‚¤ãƒ³
app.post('/api/auth/login', async (req, res) => {
  try {
    const { email, password } = req.body;
    
    const user = db.users.find(u => u.email === email);
    if (!user) {
      return res.status(401).json({ error: 'Invalid credentials' });
    }
    
    const validPassword = await bcrypt.compare(password, user.password);
    if (!validPassword) {
      return res.status(401).json({ error: 'Invalid credentials' });
    }
    
    const token = jwt.sign(
      { id: user.id, email: user.email, role: user.role },
      JWT_SECRET,
      { expiresIn: '7d' }
    );
    
    const userResponse = { ...user };
    delete userResponse.password;
    
    res.json({ token, user: userResponse });
  } catch (error) {
    console.error('Login error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});

// ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰çµ±è¨ˆ
app.get('/api/dashboard/stats', authenticateToken, (req, res) => {
  try {
    const today = new Date().toISOString().split('T')[0];
    const todayAppointments = db.appointments.filter(a => a.date === today);
    const activeStaff = db.staff.filter(s => s.status === 'å‹¤å‹™ä¸­');
    
    res.json({
      totalCustomers: db.customers.length,
      todayAppointments: todayAppointments.length,
      monthlyRevenue: 285000,
      activeStaff: activeStaff.length,
      todaySchedule: todayAppointments.slice(0, 5),
      staffStatus: db.staff.slice(0, 5)
    });
  } catch (error) {
    console.error('Dashboard stats error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});

// é¡§å®¢ä¸€è¦§
app.get('/api/customers', authenticateToken, (req, res) => {
  try {
    const { search, status, page = 1, limit = 10 } = req.query;
    
    let filteredCustomers = [...db.customers];
    
    if (search) {
      filteredCustomers = filteredCustomers.filter(c => 
        c.name.includes(search) || c.phone.includes(search)
      );
    }
    
    if (status) {
      filteredCustomers = filteredCustomers.filter(c => c.status === status);
    }
    
    const total = filteredCustomers.length;
    const totalPages = Math.ceil(total / limit);
    const offset = (page - 1) * limit;
    const customers = filteredCustomers.slice(offset, offset + limit);
    
    res.json({
      customers,
      total,
      page: parseInt(page),
      totalPages
    });
  } catch (error) {
    console.error('Customers error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});

// é¡§å®¢è©³ç´°
app.get('/api/customers/:id', authenticateToken, (req, res) => {
  try {
    const id = parseInt(req.params.id);
    const customer = db.customers.find(c => c.id === id);
    
    if (!customer) {
      return res.status(404).json({ error: 'Customer not found' });
    }
    
    res.json(customer);
  } catch (error) {
    console.error('Customer detail error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});

// é¡§å®¢ä½œæˆ
app.post('/api/customers', authenticateToken, (req, res) => {
  try {
    const newCustomer = {
      id: db.customers.length + 1,
      ...req.body,
      visitCount: 0,
      status: 'æ–°è¦',
      createdAt: new Date().toISOString()
    };
    
    db.customers.push(newCustomer);
    res.status(201).json(newCustomer);
  } catch (error) {
    console.error('Create customer error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});

// é¡§å®¢æ›´æ–°
app.put('/api/customers/:id', authenticateToken, (req, res) => {
  try {
    const id = parseInt(req.params.id);
    const index = db.customers.findIndex(c => c.id === id);
    
    if (index === -1) {
      return res.status(404).json({ error: 'Customer not found' });
    }
    
    db.customers[index] = { ...db.customers[index], ...req.body };
    res.json(db.customers[index]);
  } catch (error) {
    console.error('Update customer error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});

// é¡§å®¢å‰Šé™¤
app.delete('/api/customers/:id', authenticateToken, (req, res) => {
  try {
    const id = parseInt(req.params.id);
    const index = db.customers.findIndex(c => c.id === id);
    
    if (index === -1) {
      return res.status(404).json({ error: 'Customer not found' });
    }
    
    db.customers.splice(index, 1);
    res.json({ message: 'Customer deleted successfully' });
  } catch (error) {
    console.error('Delete customer error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});

// äºˆç´„ä¸€è¦§
app.get('/api/appointments', authenticateToken, (req, res) => {
  try {
    const { date, staffId, status } = req.query;
    let filteredAppointments = [...db.appointments];
    
    if (date) {
      filteredAppointments = filteredAppointments.filter(a => a.date === date);
    }
    
    if (staffId) {
      filteredAppointments = filteredAppointments.filter(a => a.staffId === parseInt(staffId));
    }
    
    if (status) {
      filteredAppointments = filteredAppointments.filter(a => a.status === status);
    }
    
    res.json({
      appointments: filteredAppointments,
      total: filteredAppointments.length
    });
  } catch (error) {
    console.error('Appointments error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});

// ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§
app.get('/api/staff', authenticateToken, (req, res) => {
  try {
    res.json({
      staff: db.staff,
      total: db.staff.length
    });
  } catch (error) {
    console.error('Staff error:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});

// ãƒ«ãƒ¼ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
app.get('/api', (req, res) => {
  res.json({
    message: 'SMS API Server',
    version: '1.0.0',
    endpoints: [
      'POST /api/auth/login',
      'GET /api/dashboard/stats',
      'GET /api/customers',
      'GET /api/appointments',
      'GET /api/staff'
    ]
  });
});

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(500).json({ error: 'Something went wrong!' });
});

// Vercelç”¨ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
module.exports = app;

// ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨
if (require.main === module) {
  const PORT = process.env.PORT || 5001;
  app.listen(PORT, () => {
    console.log(`API Server running on port ${PORT}`);
  });
}
```

### Step 2: é–‹ç™ºç”¨ã‚µãƒ¼ãƒãƒ¼ (src/backend/server.js)

```javascript
const express = require('express');
const cors = require('cors');
const jwt = require('jsonwebtoken');
const bcrypt = require('bcryptjs');

const app = express();
const PORT = process.env.PORT || 5001;

// CORSè¨­å®šï¼ˆé–‹ç™ºç”¨ï¼‰
app.use(cors({
  origin: ['http://localhost:3000', 'http://localhost:3001'],
  credentials: true
}));

app.use(express.json());

// JWT Secret
const JWT_SECRET = process.env.JWT_SECRET || 'dev-secret-key';

// ä»¥ä¸‹ã€api/index.jsã¨åŒã˜ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
// ï¼ˆé‡è¤‡ã‚’é¿ã‘ã‚‹ãŸã‚ã€å®Ÿéš›ã®å®Ÿè£…ã§ã¯å…±é€šåŒ–ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ï¼‰

// ... åŒã˜APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ ...

app.listen(PORT, () => {
  console.log(`Development API Server running on http://localhost:${PORT}`);
  console.log('Available endpoints:');
  console.log('- POST /api/auth/login');
  console.log('- GET /api/dashboard/stats');
  console.log('- GET /api/customers');
  console.log('- GET /api/appointments');
  console.log('- GET /api/staff');
});
```

---

## ğŸ¨ Phase 3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

### Step 1: ãƒ¡ã‚¤ãƒ³HTML (index.html)

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>SMS - ã‚µãƒ­ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav class="bg-white shadow-lg" id="nav">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-xl font-semibold">SMS - ã‚µãƒ­ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </span>
                </div>
                <div class="flex items-center space-x-4" id="navMenu">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </nav>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div id="app" class="container mx-auto px-4 py-8">
        <!-- SPAã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    </div>

    <script src="app.js"></script>
</body>
</html>
```

### Step 2: JavaScriptã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (src/frontend/app.js)

```javascript
// SMS Frontend Application
class SMSApp {
    constructor() {
        // APIè¨­å®š
        this.apiUrl = window.location.hostname === 'localhost' 
            ? 'http://localhost:5001/api' 
            : '/api';
        
        this.currentUser = null;
        this.token = localStorage.getItem('sms_token');
        this.init();
    }

    init() {
        this.setupRouter();
        this.setupNavigation();
        this.checkAuth();
        
        // ãƒ–ãƒ©ã‚¦ã‚¶ã®æˆ»ã‚‹/é€²ã‚€ãƒœã‚¿ãƒ³å¯¾å¿œ
        window.addEventListener('popstate', () => this.setupRouter());
    }

    setupNavigation() {
        const navMenu = document.getElementById('navMenu');
        if (!navMenu) return;

        if (this.token) {
            navMenu.innerHTML = `
                <a href="/" class="text-gray-700 hover:text-gray-900">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
                <a href="/customers" class="text-gray-700 hover:text-gray-900">é¡§å®¢ç®¡ç†</a>
                <a href="/appointments" class="text-gray-700 hover:text-gray-900">äºˆç´„ç®¡ç†</a>
                <a href="/staff" class="text-gray-700 hover:text-gray-900">ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†</a>
                <button onclick="app.logout()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                </button>
            `;
        } else {
            navMenu.innerHTML = '';
        }
    }

    setupRouter() {
        const path = window.location.pathname;
        const app = document.getElementById('app');

        // èªè¨¼ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸ã‹ãƒã‚§ãƒƒã‚¯
        const publicPaths = ['/login', '/auth'];
        if (!this.token && !publicPaths.includes(path)) {
            window.location.href = '/login';
            return;
        }

        switch(path) {
            case '/':
                this.renderDashboard();
                break;
            case '/customers':
                this.renderCustomers();
                break;
            case '/appointments':
                this.renderAppointments();
                break;
            case '/staff':
                this.renderStaff();
                break;
            case '/login':
                this.renderLogin();
                break;
            default:
                this.render404();
        }
    }

    async checkAuth() {
        if (!this.token) return;

        try {
            const response = await fetch(`${this.apiUrl}/dashboard/stats`, {
                headers: {
                    'Authorization': `Bearer ${this.token}`
                }
            });
            
            if (!response.ok) {
                this.logout();
            }
        } catch (error) {
            console.error('Auth check failed:', error);
        }
    }

    async apiCall(endpoint, options = {}) {
        const defaultOptions = {
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${this.token}`
            }
        };

        try {
            const response = await fetch(`${this.apiUrl}${endpoint}`, {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...options.headers
                }
            });

            if (!response.ok) {
                if (response.status === 401) {
                    this.logout();
                }
                throw new Error(`API call failed: ${response.statusText}`);
            }

            return response.json();
        } catch (error) {
            console.error('API Error:', error);
            throw error;
        }
    }

    // ============ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•° ============

    async renderDashboard() {
        const app = document.getElementById('app');
        app.innerHTML = this.renderLoading();

        try {
            const stats = await this.apiCall('/dashboard/stats');
            
            app.innerHTML = `
            <div class="space-y-6">
                <h1 class="text-2xl font-semibold">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
                
                <!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    ${this.renderStatCard('ç·é¡§å®¢æ•°', stats.totalCustomers, 'users', 'blue')}
                    ${this.renderStatCard('ä»Šæ—¥ã®äºˆç´„', stats.todayAppointments, 'calendar-check', 'green')}
                    ${this.renderStatCard('ä»Šæœˆã®å£²ä¸Š', `Â¥${stats.monthlyRevenue.toLocaleString()}`, 'yen-sign', 'yellow')}
                    ${this.renderStatCard('ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ã‚¿ãƒƒãƒ•', stats.activeStaff, 'user-tie', 'purple')}
                </div>

                <!-- ä»Šæ—¥ã®äºˆå®šã¨ã‚¹ã‚¿ãƒƒãƒ•çŠ¶æ³ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    ${this.renderTodaySchedule(stats.todaySchedule)}
                    ${this.renderStaffStatus(stats.staffStatus)}
                </div>
            </div>
            `;
        } catch (error) {
            app.innerHTML = this.renderError('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }
    }

    async renderCustomers() {
        const app = document.getElementById('app');
        app.innerHTML = this.renderLoading();

        try {
            const params = new URLSearchParams(window.location.search);
            const page = params.get('page') || 1;
            
            const data = await this.apiCall(`/customers?page=${page}`);
            
            app.innerHTML = `
            <div class="space-y-6">
                <div class="bg-white rounded-lg shadow">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h1 class="text-2xl font-semibold">é¡§å®¢ç®¡ç†</h1>
                            <button onclick="app.showAddCustomerModal()" 
                                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                                <i class="fas fa-plus mr-2"></i>æ–°è¦é¡§å®¢ç™»éŒ²
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
                        <div class="flex gap-4 mb-6">
                            <input type="text" 
                                   id="customerSearch"
                                   placeholder="é¡§å®¢åã¾ãŸã¯é›»è©±ç•ªå·ã§æ¤œç´¢..." 
                                   class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                   onkeyup="app.searchCustomers(event)">
                            <select id="statusFilter" 
                                    onchange="app.filterCustomers()"
                                    class="px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                                <option value="">å…¨ã¦ã®é¡§å®¢</option>
                                <option value="VIP">VIPé¡§å®¢</option>
                                <option value="å¸¸é€£">å¸¸é€£é¡§å®¢</option>
                                <option value="æ–°è¦">æ–°è¦é¡§å®¢</option>
                                <option value="ä¼‘çœ ">ä¼‘çœ é¡§å®¢</option>
                            </select>
                        </div>

                        <!-- é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ« -->
                        ${this.renderCustomersTable(data.customers)}

                        <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
                        ${this.renderPagination(data)}
                    </div>
                </div>
            </div>
            `;
        } catch (error) {
            app.innerHTML = this.renderError('é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }
    }

    renderAppointments() {
        const app = document.getElementById('app');
        app.innerHTML = `
            <div class="bg-white rounded-lg shadow p-6">
                <h1 class="text-2xl font-semibold mb-6">äºˆç´„ç®¡ç†</h1>
                <div class="text-center py-12">
                    <i class="fas fa-calendar-alt text-6xl text-gray-300 mb-4"></i>
                    <p class="text-gray-600">äºˆç´„ç®¡ç†æ©Ÿèƒ½ã¯ç¾åœ¨é–‹ç™ºä¸­ã§ã™ã€‚</p>
                </div>
            </div>
        `;
    }

    renderStaff() {
        const app = document.getElementById('app');
        app.innerHTML = `
            <div class="bg-white rounded-lg shadow p-6">
                <h1 class="text-2xl font-semibold mb-6">ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†</h1>
                <div class="text-center py-12">
                    <i class="fas fa-users text-6xl text-gray-300 mb-4"></i>
                    <p class="text-gray-600">ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†æ©Ÿèƒ½ã¯ç¾åœ¨é–‹ç™ºä¸­ã§ã™ã€‚</p>
                </div>
            </div>
        `;
    }

    renderLogin() {
        const app = document.getElementById('app');
        const nav = document.getElementById('nav');
        if (nav) nav.style.display = 'none';

        app.innerHTML = `
            <div class="min-h-screen flex items-center justify-center -mt-16">
                <div class="bg-white p-8 rounded-lg shadow-lg w-96">
                    <h2 class="text-2xl font-semibold text-center mb-6">SMS ãƒ­ã‚°ã‚¤ãƒ³</h2>
                    
                    <!-- ãƒ‡ãƒ¢æƒ…å ± -->
                    <div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-4">
                        <p class="text-sm font-bold">ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ï¼š</p>
                        <p class="text-sm mt-1">Email: <span class="font-mono">admin@salon.com</span></p>
                        <p class="text-sm">Password: <span class="font-mono">admin123</span></p>
                    </div>

                    <form onsubmit="app.handleLogin(event)">
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
                            </label>
                            <input type="email" id="email" required 
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" 
                                placeholder="admin@salon.com"
                                value="admin@salon.com">
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
                            </label>
                            <input type="password" id="password" required 
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" 
                                placeholder="admin123"
                                value="admin123">
                        </div>
                        
                        <div id="loginError" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"></div>
                        
                        <button type="submit" 
                                class="w-full bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-200">
                            ãƒ­ã‚°ã‚¤ãƒ³
                        </button>
                    </form>

                    <div class="mt-6 text-center text-sm text-gray-600">
                        <p>â€» ã“ã‚Œã¯ãƒ‡ãƒ¢ã‚·ã‚¹ãƒ†ãƒ ã§ã™</p>
                    </div>
                </div>
            </div>
        `;
    }

    render404() {
        const app = document.getElementById('app');
        app.innerHTML = `
            <div class="text-center py-20">
                <h1 class="text-6xl font-bold text-gray-300 mb-4">404</h1>
                <p class="text-xl text-gray-600 mb-8">ãƒšãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>
                <a href="/" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600">
                    ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
                </a>
            </div>
        `;
    }

    // ============ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ============

    renderLoading() {
        return `
            <div class="flex justify-center items-center py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
            </div>
        `;
    }

    renderError(message) {
        return `
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                <i class="fas fa-exclamation-circle mr-2"></i>${message}
            </div>
        `;
    }

    renderStatCard(title, value, icon, color) {
        const colors = {
            blue: 'bg-blue-100 text-blue-500',
            green: 'bg-green-100 text-green-500',
            yellow: 'bg-yellow-100 text-yellow-500',
            purple: 'bg-purple-100 text-purple-500'
        };

        return `
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-3 ${colors[color]} rounded-full">
                        <i class="fas fa-${icon} text-2xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-500 text-sm">${title}</p>
                        <p class="text-2xl font-semibold">${value}</p>
                    </div>
                </div>
            </div>
        `;
    }

    renderTodaySchedule(schedule) {
        return `
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold mb-4">æœ¬æ—¥ã®äºˆç´„</h2>
                <div class="space-y-3">
                    ${schedule.length > 0 ? schedule.map(apt => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                        <div>
                            <p class="font-medium">${apt.customerName}</p>
                            <p class="text-sm text-gray-500">${apt.time} - ${apt.service}</p>
                        </div>
                        <span class="text-sm ${apt.status === 'ç¢ºå®š' 
                            ? 'bg-green-100 text-green-700' 
                            : 'bg-yellow-100 text-yellow-700'} px-2 py-1 rounded">
                            ${apt.status}
                        </span>
                    </div>
                    `).join('') : '<p class="text-gray-500">æœ¬æ—¥ã®äºˆç´„ã¯ã‚ã‚Šã¾ã›ã‚“</p>'}
                </div>
            </div>
        `;
    }

    renderStaffStatus(staffStatus) {
        return `
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold mb-4">ã‚¹ã‚¿ãƒƒãƒ•ç¨¼åƒçŠ¶æ³</h2>
                <div class="space-y-3">
                    ${staffStatus.map(staff => `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(staff.name)}" 
                                 class="w-10 h-10 rounded-full mr-3">
                            <div>
                                <p class="font-medium">${staff.name}</p>
                                <p class="text-sm text-gray-500">${staff.role}</p>
                            </div>
                        </div>
                        <span class="text-sm ${staff.status === 'å‹¤å‹™ä¸­' 
                            ? 'bg-green-100 text-green-700' 
                            : 'bg-gray-100 text-gray-700'} px-2 py-1 rounded">
                            ${staff.status}
                        </span>
                    </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    renderCustomersTable(customers) {
        return `
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                        <tr class="border-b bg-gray-50">
                            <th class="text-left py-3 px-4 font-semibold">é¡§å®¢å</th>
                            <th class="text-left py-3 px-4 font-semibold">é›»è©±ç•ªå·</th>
                            <th class="text-left py-3 px-4 font-semibold">æœ€çµ‚æ¥åº—æ—¥</th>
                            <th class="text-left py-3 px-4 font-semibold">æ¥åº—å›æ•°</th>
                            <th class="text-left py-3 px-4 font-semibold">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                            <th class="text-left py-3 px-4 font-semibold">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${customers.map(customer => `
                        <tr class="border-b hover:bg-gray-50 transition duration-150">
                            <td class="py-3 px-4">
                                <div class="flex items-center">
                                    <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(customer.name)}" 
                                         class="w-8 h-8 rounded-full mr-3">
                                    <span>${customer.name}</span>
                                </div>
                            </td>
                            <td class="py-3 px-4">${customer.phone}</td>
                            <td class="py-3 px-4">${customer.lastVisit}</td>
                            <td class="py-3 px-4">${customer.visitCount}å›</td>
                            <td class="py-3 px-4">
                                <span class="text-sm ${this.getStatusColor(customer.status)} px-2 py-1 rounded">
                                    ${customer.status}
                                </span>
                            </td>
                            <td class="py-3 px-4">
                                <button onclick="app.editCustomer(${customer.id})" 
                                        class="text-blue-500 hover:text-blue-700 mr-2">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="app.deleteCustomer(${customer.id})" 
                                        class="text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
    }

    renderPagination(data) {
        if (data.totalPages <= 1) return '';

        const pages = [];
        const currentPage = data.page;
        const totalPages = data.totalPages;

        // ãƒšãƒ¼ã‚¸ç•ªå·ã®ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
        if (totalPages <= 7) {
            for (let i = 1; i <= totalPages; i++) {
                pages.push(i);
            }
        } else {
            if (currentPage <= 3) {
                pages.push(1, 2, 3, 4, '...', totalPages);
            } else if (currentPage >= totalPages - 2) {
                pages.push(1, '...', totalPages - 3, totalPages - 2, totalPages - 1, totalPages);
            } else {
                pages.push(1, '...', currentPage - 1, currentPage, currentPage + 1, '...', totalPages);
            }
        }

        return `
            <div class="flex justify-between items-center mt-6">
                <p class="text-gray-600">
                    å…¨${data.total}ä»¶ä¸­ ${((currentPage - 1) * 10) + 1}-${Math.min(currentPage * 10, data.total)}ä»¶ã‚’è¡¨ç¤º
                </p>
                <div class="flex gap-2">
                    ${currentPage > 1 ? `
                        <button onclick="app.changePage(${currentPage - 1})" 
                                class="px-3 py-1 border rounded hover:bg-gray-100">
                            å‰ã¸
                        </button>
                    ` : ''}
                    
                    ${pages.map(page => {
                        if (page === '...') {
                            return '<span class="px-3 py-1">...</span>';
                        }
                        return `
                            <button onclick="app.changePage(${page})" 
                                    class="px-3 py-1 ${page === currentPage 
                                        ? 'bg-blue-500 text-white' 
                                        : 'border hover:bg-gray-100'} rounded">
                                ${page}
                            </button>
                        `;
                    }).join('')}
                    
                    ${currentPage < totalPages ? `
                        <button onclick="app.changePage(${currentPage + 1})" 
                                class="px-3 py-1 border rounded hover:bg-gray-100">
                            æ¬¡ã¸
                        </button>
                    ` : ''}
                </div>
            </div>
        `;
    }

    getStatusColor(status) {
        const colors = {
            'VIP': 'bg-purple-100 text-purple-700',
            'å¸¸é€£': 'bg-blue-100 text-blue-700',
            'æ–°è¦': 'bg-green-100 text-green-700',
            'ä¼‘çœ ': 'bg-gray-100 text-gray-700'
        };
        return colors[status] || 'bg-gray-100 text-gray-700';
    }

    // ============ ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ ============

    async handleLogin(event) {
        event.preventDefault();
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const errorDiv = document.getElementById('loginError');
        
        errorDiv.classList.add('hidden');
        
        try {
            const response = await fetch(`${this.apiUrl}/auth/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, password })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.error || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
            
            localStorage.setItem('sms_token', data.token);
            localStorage.setItem('sms_user', JSON.stringify(data.user));
            this.token = data.token;
            this.currentUser = data.user;
            
            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            const nav = document.getElementById('nav');
            if (nav) nav.style.display = 'block';
            
            window.location.href = '/';
        } catch (error) {
            errorDiv.textContent = error.message;
            errorDiv.classList.remove('hidden');
        }
    }

    logout() {
        localStorage.removeItem('sms_token');
        localStorage.removeItem('sms_user');
        this.token = null;
        this.currentUser = null;
        window.location.href = '/login';
    }

    changePage(page) {
        const url = new URL(window.location);
        url.searchParams.set('page', page);
        window.history.pushState({}, '', url);
        this.renderCustomers();
    }

    async searchCustomers(event) {
        if (event.key === 'Enter') {
            const search = event.target.value;
            const url = new URL(window.location);
            url.searchParams.set('search', search);
            url.searchParams.set('page', 1);
            window.history.pushState({}, '', url);
            this.renderCustomers();
        }
    }

    async filterCustomers() {
        const status = document.getElementById('statusFilter').value;
        const url = new URL(window.location);
        if (status) {
            url.searchParams.set('status', status);
        } else {
            url.searchParams.delete('status');
        }
        url.searchParams.set('page', 1);
        window.history.pushState({}, '', url);
        this.renderCustomers();
    }

    async editCustomer(id) {
        alert(`é¡§å®¢ç·¨é›†æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™ (ID: ${id})`);
    }

    async deleteCustomer(id) {
        if (!confirm('ã“ã®é¡§å®¢ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;

        try {
            await this.apiCall(`/customers/${id}`, { method: 'DELETE' });
            this.renderCustomers();
        } catch (error) {
            alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    showAddCustomerModal() {
        alert('æ–°è¦é¡§å®¢ç™»éŒ²æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™');
    }
}

// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–
const app = new SMSApp();

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«å…¬é–‹ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç”¨ï¼‰
window.app = app;
```

### Step 3: é™çš„ã‚µãƒ¼ãƒãƒ¼ (src/frontend/server.cjs)

```javascript
const http = require('http');
const fs = require('fs');
const path = require('path');

const PORT = 3001;

const mimeTypes = {
  '.html': 'text/html',
  '.js': 'text/javascript',
  '.css': 'text/css',
  '.json': 'application/json',
  '.png': 'image/png',
  '.jpg': 'image/jpg',
  '.gif': 'image/gif',
  '.svg': 'image/svg+xml',
  '.ico': 'image/x-icon'
};

const server = http.createServer((req, res) => {
  console.log(`${new Date().toISOString()} - ${req.method} ${req.url}`);

  let filePath = '.' + req.url;
  if (filePath === './') {
    filePath = './index.html';
  }

  // SPAãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° - ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆã§index.htmlã‚’è¿”ã™
  const extname = String(path.extname(filePath)).toLowerCase();
  if (!extname && !filePath.includes('.')) {
    filePath = './index.html';
  }

  const contentType = mimeTypes[extname] || 'application/octet-stream';

  fs.readFile(filePath, (error, content) => {
    if (error) {
      if (error.code === 'ENOENT') {
        // ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã‚‚index.htmlã‚’è¿”ã™ï¼ˆSPAå¯¾å¿œï¼‰
        fs.readFile('./index.html', (error, content) => {
          res.writeHead(200, { 'Content-Type': 'text/html' });
          res.end(content, 'utf-8');
        });
      } else {
        res.writeHead(500);
        res.end('Server Error: ' + error.code);
      }
    } else {
      res.writeHead(200, { 'Content-Type': contentType });
      res.end(content, 'utf-8');
    }
  });
});

server.listen(PORT, () => {
  console.log(`Frontend server running at http://localhost:${PORT}/`);
});
```

---

## ğŸ”— Phase 4: çµ±åˆã¨ãƒ†ã‚¹ãƒˆ

### Step 1: æœ¬ç•ªç”¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ä½œæˆ

```bash
# src/frontend/app.prod.js ã‚’ app.js ã‹ã‚‰ã‚³ãƒ”ãƒ¼
cp src/frontend/app.js src/frontend/app.prod.js

# app.prod.jsã‚’ç·¨é›†ã—ã¦APIã®URLã‚’æœ¬ç•ªç”¨ã«å¤‰æ›´
# this.apiUrl = '/api'; ã«å¤‰æ›´
```

### Step 2: Vercelè¨­å®š (vercel.json)

```json
{
  "version": 2,
  "buildCommand": "npm run vercel-build",
  "outputDirectory": "public",
  "rewrites": [
    {
      "source": "/api/:path*",
      "destination": "/api"
    },
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ],
  "functions": {
    "api/index.js": {
      "maxDuration": 10
    }
  }
}
```

### Step 3: ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

```bash
# .env.local
echo "JWT_SECRET=your-development-secret-key" > .env.local
```

### Step 4: å‹•ä½œãƒ†ã‚¹ãƒˆ

```bash
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
cd src/backend
node server.js

# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
cd src/frontend
node server.cjs

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹
open http://localhost:3001
```

### ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

1. **ãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ**
   - Email: admin@salon.com
   - Password: admin123

2. **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç¢ºèª**
   - çµ±è¨ˆæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹
   - æœ¬æ—¥ã®äºˆç´„ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹
   - ã‚¹ã‚¿ãƒƒãƒ•çŠ¶æ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹

3. **é¡§å®¢ç®¡ç†ãƒ†ã‚¹ãƒˆ**
   - é¡§å®¢ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹
   - ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãŒå‹•ä½œã™ã‚‹ã‹
   - æ¤œç´¢æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹ã‹
   - å‰Šé™¤æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹ã‹

4. **ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ†ã‚¹ãƒˆ**
   - ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¾Œã€ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ã‹

---

## ğŸš€ Phase 5: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### Step 1: Vercel CLIã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install -g vercel
```

### Step 2: ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™

```bash
# publicãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼
npm run build

# Gitã«ã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "Initial SMS system implementation"
```

### Step 3: Vercelãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# Vercelã«ãƒ­ã‚°ã‚¤ãƒ³
vercel login

# ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
vercel

# ä»¥ä¸‹ã®è³ªå•ã«ç­”ãˆã‚‹ï¼š
# - Set up and deploy? Yes
# - Which scope? (your account)
# - Link to existing project? No
# - Project name? sms-salon-system
# - Directory? ./
# - Override settings? No
```

### Step 4: ç’°å¢ƒå¤‰æ•°è¨­å®š

```bash
# Vercelç’°å¢ƒå¤‰æ•°ã®è¨­å®š
vercel env add JWT_SECRET production

# ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§æœ¬ç•ªç”¨ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã‚’å…¥åŠ›
# ä¾‹: your-production-secret-key-here-change-this
```

### Step 5: æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# æœ¬ç•ªç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤
vercel --prod

# ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œã€URLãŒè¡¨ç¤ºã•ã‚Œã‚‹
# https://sms-salon-system.vercel.app
```

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

1. **CORSã‚¨ãƒ©ãƒ¼**
   - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®CORSè¨­å®šã‚’ç¢ºèª
   - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®APIURLãŒæ­£ã—ã„ã‹ç¢ºèª

2. **404ã‚¨ãƒ©ãƒ¼**
   - vercel.jsonã®rewriteè¨­å®šã‚’ç¢ºèª
   - SPAãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

3. **èªè¨¼ã‚¨ãƒ©ãƒ¼**
   - JWT_SECRETç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã‚’ç¢ºèª

4. **ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼**
   - package.jsonã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç¢ºèª
   - publicãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

---

## ğŸ“ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒã‚¤ãƒ³ãƒˆ

### ãƒ‡ã‚¶ã‚¤ãƒ³ã®å¤‰æ›´
- Tailwind CSSã®ã‚¯ãƒ©ã‚¹ã‚’å¤‰æ›´
- ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆã®èª¿æ•´
- ãƒ•ã‚©ãƒ³ãƒˆã®å¤‰æ›´

### æ©Ÿèƒ½ã®è¿½åŠ 
- æ–°ã—ã„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¿½åŠ 
- æ–°ã—ã„ãƒšãƒ¼ã‚¸ã®è¿½åŠ 
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å®Ÿè£…ï¼ˆPostgreSQLç­‰ï¼‰

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å¼·åŒ–
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…
- å…¥åŠ›æ¤œè¨¼ã®å¼·åŒ–
- HTTPSãƒ˜ãƒƒãƒ€ãƒ¼ã®è¿½åŠ 

---

ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€å®Œå…¨ã«å‹•ä½œã™ã‚‹SMSã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚å„ã‚¹ãƒ†ãƒƒãƒ—ã¯ç‹¬ç«‹ã—ã¦ã„ã‚‹ãŸã‚ã€å¿…è¦ã«å¿œã˜ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãªãŒã‚‰é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚