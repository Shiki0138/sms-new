# SMS システムアーキテクチャ図

## システム全体構成図

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              SMS サロン管理システム                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────┐     ┌─────────────────────┐    ┌──────────────┐  │
│  │   クライアント層      │     │    サーバー層        │    │  データ層     │  │
│  │                     │     │                     │    │              │  │
│  │  ┌───────────────┐  │     │  ┌───────────────┐  │    │ ┌──────────┐ │  │
│  │  │  Webブラウザ   │  │────▶│  │   Express.js  │  │────▶│ │In-Memory │ │  │
│  │  │               │  │     │  │   APIサーバー  │  │    │ │Database  │ │  │
│  │  │ ・Chrome      │  │     │  │               │  │    │ │          │ │  │
│  │  │ ・Safari      │  │ API │  │ ・認証        │  │    │ │ ・Users   │ │  │
│  │  │ ・Firefox     │  │ Call│  │ ・CRUD操作    │  │    │ │ ・Customers│ │  │
│  │  │ ・Edge        │  │     │  │ ・ビジネスロジック│  │    │ │ ・Appointments│ │
│  │  └───────────────┘  │     │  └───────────────┘  │    │ │ ・Staff   │ │  │
│  │                     │     │                     │    │ └──────────┘ │  │
│  │  ┌───────────────┐  │     │  ┌───────────────┐  │    │              │  │
│  │  │  フロントエンド │  │     │  │  ミドルウェア  │  │    │  将来実装     │  │
│  │  │               │  │     │  │               │  │    │ ┌──────────┐ │  │
│  │  │ ・Vanilla JS  │  │     │  │ ・JWT認証     │  │    │ │PostgreSQL│ │  │
│  │  │ ・Tailwind CSS│  │     │  │ ・CORS       │  │    │ │          │ │  │
│  │  │ ・Font Awesome│  │     │  │ ・エラー処理   │  │    │ └──────────┘ │  │
│  │  │ ・SPA Router  │  │     │  │ ・ログ        │  │    │ ┌──────────┐ │  │
│  │  └───────────────┘  │     │  └───────────────┘  │    │ │  Redis   │ │  │
│  │                     │     │                     │    │ │  Cache   │ │  │
│  └─────────────────────┘     └─────────────────────┘    └──────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## データフロー図

```
┌──────────────┐           ┌──────────────┐           ┌──────────────┐
│   ユーザー    │           │ フロントエンド │           │ バックエンド  │
└──────┬───────┘           └──────┬───────┘           └──────┬───────┘
       │                          │                          │
       │  1. アクセス              │                          │
       │─────────────────────────▶│                          │
       │                          │                          │
       │  2. ログイン画面表示       │                          │
       │◀─────────────────────────│                          │
       │                          │                          │
       │  3. 認証情報入力          │                          │
       │─────────────────────────▶│                          │
       │                          │  4. API呼び出し          │
       │                          │─────────────────────────▶│
       │                          │                          │
       │                          │  5. 認証処理             │
       │                          │                          │
       │                          │  6. JWTトークン返却      │
       │                          │◀─────────────────────────│
       │                          │                          │
       │  7. ダッシュボード表示     │                          │
       │◀─────────────────────────│                          │
       │                          │                          │
       │  8. 操作（顧客管理等）     │                          │
       │─────────────────────────▶│                          │
       │                          │  9. API呼び出し(JWT付き)  │
       │                          │─────────────────────────▶│
       │                          │                          │
       │                          │  10. データ処理          │
       │                          │                          │
       │                          │  11. レスポンス返却       │
       │                          │◀─────────────────────────│
       │                          │                          │
       │  12. 画面更新            │                          │
       │◀─────────────────────────│                          │
```

## コンポーネント構成図

```
┌─────────────────────────────────────────────────────────────────┐
│                        フロントエンド構成                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  index.html                                                     │
│  ├── app.js (メインアプリケーション)                              │
│  │   ├── SMSApp Class                                          │
│  │   │   ├── Router (SPAルーティング)                           │
│  │   │   ├── API Client (通信処理)                              │
│  │   │   ├── Auth Manager (認証管理)                            │
│  │   │   └── State Manager (状態管理)                           │
│  │   │                                                         │
│  │   ├── Pages (ページコンポーネント)                             │
│  │   │   ├── Dashboard                                         │
│  │   │   ├── Customers                                         │
│  │   │   ├── Appointments                                      │
│  │   │   ├── Staff                                             │
│  │   │   └── Login                                             │
│  │   │                                                         │
│  │   └── Components (UIコンポーネント)                           │
│  │       ├── Navigation                                        │
│  │       ├── StatCard                                          │
│  │       ├── Table                                             │
│  │       ├── Pagination                                        │
│  │       └── Modal                                             │
│  │                                                             │
│  └── Styles (Tailwind CSS)                                     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## API エンドポイント構成

```
┌─────────────────────────────────────────────────────────────────┐
│                      API エンドポイント一覧                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  /api                                                           │
│  ├── /auth                                                      │
│  │   └── POST /login ─────────────── ログイン認証                │
│  │                                                              │
│  ├── /dashboard                                                 │
│  │   └── GET /stats ──────────────── 統計情報取得 [要認証]       │
│  │                                                              │
│  ├── /customers                                                 │
│  │   ├── GET    / ────────────────── 顧客一覧取得 [要認証]       │
│  │   ├── GET    /:id ─────────────── 顧客詳細取得 [要認証]       │
│  │   ├── POST   / ────────────────── 顧客新規作成 [要認証]       │
│  │   ├── PUT    /:id ─────────────── 顧客情報更新 [要認証]       │
│  │   └── DELETE /:id ─────────────── 顧客削除 [要認証]          │
│  │                                                              │
│  ├── /appointments                                              │
│  │   ├── GET    / ────────────────── 予約一覧取得 [要認証]       │
│  │   ├── GET    /:id ─────────────── 予約詳細取得 [要認証]       │
│  │   ├── POST   / ────────────────── 予約新規作成 [要認証]       │
│  │   ├── PUT    /:id ─────────────── 予約情報更新 [要認証]       │
│  │   └── DELETE /:id ─────────────── 予約キャンセル [要認証]      │
│  │                                                              │
│  ├── /staff                                                     │
│  │   ├── GET    / ────────────────── スタッフ一覧 [要認証]       │
│  │   └── GET    /:id ─────────────── スタッフ詳細 [要認証]       │
│  │                                                              │
│  └── /health ─────────────────────── ヘルスチェック              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## セキュリティアーキテクチャ

```
┌─────────────────────────────────────────────────────────────────┐
│                      セキュリティレイヤー                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. HTTPS通信 (Vercel自動設定)                                   │
│     └── 全ての通信を暗号化                                        │
│                                                                 │
│  2. JWT認証                                                     │
│     ├── トークンベース認証                                       │
│     ├── 7日間の有効期限                                          │
│     └── Bearer Token形式                                        │
│                                                                 │
│  3. パスワード保護                                               │
│     ├── bcrypt暗号化 (Salt Rounds: 10)                         │
│     └── プレーンテキスト非保存                                    │
│                                                                 │
│  4. CORS設定                                                    │
│     ├── 許可されたオリジンのみ                                    │
│     └── 認証情報の送信制御                                       │
│                                                                 │
│  5. 入力検証                                                    │
│     ├── フロントエンド検証                                       │
│     └── バックエンド検証                                         │
│                                                                 │
│  6. エラーハンドリング                                           │
│     └── センシティブ情報の非表示                                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## デプロイメントアーキテクチャ

```
┌─────────────────────────────────────────────────────────────────┐
│                    Vercel デプロイメント構成                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  開発環境                        本番環境                        │
│  ┌─────────────┐               ┌─────────────┐               │
│  │   Local     │               │   Vercel    │               │
│  │             │   デプロイ      │             │               │
│  │ ・Frontend  │──────────────▶│ ・CDN       │               │
│  │   :3001     │               │ ・HTTPS     │               │
│  │ ・Backend   │               │ ・Serverless│               │
│  │   :5001     │               │   Functions │               │
│  └─────────────┘               └─────────────┘               │
│                                                                 │
│  ビルドプロセス                                                  │
│  1. npm run build                                               │
│  2. publicディレクトリ生成                                        │
│  3. Vercel自動デプロイ                                           │
│  4. 環境変数設定                                                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## データベース移行計画

```
┌─────────────────────────────────────────────────────────────────┐
│                    将来のデータベース構成                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  現在 (Phase 1)                  将来 (Phase 2)                 │
│  ┌─────────────┐               ┌─────────────┐               │
│  │  In-Memory  │               │ PostgreSQL  │               │
│  │  Database   │──────────────▶│  Database   │               │
│  │             │   移行         │             │               │
│  │ ・揮発性     │               │ ・永続化     │               │
│  │ ・開発用     │               │ ・本番対応   │               │
│  └─────────────┘               └─────────────┘               │
│                                        │                        │
│                                 ┌─────────────┐               │
│                                 │   Redis     │               │
│                                 │   Cache     │               │
│                                 │             │               │
│                                 │ ・高速アクセス│               │
│                                 │ ・セッション  │               │
│                                 └─────────────┘               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## スケーラビリティ計画

```
┌─────────────────────────────────────────────────────────────────┐
│                     スケーラビリティロードマップ                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Stage 1: 単一インスタンス (現在)                                 │
│  ├── 1店舗対応                                                  │
│  └── ~100ユーザー                                               │
│                                                                 │
│  Stage 2: 垂直スケーリング                                       │
│  ├── データベース分離                                            │
│  ├── キャッシュ層追加                                            │
│  └── ~1,000ユーザー                                             │
│                                                                 │
│  Stage 3: 水平スケーリング                                       │
│  ├── ロードバランサー                                            │
│  ├── 複数APIインスタンス                                         │
│  ├── データベースレプリケーション                                 │
│  └── ~10,000ユーザー                                            │
│                                                                 │
│  Stage 4: マイクロサービス化                                     │
│  ├── 機能別サービス分離                                          │
│  ├── メッセージキュー導入                                        │
│  ├── コンテナオーケストレーション                                 │
│  └── 無制限スケール                                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

このアーキテクチャ図は、SMSシステムの技術的な構造を視覚的に表現したものです。システムの各コンポーネントがどのように連携し、データがどのように流れるかを明確に示しています。