<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .result { background: #f5f5f5; padding: 10px; margin-top: 10px; border-radius: 3px; font-family: monospace; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { margin: 5px; padding: 8px 15px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Customer API Test</h1>
    
    <div class="test-section">
        <h3>1. Test GET /api/customers</h3>
        <button onclick="testGetCustomers()">Test GET All Customers</button>
        <div id="get-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>2. Test Search Customers</h3>
        <input type="text" id="search-input" placeholder="Search term" value="さくら">
        <button onclick="testSearchCustomers()">Test Search</button>
        <div id="search-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>3. Test POST /api/customers</h3>
        <button onclick="testCreateCustomer()">Test Create Customer</button>
        <div id="post-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>4. Icon Test</h3>
        <p>Testing icon files:</p>
        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
            <div>
                <img src="/icons/icon-72x72.png" width="72" height="72" style="border: 1px solid #ccc;" 
                     onerror="this.style.background='red'; this.alt='❌ Failed'" 
                     onload="this.style.background='green'">
                <br>72x72
            </div>
            <div>
                <img src="/icons/icon-144x144.png" width="144" height="144" style="border: 1px solid #ccc;"
                     onerror="this.style.background='red'; this.alt='❌ Failed'" 
                     onload="this.style.background='green'">
                <br>144x144
            </div>
            <div>
                <img src="/icons/icon-192x192.png" width="192" height="192" style="border: 1px solid #ccc;"
                     onerror="this.style.background='red'; this.alt='❌ Failed'" 
                     onload="this.style.background='green'">
                <br>192x192
            </div>
        </div>
        <div id="icon-result" class="result"></div>
    </div>

    <script>
        // Test functions
        async function testGetCustomers() {
            const resultDiv = document.getElementById('get-result');
            resultDiv.className = 'result';
            resultDiv.innerHTML = 'Testing...';
            
            try {
                const response = await fetch('/api/customers', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        // Skip auth for testing
                        // 'Authorization': 'Bearer your-token-here'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `✅ Success! Found ${data.total} customers\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `❌ Error ${response.status}: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `❌ Network Error: ${error.message}`;
            }
        }

        async function testSearchCustomers() {
            const searchTerm = document.getElementById('search-input').value;
            const resultDiv = document.getElementById('search-result');
            resultDiv.className = 'result';
            resultDiv.innerHTML = 'Testing...';
            
            try {
                const response = await fetch(`/api/customers?query=${encodeURIComponent(searchTerm)}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `✅ Search Success! Found ${data.total} customers\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `❌ Error ${response.status}: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `❌ Network Error: ${error.message}`;
            }
        }

        async function testCreateCustomer() {
            const resultDiv = document.getElementById('post-result');
            resultDiv.className = 'result';
            resultDiv.innerHTML = 'Testing...';
            
            const testCustomer = {
                firstName: 'テスト',
                lastName: '顧客',
                firstNameKana: 'テスト',
                lastNameKana: 'コキャク',
                email: 'test@example.com',
                phoneNumber: '090-0000-0000',
                birthDate: '1990-01-01',
                gender: 'female',
                postalCode: '100-0001',
                prefecture: '東京都',
                city: 'テスト区',
                address: '1-1-1'
            };
            
            try {
                const response = await fetch('/api/customers', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testCustomer)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `✅ Create Success!\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `❌ Error ${response.status}: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `❌ Network Error: ${error.message}`;
            }
        }

        // Test icons on load
        window.onload = function() {
            const iconResult = document.getElementById('icon-result');
            iconResult.innerHTML = 'Icon files have been generated. Check if they load correctly above.';
            
            // Test manifest.json
            fetch('/manifest.json')
                .then(response => response.json())
                .then(manifest => {
                    iconResult.innerHTML += '\n✅ Manifest.json loaded successfully with ' + manifest.icons.length + ' icons defined.';
                })
                .catch(error => {
                    iconResult.innerHTML += '\n❌ Error loading manifest.json: ' + error.message;
                });
        };
    </script>
</body>
</html>