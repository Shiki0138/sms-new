# 美容サロン管理システム - ライトプラン要件定義書

## はじめに

本文書は美容サロン管理システムのライトプラン（¥4,980/月）の要件を定義します。ライトプランは美容サロン運営に必要な基本機能とメッセージ管理機能を提供し、小規模サロンが効率的に顧客とのコミュニケーションを行えることを目的としています。

## 要件

### 要件1: ユーザー認証とテナント管理

**ユーザーストーリー:** サロンオーナーとして、安全にシステムにログインし、自分のサロンデータのみにアクセスできるようにしたい

#### 受入基準

1. WHEN ユーザーがメールアドレスとパスワードでログインを試行する THEN システムは認証を実行し、成功時にダッシュボードにリダイレクトする
2. WHEN ユーザーがパスワードを忘れた場合 THEN システムはパスワードリセット機能を提供する
3. WHEN ユーザーが新規登録を行う THEN システムは新しいテナント（サロン）を作成し、ユーザーをオーナーとして設定する
4. WHEN 認証されたユーザーがデータにアクセスする THEN システムは自分のテナントのデータのみを表示する
5. WHEN ユーザーがログアウトする THEN システムはセッションを終了し、ログイン画面にリダイレクトする

### 要件2: 基本的な予約管理

**ユーザーストーリー:** サロンスタッフとして、顧客の予約を効率的に管理し、スケジュールを視覚的に確認したい

#### 受入基準

1. WHEN スタッフがカレンダー画面を開く THEN システムは日・週・月表示モードを提供する
2. WHEN スタッフが新しい予約を作成する THEN システムは顧客選択、日時設定、メニュー選択、メモ入力機能を提供する
3. WHEN スタッフが既存の予約をクリックする THEN システムは予約詳細の表示・編集機能を提供する
4. WHEN スタッフが予約を削除する THEN システムは確認ダイアログを表示し、削除を実行する
5. WHEN スタッフが予約ステータスを変更する THEN システムは仮予約・確定・完了・キャンセル・無断キャンセルの状態管理を行う
6. WHEN 予約が重複する時間帯に作成される THEN システムは警告を表示する

### 要件3: 顧客情報管理（外部連携対応）

**ユーザーストーリー:** サロンスタッフとして、顧客の基本情報と来店履歴を管理し、LINE・Instagram・メールでの連絡手段も含めてより良いサービスを提供したい

#### 受入基準

1. WHEN スタッフが新しい顧客を登録する THEN システムは名前・電話番号・メールアドレス・LINE ID・Instagram ID・メモの入力機能を提供する
2. WHEN スタッフが顧客一覧を表示する THEN システムは検索・ソート機能を提供する
3. WHEN スタッフが顧客詳細を表示する THEN システムは基本情報・来店履歴・予約履歴・メッセージ履歴を表示する
4. WHEN スタッフが顧客情報を編集する THEN システムは情報の更新と保存機能を提供する
5. WHEN 顧客が来店する THEN システムは来店回数と最終来店日を自動更新する
6. WHEN スタッフが顧客を検索する THEN システムは名前・電話番号・メールアドレスでの部分一致検索を提供する
7. WHEN 顧客が複数の連絡手段を登録している THEN システムは優先順位（LINE > Instagram > メール）に基づいて連絡手段を選択する

### 要件4: 基本的なメニュー管理

**ユーザーストーリー:** サロンオーナーとして、提供するサービスメニューを管理し、予約時に選択できるようにしたい

#### 受入基準

1. WHEN オーナーがメニューを作成する THEN システムはメニュー名・カテゴリ・所要時間・料金・説明の入力機能を提供する
2. WHEN オーナーがメニュー一覧を表示する THEN システムはカテゴリ別の整理された表示を提供する
3. WHEN オーナーがメニューを編集する THEN システムは既存メニューの情報更新機能を提供する
4. WHEN オーナーがメニューを無効化する THEN システムは新規予約では選択不可にし、既存予約は保持する
5. WHEN スタッフが予約を作成する THEN システムは有効なメニューのみを選択肢として表示する

### 要件5: 営業時間と基本設定（機能間連動）

**ユーザーストーリー:** サロンオーナーとして、営業時間や基本的な店舗設定を管理し、それらの設定が全システムに確実に反映されることを確認したい

#### 受入基準

1. WHEN オーナーが営業時間を設定する THEN システムは曜日別の開始時間・終了時間の設定機能を提供する
2. WHEN オーナーが定休日を設定する THEN システムは曜日選択による定休日設定機能を提供する
3. WHEN オーナーが店舗基本情報を入力する THEN システムは店舗名・住所・電話番号の管理機能を提供する
4. WHEN スタッフが予約を作成する THEN システムは営業時間外の時間帯を選択不可にする
5. WHEN カレンダーが表示される THEN システムは定休日を視覚的に区別して表示する
6. WHEN 設定が変更される THEN システムは即座にデータベースに保存し、リアルタイムで全画面に反映する
7. WHEN 休日設定が更新される THEN システムは予約カレンダー・ダッシュボード・予約作成画面すべてに変更を反映する
8. WHEN 営業時間が変更される THEN システムは既存予約との競合チェックを行い、必要に応じて警告を表示する

### 要件6: プラン別権限管理システム

**ユーザーストーリー:** システム管理者として、各プラン（ライト・スタンダード・プレミアム）のユーザーに適切な機能制限を厳密に適用したい

#### 受入基準

1. WHEN ライトプランユーザーが顧客を登録する AND 既に100件の顧客が登録されている THEN システムは制限メッセージを表示し、登録を拒否する
2. WHEN スタンダードプランユーザーが顧客を登録する AND 既に1,000件の顧客が登録されている THEN システムは制限メッセージを表示し、登録を拒否する
3. WHEN プレミアムプランユーザーが顧客を登録する THEN システムは無制限で登録を許可する
4. WHEN ライトプランユーザーが月間予約制限に達する THEN システムは新規予約作成を制限し、アップグレードを促す
5. WHEN ユーザーがログイン時にプラン情報を取得する THEN システムは現在のプランに基づいて利用可能機能を動的に制御する
6. WHEN ライトプランユーザーが高度な分析機能にアクセスしようとする THEN システムはアクセスを拒否し、プラン制限メッセージを表示する
7. WHEN プラン変更が発生する THEN システムは即座に権限を更新し、新しい制限を適用する

### 要件7: 基本的なダッシュボード

**ユーザーストーリー:** サロンスタッフとして、今日の予約状況と重要な情報を一目で確認したい

#### 受入基準

1. WHEN スタッフがダッシュボードにアクセスする THEN システムは本日の予約一覧をタイムライン形式で表示する
2. WHEN ダッシュボードが表示される THEN システムは本日の売上合計を表示する
3. WHEN 新しい予約やキャンセルが発生する THEN システムは通知として表示する
4. WHEN スタッフがクイックアクションを使用する THEN システムは予約追加・顧客検索のショートカットを提供する
5. WHEN 予約時間が近づく THEN システムは次の予約の顧客情報を強調表示する

### 要件8: メッセージ管理システム（LINE・Instagram・メール統合）

**ユーザーストーリー:** サロンスタッフとして、LINE・Instagram・メールからの顧客メッセージを一元管理し、効率的に返信したい

#### 受入基準

1. WHEN 顧客からLINEメッセージが届く THEN システムはメッセージ管理画面に通知を表示し、メッセージ内容を保存する
2. WHEN 顧客からInstagram DMが届く THEN システムはメッセージ管理画面に通知を表示し、メッセージ内容を保存する
3. WHEN 顧客からメールが届く THEN システムはメッセージ管理画面に通知を表示し、メッセージ内容を保存する
4. WHEN スタッフがメッセージに返信する THEN システムは元の送信チャネル（LINE・Instagram・メール）で返信を送信する
5. WHEN スタッフが返信文を作成する THEN システムはAI返信支援ボタンを提供し、適切な返信文を生成する
6. WHEN 顧客が複数のチャネルでメッセージを送信する THEN システムは優先順位（LINE > Instagram > メール）に基づいて統合表示する
7. WHEN メッセージに予約に関する内容が含まれる THEN システムは予約作成への導線を提供する
8. WHEN スタッフがメッセージ履歴を確認する THEN システムは顧客別・チャネル別の履歴表示機能を提供する

### 要件9: 自動リマインダーシステム

**ユーザーストーリー:** サロンスタッフとして、予約のリマインダーメッセージを自動送信し、顧客満足度を向上させたい

#### 受入基準

1. WHEN 予約の1週間前になる THEN システムは自動的にリマインダーメッセージを顧客の優先連絡手段に送信する
2. WHEN 予約の3日前になる THEN システムは自動的にリマインダーメッセージを顧客の優先連絡手段に送信する
3. WHEN 顧客が来店完了後 THEN システムは自動的にお礼メッセージを顧客の優先連絡手段に送信する
4. WHEN オーナーがリマインダー設定を変更する THEN システムは送信タイミング・メッセージ内容・送信有無の設定機能を提供する
5. WHEN リマインダー送信が失敗する THEN システムは代替手段での送信を試行し、失敗ログを記録する
6. WHEN 顧客がリマインダーに返信する THEN システムはメッセージ管理画面に通知を表示する
7. WHEN リマインダーメッセージをカスタマイズする THEN システムは顧客名・予約日時・メニュー名の自動挿入機能を提供する

### 要件10: 外部API連携システム

**ユーザーストーリー:** サロンオーナーとして、LINE・Instagram・Googleカレンダー・ホットペッパーとの連携を設定し、業務を効率化したい

#### 受入基準

1. WHEN オーナーがLINE連携を設定する THEN システムはLINE Messaging APIの認証・設定機能を提供する
2. WHEN オーナーがInstagram連携を設定する THEN システムはInstagram Graph APIの認証・設定機能を提供する
3. WHEN オーナーがGoogleカレンダー連携を設定する THEN システムはGoogle Calendar APIの認証・設定機能を提供する
4. WHEN ホットペッパーからCSVデータをインポートする THEN システムは顧客情報・予約情報の一括取り込み機能を提供する
5. WHEN 外部API連携でエラーが発生する THEN システムは詳細なエラーログを記録し、管理者に通知する
6. WHEN 予約がGoogleカレンダーと同期される THEN システムは双方向同期（作成・更新・削除）を実行する
7. WHEN API制限に達する THEN システムは適切な制限メッセージを表示し、代替手段を提案する

### 要件11: データの安全性とバックアップ

**ユーザーストーリー:** サロンオーナーとして、大切な顧客データと予約情報が安全に保護されることを確認したい

#### 受入基準

1. WHEN システムがデータを保存する THEN システムは暗号化された通信（HTTPS）を使用する
2. WHEN ユーザーがデータにアクセスする THEN システムはRow Level Security（RLS）により他のテナントのデータを隠す
3. WHEN データベースに変更が加えられる THEN システムは自動的にバックアップを作成する
4. WHEN ユーザーがパスワードを入力する THEN システムはハッシュ化して保存し、平文では保存しない
5. WHEN セッションが長時間非アクティブになる THEN システムは自動的にログアウトする
6. WHEN 外部API認証情報を保存する THEN システムは暗号化してデータベースに保存する

### 要件12: 美容師向けプレミアムデザインとユーザビリティ

**ユーザーストーリー:** 美容師として、おしゃれで上品なデザインのシステムを、PC・タブレット・スマートフォンのどのデバイスでも快適に操作したい

#### 受入基準

1. WHEN ユーザーがスマートフォンでシステムにアクセスする THEN システムはタッチ操作に最適化された大きなタップエリアとスワイプジェスチャーを提供する
2. WHEN ユーザーがタブレットでカレンダーを操作する THEN システムはタッチでの予約作成・編集機能とピンチズーム対応を提供する
3. WHEN 画面サイズが変更される THEN システムは自動的にレイアウトを調整し、美しいプロポーションを維持する
4. WHEN ユーザーが美容師として直感的に操作する THEN システムはAtlassian Design Systemを参考にした洗練されたコンポーネントを使用する
5. WHEN ユーザーが繁忙時に素早く操作する THEN システムは最小限のタップ数で主要機能にアクセスできるフローティングアクションボタンを提供する
6. WHEN エラーが発生する THEN システムは美容師にも理解しやすい日本語でエレガントなエラーメッセージを表示する
7. WHEN システムが表示される THEN システムは美容業界にふさわしい上品なカラーパレットとタイポグラフィを使用する
8. WHEN ユーザーがアニメーションを体験する THEN システムは滑らかで心地よいマイクロインタラクションを提供する

### 要件13: 開発・デプロイメント・監視

**ユーザーストーリー:** 開発者として、安定したシステムを継続的に提供し、問題を迅速に特定・解決したい

#### 受入基準

1. WHEN コードがGitHubにプッシュされる THEN システムはVercelで自動的にビルド・デプロイを実行する
2. WHEN ビルドエラーが発生する THEN システムはデプロイを停止し、詳細なエラーログを記録する
3. WHEN アプリケーションエラーが発生する THEN システムは構造化されたログを記録し、エラー追跡を可能にする
4. WHEN ユーザーがシステムを使用する THEN システムはパフォーマンスメトリクスを収集し、監視する
5. WHEN データベース接続エラーが発生する THEN システムは適切なフォールバック処理を実行し、ユーザーに分かりやすいメッセージを表示する
6. WHEN 開発記録を作成する THEN システムは初心者エンジニア向けに自然言語で理解しやすい形式で記録する
7. WHEN Supabase APIとの連携でエラーが発生する THEN システムはリトライ機能と適切なエラーハンドリングを実行する