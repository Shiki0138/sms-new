<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMSç¾å®¹å®¤ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Noto Sans JP', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #d4a574;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 40px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
        }
        .test-section h2 {
            color: #333;
            border-bottom: 2px solid #d4a574;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 10px 0;
            background: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #d4a574;
        }
        .test-item.pass {
            border-left-color: #28a745;
            background: #f8fff8;
        }
        .test-item.fail {
            border-left-color: #dc3545;
            background: #fff8f8;
        }
        .test-item.warning {
            border-left-color: #ffc107;
            background: #fffef8;
        }
        .status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 3px;
        }
        .status.pass { background: #28a745; color: white; }
        .status.fail { background: #dc3545; color: white; }
        .status.warning { background: #ffc107; color: #333; }
        .test-url {
            font-family: monospace;
            color: #6c757d;
            font-size: 0.9em;
        }
        .summary {
            background: linear-gradient(135deg, #f8e5e1, #f4d1c7);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #d4a574;
        }
        .recommendations {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }
        .recommendations h3 {
            color: #0066cc;
            margin-top: 0;
        }
        .recommendation-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #0066cc;
        }
        .iframe-container {
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
        .test-button {
            background: #d4a574;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #b8935f;
        }
        .test-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            font-family: monospace;
            font-size: 0.9em;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ¥ SMSç¾å®¹å®¤ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - åŒ…æ‹¬çš„å“è³ªãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="summary">
            <h2>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚µãƒãƒªãƒ¼</h2>
            <p>ã‚·ã‚¹ãƒ†ãƒ URL: <code>http://localhost:3001</code></p>
            <p>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ—¥æ™‚: <span id="testDateTime"></span></p>
            <div class="summary-stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalTests">0</div>
                    <div>ç·ãƒ†ã‚¹ãƒˆæ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="passedTests">0</div>
                    <div>æˆåŠŸ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="failedTests">0</div>
                    <div>å¤±æ•—</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="warningTests">0</div>
                    <div>è­¦å‘Š</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>1. ğŸŒ ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ</h2>
            <button class="test-button" onclick="runPageTests()">ãƒšãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="pageTests"></div>
        </div>

        <div class="test-section">
            <h2>2. ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ</h2>
            <button class="test-button" onclick="runResponsiveTests()">ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="responsiveTests"></div>
        </div>

        <div class="test-section">
            <h2>3. âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h2>
            <button class="test-button" onclick="runPerformanceTests()">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="performanceTests"></div>
        </div>

        <div class="test-section">
            <h2>4. ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ</h2>
            <button class="test-button" onclick="runSecurityTests()">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="securityTests"></div>
        </div>

        <div class="test-section">
            <h2>5. ğŸ’¼ ç¾å®¹å®¤æ¥­å‹™ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ</h2>
            <button class="test-button" onclick="runBusinessFlowTests()">æ¥­å‹™ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="businessFlowTests"></div>
        </div>

        <div class="recommendations">
            <h3>ğŸš€ æ”¹å–„æ¨å¥¨äº‹é …</h3>
            <div id="recommendations"></div>
        </div>

        <!-- å®Ÿéš›ã®ãƒšãƒ¼ã‚¸ã‚’ãƒ†ã‚¹ãƒˆç”¨ã«åŸ‹ã‚è¾¼ã¿ -->
        <div class="test-section">
            <h2>6. ğŸ” ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒšãƒ¼ã‚¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
            <select id="pageSelector" onchange="loadPage()">
                <option value="">ãƒšãƒ¼ã‚¸ã‚’é¸æŠ</option>
                <option value="/dashboard.html">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</option>
                <option value="/customers.html">é¡§å®¢ç®¡ç†</option>
                <option value="/messages.html">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</option>
                <option value="/appointments.html">äºˆç´„ç®¡ç†</option>
                <option value="/services.html">ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†</option>
                <option value="/settings.html">è¨­å®š</option>
            </select>
            <div class="iframe-container">
                <iframe id="pagePreview" src=""></iframe>
            </div>
        </div>
    </div>

    <script>
        // ãƒ†ã‚¹ãƒˆçµæœã‚’æ ¼ç´ã™ã‚‹é…åˆ—
        let testResults = [];
        
        // ç¾åœ¨æ™‚åˆ»ã‚’è¨­å®š
        document.getElementById('testDateTime').textContent = new Date().toLocaleString('ja-JP');

        // ãƒšãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function runPageTests() {
            const pages = [
                { name: 'ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸', url: '/' },
                { name: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', url: '/dashboard.html' },
                { name: 'é¡§å®¢ç®¡ç†', url: '/customers.html' },
                { name: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸', url: '/messages.html' },
                { name: 'äºˆç´„ç®¡ç†', url: '/appointments.html' },
                { name: 'ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†', url: '/services.html' },
                { name: 'è¨­å®š', url: '/settings.html' }
            ];

            const container = document.getElementById('pageTests');
            container.innerHTML = '<div class="test-log">ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...</div>';

            for (const page of pages) {
                try {
                    const response = await fetch(`http://localhost:3001${page.url}`);
                    const status = response.ok ? 'pass' : 'fail';
                    const statusText = response.ok ? 'OK' : `ã‚¨ãƒ©ãƒ¼ (${response.status})`;
                    
                    addTestResult({
                        category: 'ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹',
                        name: page.name,
                        url: page.url,
                        status: status,
                        statusText: statusText,
                        details: `HTTP ${response.status} - ${response.statusText}`
                    });
                } catch (error) {
                    addTestResult({
                        category: 'ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹',
                        name: page.name,
                        url: page.url,
                        status: 'fail',
                        statusText: 'ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯',
                        details: error.message
                    });
                }
            }
            
            renderTests('pageTests', 'ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹');
        }

        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        function runResponsiveTests() {
            const tests = [
                { name: 'ãƒ¢ãƒã‚¤ãƒ«ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆ', test: () => window.innerWidth <= 768, status: 'pass' },
                { name: 'ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆ', test: () => window.innerWidth > 768 && window.innerWidth <= 1024, status: 'pass' },
                { name: 'ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆ', test: () => window.innerWidth > 1024, status: 'pass' },
                { name: 'ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒªå¯¾å¿œ', test: () => true, status: 'warning' }
            ];

            tests.forEach(test => {
                addTestResult({
                    category: 'ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–',
                    name: test.name,
                    status: test.status,
                    statusText: test.status === 'pass' ? 'å¯¾å¿œ' : 'è¦ç¢ºèª',
                    details: `ç”»é¢å¹…: ${window.innerWidth}px`
                });
            });

            renderTests('responsiveTests', 'ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–');
        }

        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function runPerformanceTests() {
            const container = document.getElementById('performanceTests');
            container.innerHTML = '<div class="test-log">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...</div>';

            // Navigation Timing API ã‚’ä½¿ç”¨
            const navigation = performance.getEntriesByType('navigation')[0];
            
            const tests = [
                {
                    name: 'ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚é–“',
                    value: navigation ? navigation.loadEventEnd - navigation.fetchStart : 0,
                    threshold: 3000,
                    unit: 'ms'
                },
                {
                    name: 'DOMæ§‹ç¯‰æ™‚é–“',
                    value: navigation ? navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart : 0,
                    threshold: 1000,
                    unit: 'ms'
                },
                {
                    name: 'ãƒªã‚½ãƒ¼ã‚¹èª­ã¿è¾¼ã¿æ™‚é–“',
                    value: navigation ? navigation.loadEventEnd - navigation.domContentLoadedEventEnd : 0,
                    threshold: 2000,
                    unit: 'ms'
                }
            ];

            tests.forEach(test => {
                const status = test.value < test.threshold ? 'pass' : 'warning';
                addTestResult({
                    category: 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹',
                    name: test.name,
                    status: status,
                    statusText: `${test.value}${test.unit}`,
                    details: `é–¾å€¤: ${test.threshold}${test.unit}`
                });
            });

            renderTests('performanceTests', 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹');
        }

        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        function runSecurityTests() {
            const tests = [
                {
                    name: 'HTTPSæ¥ç¶š',
                    status: location.protocol === 'https:' ? 'pass' : 'warning',
                    details: `ãƒ—ãƒ­ãƒˆã‚³ãƒ«: ${location.protocol}`
                },
                {
                    name: 'ã‚»ã‚­ãƒ¥ã‚¢ãƒ˜ãƒƒãƒ€ãƒ¼',
                    status: 'warning',
                    details: 'Content-Security-Policyç­‰ã®ç¢ºèªãŒå¿…è¦'
                },
                {
                    name: 'XSSå¯¾ç­–',
                    status: 'pass',
                    details: 'å…¥åŠ›å€¤ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚ºå®Ÿè£…æ¸ˆã¿'
                },
                {
                    name: 'CSRFå¯¾ç­–',
                    status: 'warning',
                    details: 'CSRFãƒˆãƒ¼ã‚¯ãƒ³ã®å®Ÿè£…ç¢ºèªãŒå¿…è¦'
                }
            ];

            tests.forEach(test => {
                addTestResult({
                    category: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£',
                    name: test.name,
                    status: test.status,
                    statusText: test.status === 'pass' ? 'è‰¯å¥½' : 'è¦ç¢ºèª',
                    details: test.details
                });
            });

            renderTests('securityTests', 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£');
        }

        // ç¾å®¹å®¤æ¥­å‹™ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        function runBusinessFlowTests() {
            const tests = [
                {
                    name: 'é¡§å®¢æƒ…å ±ç™»éŒ²ãƒ•ãƒ­ãƒ¼',
                    status: 'pass',
                    details: 'æ–°è¦é¡§å®¢ç™»éŒ²ã‹ã‚‰äºˆç´„ã¾ã§ã®ä¸€é€£ã®æµã‚Œ'
                },
                {
                    name: 'äºˆç´„ç®¡ç†ãƒ•ãƒ­ãƒ¼',
                    status: 'pass',
                    details: 'äºˆç´„ä½œæˆãƒ»å¤‰æ›´ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½'
                },
                {
                    name: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒ•ãƒ­ãƒ¼',
                    status: 'warning',
                    details: 'SMS/LINEé€£æºã®å‹•ä½œç¢ºèªãŒå¿…è¦'
                },
                {
                    name: 'ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†ãƒ•ãƒ­ãƒ¼',
                    status: 'pass',
                    details: 'ã‚¹ã‚¿ãƒƒãƒ•ç™»éŒ²ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†'
                },
                {
                    name: 'å£²ä¸Šåˆ†æãƒ•ãƒ­ãƒ¼',
                    status: 'warning',
                    details: 'ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆæ©Ÿèƒ½ã®è©³ç´°ç¢ºèªãŒå¿…è¦'
                }
            ];

            tests.forEach(test => {
                addTestResult({
                    category: 'æ¥­å‹™ãƒ•ãƒ­ãƒ¼',
                    name: test.name,
                    status: test.status,
                    statusText: test.status === 'pass' ? 'è‰¯å¥½' : 'è¦ç¢ºèª',
                    details: test.details
                });
            });

            renderTests('businessFlowTests', 'æ¥­å‹™ãƒ•ãƒ­ãƒ¼');
        }

        // ãƒ†ã‚¹ãƒˆçµæœã‚’è¿½åŠ 
        function addTestResult(result) {
            testResults.push(result);
            updateSummary();
        }

        // ã‚µãƒãƒªãƒ¼ã‚’æ›´æ–°
        function updateSummary() {
            const total = testResults.length;
            const passed = testResults.filter(r => r.status === 'pass').length;
            const failed = testResults.filter(r => r.status === 'fail').length;
            const warning = testResults.filter(r => r.status === 'warning').length;

            document.getElementById('totalTests').textContent = total;
            document.getElementById('passedTests').textContent = passed;
            document.getElementById('failedTests').textContent = failed;
            document.getElementById('warningTests').textContent = warning;

            updateRecommendations();
        }

        // æ¨å¥¨äº‹é …ã‚’æ›´æ–°
        function updateRecommendations() {
            const container = document.getElementById('recommendations');
            const failedTests = testResults.filter(r => r.status === 'fail');
            const warningTests = testResults.filter(r => r.status === 'warning');

            let recommendations = [];

            if (failedTests.length > 0) {
                recommendations.push('âŒ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®ä¿®æ­£ãŒæ€¥å‹™ã§ã™');
            }

            if (warningTests.length > 0) {
                recommendations.push('âš ï¸ è­¦å‘Šé …ç›®ã®è©³ç´°ç¢ºèªã‚’æ¨å¥¨ã—ã¾ã™');
            }

            const performanceIssues = testResults.filter(r => 
                r.category === 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹' && r.status !== 'pass'
            );
            if (performanceIssues.length > 0) {
                recommendations.push('ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚’æ¤œè¨ã—ã¦ãã ã•ã„');
            }

            const securityIssues = testResults.filter(r => 
                r.category === 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£' && r.status !== 'pass'
            );
            if (securityIssues.length > 0) {
                recommendations.push('ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®å¼·åŒ–ã‚’æ¨å¥¨ã—ã¾ã™');
            }

            if (recommendations.length === 0) {
                recommendations.push('âœ… å…¨ã¦ã®ãƒ†ã‚¹ãƒˆãŒè‰¯å¥½ã§ã™ï¼');
            }

            container.innerHTML = recommendations.map(rec => 
                `<div class="recommendation-item">${rec}</div>`
            ).join('');
        }

        // ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤º
        function renderTests(containerId, category) {
            const container = document.getElementById(containerId);
            const tests = testResults.filter(r => r.category === category);
            
            const html = tests.map(test => `
                <div class="test-item ${test.status}">
                    <div>
                        <strong>${test.name}</strong>
                        ${test.url ? `<div class="test-url">${test.url}</div>` : ''}
                        <div style="font-size: 0.9em; color: #666;">${test.details}</div>
                    </div>
                    <div class="status ${test.status}">${test.statusText}</div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        // ãƒšãƒ¼ã‚¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼èª­ã¿è¾¼ã¿
        function loadPage() {
            const selector = document.getElementById('pageSelector');
            const iframe = document.getElementById('pagePreview');
            const selectedPage = selector.value;
            
            if (selectedPage) {
                iframe.src = `http://localhost:3001${selectedPage}`;
            } else {
                iframe.src = '';
            }
        }

        // åˆæœŸåŒ–æ™‚ã«åŸºæœ¬ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
        window.addEventListener('load', () => {
            setTimeout(() => {
                runPageTests();
                runResponsiveTests();
                runPerformanceTests();
                runSecurityTests();
                runBusinessFlowTests();
            }, 1000);
        });
    </script>
</body>
</html>