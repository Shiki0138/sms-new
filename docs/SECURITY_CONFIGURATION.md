# セキュリティ設定ガイド - Salon Lumière SMS System

## 🔐 緊急セキュリティ修正の実装について

### 修正されたセキュリティ脆弱性

#### 1. JWT Secret Key のハードコード除去
- **以前**: `'salon-lumiere-secret-key'` がハードコードされていた
- **修正後**: 環境変数 `JWT_SECRET` を必須化
- **最小要件**: 32文字以上のランダムな文字列

#### 2. 管理者パスワードのハードコード除去
- **以前**: `'Skyosai51'` がハードコードされていた
- **修正後**: 環境変数 `ADMIN_PASSWORD` を必須化
- **最小要件**: 8文字以上のパスワード

#### 3. 管理者メールアドレスの環境変数化
- **以前**: `'greenroom51@gmail.com'` がハードコードされていた
- **修正後**: 環境変数 `ADMIN_EMAIL` を必須化

## 🚨 セットアップ手順

### 1. 環境変数ファイルの作成

```bash
# .env.example を .env にコピー
cp .env.example .env
```

### 2. セキュアな JWT Secret の生成

```bash
# Node.js を使用してランダムな32バイトの秘密鍵を生成
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### 3. .env ファイルの設定

```env
# 必須のセキュリティ設定
JWT_SECRET=生成された64文字のランダム文字列
ADMIN_EMAIL=your-admin@example.com
ADMIN_PASSWORD=YourStrongPassword123!
```

## 🛡️ セキュリティ機能

### 環境変数バリデーション
システム起動時に以下をチェック:
- `JWT_SECRET`: 存在確認 + 32文字以上の長さ検証
- `ADMIN_PASSWORD`: 存在確認 + 8文字以上の長さ検証
- `ADMIN_EMAIL`: 存在確認

### エラーハンドリング
- 環境変数が不足している場合、システムは起動を拒否
- 適切なエラーメッセージと設定ガイドを表示

## 📋 セキュリティチェックリスト

### ✅ 実装済み
- [x] JWT Secret の環境変数化
- [x] 管理者パスワードの環境変数化  
- [x] 管理者メールアドレスの環境変数化
- [x] 環境変数の存在確認
- [x] JWT Secret の長さ検証（32文字以上）
- [x] 管理者パスワードの長さ検証（8文字以上）
- [x] システム起動時のバリデーション
- [x] .env.example ファイルの作成
- [x] セキュリティドキュメントの作成

### ⚠️ 推奨される追加セキュリティ対策

1. **パスワード複雑性の強化**
   - 大文字・小文字・数字・記号を含む12文字以上
   - パスワード強度チェックの実装

2. **JWT トークンの有効期限短縮**
   - 現在: 7日間
   - 推奨: 1-2時間（リフレッシュトークン併用）

3. **レート制限の実装**
   - ログイン試行回数の制限
   - API呼び出し頻度の制限

4. **HTTPSの強制**
   - 本番環境でのHTTPS必須化
   - セキュリティヘッダーの強化

5. **データベース暗号化**
   - 顧客情報の暗号化保存
   - PII（個人識別情報）の適切な保護

## 🔄 運用時の注意事項

### 環境変数の管理
- `.env` ファイルはGitにコミットしない
- `.gitignore` に `.env` が含まれていることを確認
- 本番環境では環境変数を直接設定

### 定期的なセキュリティ更新
- JWT Secret の定期的な更新
- 管理者パスワードの定期的な変更
- 依存関係の脆弱性チェック

### 監視とログ
- 不正アクセス試行の監視
- システムログの定期的な確認
- セキュリティイベントのアラート設定

## 🆘 緊急時の対応

### JWT Secret が漏洩した場合
1. 新しい JWT Secret を生成
2. 全ユーザーのトークンを無効化
3. 再ログインを強制

### 管理者アカウントが侵害された場合
1. 管理者パスワードを即座に変更
2. アクセスログを確認
3. システム内の変更履歴を監査

## 📞 サポート

セキュリティに関する質問や懸念がある場合は、システム管理者にご連絡ください。

---

**最終更新日**: 2024年8月20日  
**バージョン**: 1.0.0  
**ステータス**: 緊急セキュリティ修正完了