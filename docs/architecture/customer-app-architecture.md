# é¡§å®¢å‘ã‘ç¾å®¹å®¤ã‚¢ãƒ—ãƒª - å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ
- **ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **: http://localhost:3001
- **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**: Node.js + Express + Firebase + Vercel
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Firebase/Sequelizeï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆï¼‰
- **èªè¨¼**: JWT + bcrypt

### 1.2 é¡§å®¢ã‚¢ãƒ—ãƒªã®ä½ç½®ã¥ã‘
```
[ç¾å®¹å®¤ç®¡ç†è€…] â†â†’ [ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ] â†â†’ [API Gateway] â†â†’ [é¡§å®¢ã‚¢ãƒ—ãƒª]
                                          â†•
                                     [Firebase DB]
```

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ–¹é‡

### 2.1 è¨­è¨ˆåŸå‰‡
1. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: ç®¡ç†è€…ãƒ‡ãƒ¼ã‚¿ã¨é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã®å®Œå…¨åˆ†é›¢
2. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œï¼ˆè¤‡æ•°ç¾å®¹å®¤å¯¾å¿œï¼‰
3. **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£**: ç¾å®¹å®¤é¡§å®¢ã«ç‰¹åŒ–ã—ãŸUX
4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: PWAå¯¾å¿œã§ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªç›¸å½“ã®ä½“é¨“
5. **é‹ç”¨æ€§**: æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹çµ±åˆ

### 2.2 å“è³ªå±æ€§è¦ä»¶
- **å¯ç”¨æ€§**: 99.9%ï¼ˆç¾å®¹å®¤å–¶æ¥­æ™‚é–“ä¸­ï¼‰
- **å¿œç­”æ€§**: 2ç§’ä»¥å†…ã®ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: OWASPæº–æ‹ 
- **æ‹¡å¼µæ€§**: 1000ç¾å®¹å®¤Ã—10000é¡§å®¢å¯¾å¿œ
- **ä¿å®ˆæ€§**: ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆ

## 3. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 3.1 å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆC4 - Context Levelï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é¡§å®¢å‘ã‘ç¾å®¹å®¤ã‚¢ãƒ—ãƒª                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  [é¡§å®¢]    [ç¾å®¹å®¤ã‚¹ã‚¿ãƒƒãƒ•]    [ç¾å®¹å®¤çµŒå–¶è€…]    [ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…] â”‚
â”‚    â”‚              â”‚                â”‚               â”‚        â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                   â”‚                â”‚                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                 â”‚
â”‚              â”‚é¡§å®¢ã‚¢ãƒ—ãƒª  â”‚     â”‚ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ â”‚                 â”‚
â”‚              â”‚(PWA)     â”‚     â”‚(æ—¢å­˜)     â”‚                 â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                   â”‚                â”‚                        â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                    â”‚                        â”‚
â”‚                             â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                  â”‚
â”‚                             â”‚API Gatewayâ”‚                  â”‚
â”‚                             â”‚& Services â”‚                  â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                    â”‚                        â”‚
â”‚                             â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                  â”‚
â”‚                             â”‚Firebase DBâ”‚                  â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ã‚³ãƒ³ãƒ†ãƒŠå›³ï¼ˆC4 - Container Levelï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SMSç¾å®¹å®¤ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚é¡§å®¢PWAã‚¢ãƒ—ãƒª  â”‚    â”‚ç®¡ç†Webã‚¢ãƒ—ãƒª   â”‚    â”‚äºˆç´„ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ   â”‚ â”‚
â”‚  â”‚React/Vue    â”‚    â”‚(æ—¢å­˜)        â”‚    â”‚(æ—¢å­˜)          â”‚ â”‚
â”‚  â”‚Service Workerâ”‚   â”‚Express Views â”‚    â”‚JavaScript      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                   â”‚                      â”‚        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                             â”‚                               â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                    â”‚API Gateway      â”‚                     â”‚
â”‚                    â”‚Express.js       â”‚                     â”‚
â”‚                    â”‚Rate Limiting    â”‚                     â”‚
â”‚                    â”‚Authentication   â”‚                     â”‚
â”‚                    â”‚Authorization    â”‚                     â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                             â”‚                               â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚     â”‚                       â”‚                           â”‚   â”‚
â”‚ â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Customerâ”‚  â”‚Appointment  â”‚  â”‚Message â”‚  â”‚Analytics    â”‚ â”‚
â”‚ â”‚Service â”‚  â”‚Service      â”‚  â”‚Service â”‚  â”‚Service      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚     â”‚              â”‚              â”‚             â”‚        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                    â”‚              â”‚                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                â”‚
â”‚              â”‚Firebase Database        â”‚                â”‚
â”‚              â”‚- Firestore (NoSQL)      â”‚                â”‚
â”‚              â”‚- Authentication         â”‚                â”‚
â”‚              â”‚- Storage (Images)       â”‚                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚External Services                                   â”‚  â”‚
â”‚  â”‚- Twilio (SMS)                                      â”‚  â”‚
â”‚  â”‚- SendGrid (Email)                                  â”‚  â”‚
â”‚  â”‚- LINE Messaging API                                â”‚  â”‚
â”‚  â”‚- Instagram Basic Display API                       â”‚  â”‚
â”‚  â”‚- Google Calendar API                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4. é¡§å®¢èªè¨¼ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ

### 4.1 èªè¨¼æ–¹å¼
1. **é›»è©±ç•ªå·èªè¨¼ï¼ˆä¸»è¦ï¼‰**
   - SMS OTP ã«ã‚ˆã‚‹æœ¬äººç¢ºèª
   - å›½éš›åŒ–å¯¾å¿œï¼ˆ+81å½¢å¼ï¼‰
   - æ—¢å­˜é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã¨ã®è‡ªå‹•ç…§åˆ

2. **ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹èªè¨¼**
   - ãƒ¡ãƒ¼ãƒ«èªè¨¼ãƒªãƒ³ã‚¯
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
   - æ—¢å­˜é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã¨ã®ç…§åˆ

3. **SNSé€£æºèªè¨¼**
   - LINE Login
   - Google OAuth 2.0
   - Facebook Loginï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### 4.2 èªè¨¼ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant C as é¡§å®¢
    participant A as é¡§å®¢ã‚¢ãƒ—ãƒª
    participant G as API Gateway
    participant F as Firebase Auth
    participant D as Firebase DB

    Note over C,D: é›»è©±ç•ªå·èªè¨¼ã®å ´åˆ

    C->>A: é›»è©±ç•ªå·å…¥åŠ›
    A->>G: èªè¨¼è¦æ±‚
    G->>F: SMS OTPé€ä¿¡
    F->>C: SMS OTPå—ä¿¡
    C->>A: OTPå…¥åŠ›
    A->>G: OTPæ¤œè¨¼è¦æ±‚
    G->>F: OTPæ¤œè¨¼
    F->>G: èªè¨¼æˆåŠŸ
    G->>D: é¡§å®¢æƒ…å ±ç…§åˆ
    D->>G: é¡§å®¢ãƒ‡ãƒ¼ã‚¿è¿”å´
    G->>A: JWTãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ
    A->>C: ãƒ­ã‚°ã‚¤ãƒ³å®Œäº†
```

### 4.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–
- **JWT ãƒˆãƒ¼ã‚¯ãƒ³**: çŸ­æœŸé–“ï¼ˆ1æ™‚é–“ï¼‰+ ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ30æ—¥ï¼‰
- **Rate Limiting**: 1åˆ†é–“ã«5å›ã¾ã§ã®èªè¨¼è©¦è¡Œ
- **Device Fingerprinting**: ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹æ¤œçŸ¥
- **IP Whitelist**: ç¾å®¹å®¤IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã®ç®¡ç†æ“ä½œåˆ¶é™

## 5. ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 5.1 ãƒ‡ãƒ¼ã‚¿åˆ†é›¢æˆ¦ç•¥
```
Firebase Project: "sms-salon-system"
â”œâ”€â”€ Collections
â”‚   â”œâ”€â”€ salons/ (ç¾å®¹å®¤ãƒã‚¹ã‚¿ãƒ¼)
â”‚   â”œâ”€â”€ users/ (ç®¡ç†è€…ãƒ‡ãƒ¼ã‚¿) ğŸ”’ Admin Only
â”‚   â”œâ”€â”€ customers/ (é¡§å®¢ãƒ‡ãƒ¼ã‚¿) ğŸ” Customer Read/Update
â”‚   â”œâ”€â”€ appointments/ (äºˆç´„ãƒ‡ãƒ¼ã‚¿) ğŸ” Shared Access
â”‚   â”œâ”€â”€ services/ (ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±) ğŸ“– Public Read
â”‚   â””â”€â”€ customer_profiles/ (é¡§å®¢å°‚ç”¨ãƒ‡ãƒ¼ã‚¿) ğŸ” Customer Only
â””â”€â”€ Security Rules
    â”œâ”€â”€ admin.rules (ç®¡ç†è€…æ¨©é™)
    â”œâ”€â”€ customer.rules (é¡§å®¢æ¨©é™)
    â””â”€â”€ public.rules (å…¬é–‹æƒ…å ±)
```

### 5.2 é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«æ‹¡å¼µ

```javascript
// æ—¢å­˜ã®Customerãƒ¢ãƒ‡ãƒ«ã«è¿½åŠ 
const CustomerProfile = {
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç¶™æ‰¿
  ...Customer,
  
  // é¡§å®¢ã‚¢ãƒ—ãƒªå°‚ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  app_preferences: {
    notifications: {
      push: true,
      sms: true,
      email: true,
      line: false
    },
    language: 'ja',
    theme: 'light'
  },
  
  loyalty_points: 0,
  member_tier: 'regular', // regular, silver, gold, platinum
  
  // ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆæƒ…å ±ï¼ˆé¡§å®¢ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
  personal_notes: '',
  beauty_goals: [],
  skin_type: '',
  hair_type: '',
  allergies: [],
  
  // ã‚¢ãƒ—ãƒªä½¿ç”¨çŠ¶æ³
  last_app_login: null,
  app_version: '',
  device_info: '',
  
  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
  two_factor_enabled: false,
  trusted_devices: []
};
```

## 6. APIè¨­è¨ˆ

### 6.1 APIã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **RESTful API**: åŸºæœ¬çš„ãªCRUDæ“ä½œ
- **GraphQL**: è¤‡é›‘ãªãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆå°†æ¥æ‹¡å¼µï¼‰
- **WebSocket**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥
- **Webhook**: å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æº

### 6.2 ä¸»è¦APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

```
POST /api/v1/auth/phone          # é›»è©±ç•ªå·èªè¨¼é–‹å§‹
POST /api/v1/auth/verify         # OTPæ¤œè¨¼
POST /api/v1/auth/refresh        # ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
POST /api/v1/auth/logout         # ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ

GET  /api/v1/customer/profile    # ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
PUT  /api/v1/customer/profile    # ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°
GET  /api/v1/customer/history    # æ¥åº—å±¥æ­´
GET  /api/v1/customer/points     # ãƒã‚¤ãƒ³ãƒˆæ®‹é«˜

GET  /api/v1/appointments        # äºˆç´„ä¸€è¦§
POST /api/v1/appointments        # æ–°è¦äºˆç´„
PUT  /api/v1/appointments/:id    # äºˆç´„å¤‰æ›´
DEL  /api/v1/appointments/:id    # äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«

GET  /api/v1/services           # ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§
GET  /api/v1/availability       # ç©ºãæ™‚é–“
GET  /api/v1/staff              # ã‚¹ã‚¿ãƒƒãƒ•æƒ…å ±

POST /api/v1/messages           # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
GET  /api/v1/conversations      # ä¼šè©±å±¥æ­´

GET  /api/v1/campaigns          # ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³æƒ…å ±
GET  /api/v1/notifications      # é€šçŸ¥å±¥æ­´
```

### 6.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

```javascript
// API Gateway ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
const securityMiddleware = [
  helmet(),                    // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼
  rateLimit({                 // ãƒ¬ãƒ¼ãƒˆåˆ¶é™
    windowMs: 15 * 60 * 1000,
    max: 100
  }),
  cors({                      // CORSè¨­å®š
    origin: ['https://salon-customer-app.vercel.app'],
    credentials: true
  }),
  authenticateCustomer,       // JWTèªè¨¼
  authorizeCustomer,          // æ¨©é™ãƒã‚§ãƒƒã‚¯
  auditLog                    // ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°
];
```

## 7. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨­è¨ˆ

### 7.1 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯é¸å®š

| è¦ä»¶ | é¸æŠè‚¢ | æ¨å¥¨ | ç†ç”± |
|------|--------|------|------|
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | React, Vue.js, Svelte | **React** | ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã€PWAå¯¾å¿œã€é–‹ç™ºåŠ¹ç‡ |
| ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ« | Vite, Webpack, Parcel | **Vite** | é«˜é€Ÿã€ãƒ¢ãƒ€ãƒ³ã€è¨­å®šç°¡å˜ |
| UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | Material-UI, Chakra UI, Ant Design | **Chakra UI** | è»½é‡ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§ã€ç¾å®¹æ¥­ç•Œå‘ã‘ãƒ‡ã‚¶ã‚¤ãƒ³ |
| çŠ¶æ…‹ç®¡ç† | Redux, Zustand, Jotai | **Zustand** | ã‚·ãƒ³ãƒ—ãƒ«ã€TypeScriptå¯¾å¿œ |
| PWA | Workbox, PWA Builder | **Workbox** | Googleè£½ã€è±Šå¯Œãªæ©Ÿèƒ½ |
| é€šçŸ¥ | Firebase FCM, OneSignal | **Firebase FCM** | æ—¢å­˜Firebaseçµ±åˆ |

### 7.2 PWAè¨­è¨ˆ

```javascript
// Service Workerè¨­å®š
const swConfig = {
  runtimeCaching: [
    {
      urlPattern: /^https:\/\/api\.salon-app\.com\//,
      handler: 'NetworkFirst',
      options: {
        cacheName: 'api-cache',
        expiration: {
          maxEntries: 50,
          maxAgeSeconds: 5 * 60, // 5åˆ†
        },
      },
    },
    {
      urlPattern: /\.(?:png|gif|jpg|jpeg|svg)$/,
      handler: 'CacheFirst',
      options: {
        cacheName: 'image-cache',
        expiration: {
          maxEntries: 100,
          maxAgeSeconds: 30 * 24 * 60 * 60, // 30æ—¥
        },
      },
    },
  ],
  offline: {
    precache: [
      '/',
      '/appointments',
      '/profile',
      '/history',
    ],
    fallback: '/offline.html',
  },
};
```

## 8. ç¾å®¹å®¤ç‰¹åŒ–æ©Ÿèƒ½

### 8.1 æ¥åº—å‰ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆæ©Ÿèƒ½

```javascript
const PreVisitSurvey = {
  salon_id: 'salon_123',
  customer_id: 'customer_456',
  appointment_id: 'apt_789',
  
  questions: [
    {
      type: 'single_choice',
      question: 'ä»Šæ—¥ã®ä½“èª¿ã¯ã„ã‹ãŒã§ã™ã‹ï¼Ÿ',
      options: ['ã¨ã¦ã‚‚è‰¯ã„', 'è‰¯ã„', 'æ™®é€š', 'å°‘ã—æ‚ªã„', 'æ‚ªã„'],
      required: true
    },
    {
      type: 'multiple_choice',
      question: 'ä»Šå›å¸Œæœ›ã™ã‚‹æ–½è¡“ã‚’æ•™ãˆã¦ãã ã•ã„',
      options: ['ã‚«ãƒƒãƒˆ', 'ã‚«ãƒ©ãƒ¼', 'ãƒ‘ãƒ¼ãƒ', 'ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ', 'ãƒ˜ãƒƒãƒ‰ã‚¹ãƒ‘'],
      required: true
    },
    {
      type: 'text',
      question: 'é«ªã®æ‚©ã¿ã‚„è¦æœ›ãŒã‚ã‚Œã°æ•™ãˆã¦ãã ã•ã„',
      max_length: 500,
      required: false
    }
  ],
  
  responses: {},
  submitted_at: null,
  expires_at: new Date(Date.now() + 24*60*60*1000) // 24æ™‚é–“å¾Œ
};
```

### 8.2 æ–½è¡“è¨˜éŒ²ãƒ»å†™çœŸæ©Ÿèƒ½

```javascript
const TreatmentRecord = {
  appointment_id: 'apt_789',
  customer_id: 'customer_456',
  salon_id: 'salon_123',
  
  before_photos: [
    {
      url: 'https://storage.salon.com/before_123.jpg',
      angle: 'front',
      timestamp: new Date()
    }
  ],
  
  after_photos: [
    {
      url: 'https://storage.salon.com/after_123.jpg',
      angle: 'front',
      timestamp: new Date()
    }
  ],
  
  treatments: [
    {
      service: 'ã‚«ãƒƒãƒˆ',
      details: 'ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒƒãƒˆã€å‰é«ªèª¿æ•´',
      products_used: ['ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼A', 'ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆB'],
      duration: 60
    }
  ],
  
  styling_notes: 'ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã®ãƒã‚¤ãƒ³ãƒˆ...',
  next_visit_recommendation: '6-8é€±é–“å¾Œ',
  
  customer_visible: true, // é¡§å®¢ã«è¡¨ç¤ºã™ã‚‹ã‹
  private_notes: 'ã‚¹ã‚¿ãƒƒãƒ•ç”¨ãƒ¡ãƒ¢...' // é¡§å®¢ã«ã¯è¡¨ç¤ºã•ã‚Œãªã„
};
```

### 8.3 ãƒã‚¤ãƒ³ãƒˆãƒ»ç‰¹å…¸ã‚·ã‚¹ãƒ†ãƒ 

```javascript
const LoyaltySystem = {
  point_rules: {
    visit: 100,           // æ¥åº—ã”ã¨
    spend: 0.01,         // 1å†† = 0.01ãƒã‚¤ãƒ³ãƒˆ
    referral: 500,       // ç´¹ä»‹ã”ã¨
    review: 50,          // ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿
    birthday: 1000       // èª•ç”Ÿæœˆ
  },
  
  tier_benefits: {
    regular: {
      point_multiplier: 1.0,
      discount: 0,
      perks: ['èª•ç”Ÿæœˆãƒã‚¤ãƒ³ãƒˆ2å€']
    },
    silver: {
      point_multiplier: 1.2,
      discount: 0.05,
      perks: ['å„ªå…ˆäºˆç´„', 'èª•ç”Ÿæœˆãƒã‚¤ãƒ³ãƒˆ2å€']
    },
    gold: {
      point_multiplier: 1.5,
      discount: 0.10,
      perks: ['å„ªå…ˆäºˆç´„', 'ç„¡æ–™ãƒ‰ãƒªãƒ³ã‚¯', 'èª•ç”Ÿæœˆãƒã‚¤ãƒ³ãƒˆ3å€']
    }
  },
  
  redemption_options: [
    { points: 1000, reward: '500å††å‰²å¼•', type: 'discount' },
    { points: 2000, reward: 'ãƒ˜ãƒƒãƒ‰ã‚¹ãƒ‘ç„¡æ–™', type: 'service' },
    { points: 5000, reward: 'ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆç„¡æ–™', type: 'service' }
  ]
};
```

## 9. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### 9.1 è„…å¨ãƒ¢ãƒ‡ãƒ«

| è„…å¨ | å½±éŸ¿åº¦ | ç¢ºç‡ | å¯¾ç­– |
|------|--------|------|------|
| é¡§å®¢æƒ…å ±æ¼æ´© | é«˜ | ä¸­ | æš—å·åŒ–ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã€ç›£æŸ»ãƒ­ã‚° |
| ä¸æ­£ãƒ­ã‚°ã‚¤ãƒ³ | é«˜ | ä¸­ | MFAã€ãƒ‡ãƒã‚¤ã‚¹èªè¨¼ã€ç•°å¸¸æ¤œçŸ¥ |
| APIã®ä¸æ­£åˆ©ç”¨ | ä¸­ | é«˜ | ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã€APIí‚¤ ç®¡ë¦¬ã€WAF |
| SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ | ä¸­ | ä½ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã€å…¥åŠ›æ¤œè¨¼ |
| XSSæ”»æ’ƒ | ä¸­ | ä¸­ | CSPã€å…¥åŠ›ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ |

### 9.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•Œ

```
ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ
     â†“
  [WAF/CDN]
     â†“
  [Load Balancer]
     â†“
  [API Gateway] â† èªè¨¼ãƒ»èªå¯ãƒ»ãƒ¬ãƒ¼ãƒˆåˆ¶é™
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡§å®¢ã‚µãƒ¼ãƒ“ã‚¹    â”‚    â”‚  ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹    â”‚
â”‚  (Customer)     â”‚    â”‚  (Admin)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹  â”‚    â”‚ ç®¡ç†ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹  â”‚
â”‚ (Read/Write)    â”‚    â”‚ (Admin Only)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3 ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–æˆ¦ç•¥

```javascript
// æš—å·åŒ–ãƒ¬ãƒ™ãƒ«å®šç¾©
const DataClassification = {
  PUBLIC: {
    // ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±ã€å–¶æ¥­æ™‚é–“ç­‰
    encryption: 'none',
    access: 'all'
  },
  
  INTERNAL: {
    // äºˆç´„æƒ…å ±ã€å±¥æ­´ç­‰
    encryption: 'aes-256',
    access: 'authenticated'
  },
  
  CONFIDENTIAL: {
    // å€‹äººæƒ…å ±ã€æ±ºæ¸ˆæƒ…å ±ç­‰
    encryption: 'aes-256',
    hashing: 'argon2',
    access: 'owner_only'
  },
  
  RESTRICTED: {
    // åŒ»ç™‚æƒ…å ±ã€æ©Ÿå¯†äº‹é …ç­‰
    encryption: 'aes-256',
    tokenization: true,
    access: 'staff_only'
  }
};
```

## 10. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ

### 10.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | ç›®æ¨™å€¤ | æ¸¬å®šæ–¹æ³• |
|------------|--------|----------|
| First Contentful Paint | < 1.5ç§’ | Lighthouse |
| Largest Contentful Paint | < 2.5ç§’ | Core Web Vitals |
| Time to Interactive | < 3.0ç§’ | Lighthouse |
| Cumulative Layout Shift | < 0.1 | Core Web Vitals |
| API Response Time | < 200ms | APMç›£è¦– |

### 10.2 æœ€é©åŒ–æˆ¦ç•¥

```javascript
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–è¨­å®š
const PerformanceConfig = {
  // ã‚³ãƒ¼ãƒ‰åˆ†å‰²
  code_splitting: {
    routes: true,        // ãƒ«ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹åˆ†å‰²
    components: true,    // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé…å»¶èª­ã¿è¾¼ã¿
    vendor: true         // ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£åˆ†é›¢
  },
  
  // ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
  caching: {
    static_assets: '365d',   // é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
    api_responses: '5m',     // API ãƒ¬ã‚¹ãƒãƒ³ã‚¹
    images: '30d'           // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«
  },
  
  // ç”»åƒæœ€é©åŒ–
  image_optimization: {
    formats: ['webp', 'avif', 'jpg'],
    sizes: [320, 640, 1024, 1920],
    quality: 85,
    lazy_loading: true
  },
  
  // ãƒãƒ³ãƒ‰ãƒ«æœ€é©åŒ–
  bundle_optimization: {
    tree_shaking: true,
    minification: true,
    compression: 'gzip',
    source_maps: false // production
  }
};
```

ã“ã®è¨­è¨ˆæ›¸ã¯ã€é¡§å®¢å‘ã‘ç¾å®¹å®¤ã‚¢ãƒ—ãƒªã®åŒ…æ‹¬çš„ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€å„æŠ€è¡“é¸å®šã®è©³ç´°ãªæ ¹æ‹ ã¨å®Ÿè£…è¨ˆç”»ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚