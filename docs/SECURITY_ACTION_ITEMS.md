# Supabase ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾å¿œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ 

## ğŸš¨ å„ªå…ˆåº¦ï¼šé«˜ - å³æ™‚å¯¾å¿œå¿…è¦

### 1. âŒ é …ç›®ã®ç¢ºèªã¨å¯¾å¿œ

#### A. Supabase ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã®SQLå®Ÿè¡Œ
1. [Supabase Dashboard](https://app.supabase.com) ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ
3. SQL Editor ã§ä»¥ä¸‹ã‚’é †ç•ªã«å®Ÿè¡Œï¼š
   ```sql
   -- ãƒ•ã‚¡ã‚¤ãƒ«: /salon-light-plan/supabase/migrations/013_security_fixes.sql
   -- ãƒ•ã‚¡ã‚¤ãƒ«: /salon-light-plan/supabase/migrations/014_fix_all_function_search_paths.sql
   ```

#### B. æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ
```sql
-- ãƒ•ã‚¡ã‚¤ãƒ«: /salon-light-plan/supabase/migrations/verify_security_fixes.sql
-- å®Ÿè¡Œå¾Œã€âŒ é …ç›®ã‚’ç¢ºèª
```

### 2. èªè¨¼è¨­å®šã®æ›´æ–°ï¼ˆSupabase Dashboardï¼‰

**å ´æ‰€**: Authentication â†’ Settings

#### å¿…é ˆè¨­å®š:
- [ ] **OTPè¨­å®š**
  - OTP Expiry: `1800` ç§’ï¼ˆ30åˆ†ï¼‰ã«å¤‰æ›´
  
- [ ] **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¦ä»¶**
  - Minimum password length: `8` æ–‡å­—
  - Password character requirements: æœ‰åŠ¹åŒ–
  - Check passwords against breach database (HIBP): æœ‰åŠ¹åŒ–
  
- [ ] **è¿½åŠ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
  - Multi-factor authentication (MFA): æœ‰åŠ¹åŒ–
  - Refresh token rotation: æœ‰åŠ¹åŒ–

### 3. auth_configuration_audit ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ›´æ–°

èªè¨¼è¨­å®šå®Œäº†å¾Œã€ä»¥ä¸‹ã®SQLã‚’å®Ÿè¡Œï¼š

```sql
INSERT INTO auth_configuration_audit (
    config_key,
    expected_value,
    actual_value,
    is_compliant,
    last_checked
) VALUES
    ('otp_expiry', '1800', '1800', true, NOW()),
    ('password_min_length', '8', '8', true, NOW()),
    ('password_hibp_enabled', 'true', 'true', true, NOW()),
    ('mfa_enabled', 'true', 'true', true, NOW()),
    ('refresh_token_rotation', 'true', 'true', true, NOW())
ON CONFLICT (config_key) 
DO UPDATE SET 
    actual_value = EXCLUDED.actual_value,
    is_compliant = EXCLUDED.is_compliant,
    last_checked = NOW();
```

### 4. å®šæœŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ã®è¨­å®š

#### æœˆæ¬¡ã‚¿ã‚¹ã‚¯ï¼ˆæ¯æœˆ1æ—¥å®Ÿæ–½ï¼‰:
1. **è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³**
   ```bash
   npm audit
   npm audit fix
   ```

2. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šç¢ºèª**
   - verify_security_fixes.sql ã‚’å®Ÿè¡Œ
   - auth_configuration_audit ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç¢ºèª

3. **ãƒ­ã‚°ç›£è¦–**
   - èªè¨¼å¤±æ•—ãƒ­ã‚°ã®ç¢ºèª
   - ç•°å¸¸ãªãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¢ºèª

#### å››åŠæœŸã‚¿ã‚¹ã‚¯:
1. **ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ**
2. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®è¦‹ç›´ã—**
3. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒªã‚¹ãƒˆã‚¢ãƒ†ã‚¹ãƒˆ**

## ğŸ“… å®Ÿæ–½ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| ã‚¿ã‚¹ã‚¯ | æœŸé™ | æ‹…å½“è€… | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------|------|--------|------------|
| SQL ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ | å³æ™‚ | - | æœªå®Œäº† |
| èªè¨¼è¨­å®šæ›´æ–° | å³æ™‚ | - | æœªå®Œäº† |
| æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ | è¨­å®šå¾Œ | - | æœªå®Œäº† |
| audit ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–° | è¨­å®šå¾Œ | - | æœªå®Œäº† |
| æœˆæ¬¡ç›£æŸ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š | ä»Šé€±ä¸­ | - | æœªå®Œäº† |

## ğŸ” è¿½åŠ æ¨å¥¨äº‹é …

1. **ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª**
   - æœ¬ç•ªç’°å¢ƒã§å…¨ã¦ã®ç§˜å¯†éµã‚’ç’°å¢ƒå¤‰æ•°ã«ç§»è¡Œ
   - `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `.gitignore` ã«è¿½åŠ 

2. **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**
   - Supabase ã® API ã‚­ãƒ¼ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ3ãƒ¶æœˆæ¯ï¼‰
   - IP ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆè¨­å®šï¼ˆå¯èƒ½ãªå ´åˆï¼‰

3. **ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°**
   - Supabase ã®ãƒ­ã‚°ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨­å®š
   - ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šï¼ˆç•°å¸¸ãƒ­ã‚°ã‚¤ãƒ³æ¤œçŸ¥ï¼‰

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆ:
1. Supabase ã‚µãƒãƒ¼ãƒˆã«é€£çµ¡
2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œæ‰‹é †æ›¸ã‚’å‚ç…§
3. å¿…è¦ã«å¿œã˜ã¦å¤–éƒ¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å°‚é–€å®¶ã«ç›¸è«‡

---

æœ€çµ‚æ›´æ–°: 2025-08-13
æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼äºˆå®š: 2025-09-01