# Salon Lumière - メッセージング統合システム

## 🚀 新機能概要

Salon Lumièreに、Instagram、LINE、メールの3つのチャネルを統合したメッセージング機能を実装しました。

## ✅ 実装済み機能

### 1. 統合メッセージング受信箱
- **マルチチャネル対応**: Instagram、LINE、メールを一元管理
- **リアルタイム受信**: 10秒ごとの自動更新
- **既読管理**: 未読メッセージの自動カウント
- **会話スレッド**: 顧客ごとに会話を整理

### 2. 統合送信機能
- **チャネル自動選択**: 顧客の利用チャネルに自動送信
- **テンプレート機能**: よく使うメッセージをテンプレート化
- **パーソナライズ**: 顧客名などを自動挿入

### 3. キャンペーン管理
- **一斉送信**: 複数の顧客に同時配信
- **ターゲティング**: 条件に基づく顧客抽出
- **スケジュール配信**: 指定日時での自動送信
- **配信分析**: 送信数、開封率などの統計

### 4. 自動配信機能

#### リマインダー機能
- 予約前日の自動リマインド
- 定期メンテナンスのお知らせ
- 誕生日メッセージ

#### キャンペーン配信
- 季節のキャンペーン告知
- 新サービスの案内
- 特別オファーの配信

#### 休業案内
- 定休日・臨時休業の自動通知
- 営業時間変更のお知らせ

#### 再来店促進
- 未来店顧客の自動抽出
- パーソナライズされた再来店メッセージ
- 特別クーポンの配信

## 📱 チャネル別仕様

### Email
- HTML/テキストメール対応
- 件名のカスタマイズ
- 添付ファイル対応（準備中）

### LINE
- LINE Messaging API連携（実装予定）
- リッチメッセージ対応
- スタンプ送信機能

### Instagram
- Instagram Graph API連携（実装予定）
- DM送受信
- 画像・動画メッセージ対応

## 🎯 ターゲティング機能

### 顧客抽出条件
- **最終来店日**: 指定日数以上来店していない顧客
- **来店回数**: 常連客や新規客の抽出
- **タグ**: VIPや特定サービス利用者
- **誕生月**: 誕生日キャンペーン対象者

### 使用例
1. 60日以上来店していない顧客に再来店クーポン
2. 3回以上来店の常連客に特別オファー
3. 誕生月の顧客に誕生日特典

## 💡 テンプレート変数

メッセージ内で使用可能な変数：
- `{{firstName}}` - 名
- `{{lastName}}` - 姓
- `{{fullName}}` - フルネーム
- `{{salonName}}` - サロン名
- `{{lastVisitDate}}` - 最終来店日
- `{{appointmentDate}}` - 予約日
- `{{appointmentTime}}` - 予約時間
- `{{serviceName}}` - サービス名

## 🔧 技術仕様

### データモデル
- **Message**: 個別メッセージの管理
- **Campaign**: キャンペーンの設定と実行
- **MessageTemplate**: メッセージテンプレート

### API エンドポイント
- `GET /api/messages` - メッセージ一覧取得
- `POST /api/messages` - メッセージ送信
- `GET /api/campaigns` - キャンペーン一覧
- `POST /api/campaigns` - キャンペーン作成
- `POST /api/campaigns/:id/send` - キャンペーン実行

## 🚧 今後の実装予定

### API連携
1. **LINE Messaging API**
   - Webhook設定
   - リッチメニュー
   - Flex Message

2. **Instagram Graph API**
   - Business Account連携
   - Story返信
   - メディア共有

3. **メールサーバー**
   - SMTP設定
   - 受信メール処理
   - バウンス処理

### 追加機能
- 自動返信設定
- チャットボット連携
- 配信レポート詳細
- A/Bテスト機能
- 配信最適化AI

## 📊 使用方法

### メッセージング
1. ダッシュボードから「メッセージ」をクリック
2. 会話リストから顧客を選択
3. メッセージを入力して送信

### キャンペーン作成
1. 「キャンペーン」→「新規キャンペーン」
2. 配信タイプとチャネルを選択
3. ターゲット条件を設定
4. メッセージ内容を作成
5. 配信スケジュールを設定

## ⚠️ 注意事項

- 現在はシミュレーションモード
- 実際の外部API連携は未実装
- メッセージはメモリ内保存（再起動でリセット）

## 🎉 まとめ

このメッセージング統合システムにより、顧客とのコミュニケーションが一元化され、効率的なマーケティング活動が可能になります。Instagram、LINE、メールという主要なチャネルをカバーし、顧客の好みに合わせた最適なコミュニケーションを実現します。