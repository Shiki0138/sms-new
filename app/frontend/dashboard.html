<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#f8e5e1">
    <title>Dashboard - Salon Lumière</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main-unified.css?v=20250907">
    <link rel="stylesheet" href="/css/mobile-navigation.css">
    <style>
        /* Page visibility - navigation functionality only */
        .page {
            display: none !important;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .page.active {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        /* Force visibility for debugging */
        .page#customers,
        .page#staff,
        .page#services,
        .page#analytics,
        .page#settings {
            min-height: 100px;
            background: var(--bg-light) !important;
        }
        
        .page#customers.active,
        .page#staff.active,
        .page#services.active,
        .page#analytics.active,
        .page#settings.active {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        /* Smooth animations for better UX */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-card {
            animation: fadeInUp 0.4s ease-out;
            animation-fill-mode: both;
        }

        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.15s; }
        .stat-card:nth-child(3) { animation-delay: 0.2s; }
        .stat-card:nth-child(4) { animation-delay: 0.25s; }

        .schedule-section {
            animation: fadeInUp 0.4s ease-out 0.3s;
            animation-fill-mode: both;
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">メインコンテンツへスキップ</a>
    <button class="mobile-menu-toggle" id="mobileMenuToggle">☰</button>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo-wrapper">✨</div>
            <h2 class="salon-name">Salon Lumière</h2>
            <span class="plan-badge">PREMIUM</span>
        </div>

        <nav class="nav-menu">
            <a href="/dashboard.html" class="nav-item active">
                <span class="nav-icon">🏠</span>
                <span>ホーム</span>
            </a>
            <a href="/appointments.html" class="nav-item">
                <span class="nav-icon">📅</span>
                <span>予約</span>
            </a>
            <a href="/customers.html" class="nav-item">
                <span class="nav-icon">👥</span>
                <span>顧客</span>
            </a>
            <a href="/messages.html" class="nav-item">
                <span class="nav-icon">💬</span>
                <span>連絡</span>
            </a>
            <a href="/reports.html" class="nav-item">
                <span class="nav-icon">📈</span>
                <span>売上</span>
            </a>
            <a href="/settings.html" class="nav-item">
                <span class="nav-icon">⚙️</span>
                <span>設定</span>
            </a>
        </nav>

        <div class="user-section">
            <div class="user-info">
                <div class="user-avatar">管</div>
                <div class="user-details">
                    <div class="user-name">管理者</div>
                    <div class="user-role">Administrator</div>
                </div>
            </div>
            <button class="logout-btn" id="logoutBtn">ログアウト</button>
        </div>
    </aside>

    <main class="main-content" id="main-content">
        <!-- Dashboard Page -->
        <div class="page active" id="dashboard" role="main" aria-label="ダッシュボード">
            <header class="header">
                <h1 class="page-title">こんにちは、素敵な一日を！</h1>
                <div class="header-actions">
                    <button class="icon-button" aria-label="顧客検索" onclick="openSearch()" title="顧客検索">
                        🔍
                    </button>
                    <button class="icon-button" aria-label="通知確認" onclick="openNotifications()" title="新着通知・お知らせ">
                        🔔
                        <span class="notification-badge">3</span>
                    </button>
                    <button class="icon-button" aria-label="新規予約" onclick="openNewBooking()" title="新規予約作成">
                        ➕
                    </button>
                </div>
            </header>

            <!-- メイン表示エリア -->
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <!-- 本日の予約（左側・最上部） -->
                <section class="schedule-section">
                    <div class="section-header">
                        <h2 class="section-title">本日の予約</h2>
                        <a href="/appointments.html" class="view-all-btn">すべて見る →</a>
                    </div>
                    <div class="appointment-list">
                        <div class="appointment-card" onclick="viewAppointmentDetail('apt-001')" style="cursor: pointer;">
                            <div class="time-slot">
                                <div class="time">10:00</div>
                                <div class="duration">90分</div>
                            </div>
                            <div class="appointment-info">
                                <div class="customer-name" onclick="viewCustomerDetail('1')" style="color: var(--primary); text-decoration: underline;">山田 花子 様</div>
                                <div class="service-name">カット + カラー + トリートメント</div>
                            </div>
                            <div class="appointment-status" aria-label="予約確定"></div>
                        </div>

                        <div class="appointment-card" onclick="viewAppointmentDetail('apt-002')" style="cursor: pointer;">
                            <div class="time-slot">
                                <div class="time">13:00</div>
                                <div class="duration">60分</div>
                            </div>
                            <div class="appointment-info">
                                <div class="customer-name" onclick="viewCustomerDetail('2')" style="color: var(--primary); text-decoration: underline;">佐藤 美咲 様</div>
                                <div class="service-name">カット + パーマ</div>
                            </div>
                            <div class="appointment-status" aria-label="予約確定"></div>
                        </div>

                        <div class="appointment-card" onclick="viewAppointmentDetail('apt-003')" style="cursor: pointer;">
                            <div class="time-slot">
                                <div class="time">15:00</div>
                                <div class="duration">120分</div>
                            </div>
                            <div class="appointment-info">
                                <div class="customer-name" onclick="viewCustomerDetail('3')" style="color: var(--primary); text-decoration: underline;">鈴木 真由美 様</div>
                                <div class="service-name">フルコース（カット + カラー + トリートメント + ヘッドスパ）</div>
                            </div>
                            <div class="appointment-status" aria-label="予約確定"></div>
                        </div>
                    </div>
                </section>
                
                <!-- 新着連絡（右側） -->
                <section class="messages-section">
                    <div class="section-header">
                        <h2 class="section-title">新着連絡</h2>
                        <a href="/messages.html" class="view-all-btn">すべて見る →</a>
                    </div>
                    <div class="message-list">
                        <div class="message-card" onclick="viewMessage('msg-001')" style="background: var(--white); border-radius: 12px; padding: 1rem; margin-bottom: 0.5rem; cursor: pointer; box-shadow: var(--shadow-sm);">
                            <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
                                <div style="background: #10b981; color: white; border-radius: 6px; padding: 2px 6px; font-size: 0.7rem;">LINE</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 500; margin-bottom: 0.25rem; font-size: 0.9rem;">田中 さくら 様</div>
                                    <div style="color: var(--text-light); font-size: 0.8rem; line-height: 1.3;">明日の予約時間を30分遅らせていただけますか？</div>
                                    <div style="color: var(--text-light); font-size: 0.7rem; margin-top: 0.25rem;">5分前</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="message-card" onclick="viewMessage('msg-002')" style="background: var(--white); border-radius: 12px; padding: 1rem; margin-bottom: 0.5rem; cursor: pointer; box-shadow: var(--shadow-sm);">
                            <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
                                <div style="background: #f59e0b; color: white; border-radius: 6px; padding: 2px 6px; font-size: 0.7rem;">SMS</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 500; margin-bottom: 0.25rem; font-size: 0.9rem;">高橋 恵子 様</div>
                                    <div style="color: var(--text-light); font-size: 0.8rem; line-height: 1.3;">来週の予約をお願いしたいです</div>
                                    <div style="color: var(--text-light); font-size: 0.7rem; margin-top: 0.25rem;">12分前</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="message-card" onclick="viewMessage('msg-003')" style="background: var(--white); border-radius: 12px; padding: 1rem; cursor: pointer; box-shadow: var(--shadow-sm);">
                            <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
                                <div style="background: #8b5cf6; color: white; border-radius: 6px; padding: 2px 6px; font-size: 0.7rem;">Instagram</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 500; margin-bottom: 0.25rem; font-size: 0.9rem;">吉田 美穂 様</div>
                                    <div style="color: var(--text-light); font-size: 0.8rem; line-height: 1.3;">カラーの色が思ったより暗くて...</div>
                                    <div style="color: var(--text-light); font-size: 0.7rem; margin-top: 0.25rem;">20分前</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

        <!-- 明日の予約 -->
        <section class="schedule-section">
            <div class="section-header">
                <h2 class="section-title">明日の予約</h2>
                <a href="/appointments.html?date=tomorrow" class="view-all-btn">詳細 →</a>
            </div>
            <div class="appointment-list">
                <div class="appointment-card" onclick="viewAppointmentDetail('apt-101')" style="cursor: pointer;">
                    <div class="time-slot">
                        <div class="time">9:30</div>
                        <div class="duration">45分</div>
                    </div>
                    <div class="appointment-info">
                        <div class="customer-name" onclick="viewCustomerDetail('4')" style="color: var(--primary); text-decoration: underline;">中村 恵美 様</div>
                        <div class="service-name">ヘッドスパ</div>
                    </div>
                    <div class="appointment-status" aria-label="予約確定"></div>
                </div>

                <div class="appointment-card" onclick="viewAppointmentDetail('apt-102')" style="cursor: pointer;">
                    <div class="time-slot">
                        <div class="time">11:00</div>
                        <div class="duration">90分</div>
                    </div>
                    <div class="appointment-info">
                        <div class="customer-name" onclick="viewCustomerDetail('5')" style="color: var(--primary); text-decoration: underline;">伊藤 真理 様</div>
                        <div class="service-name">カット + カラー</div>
                    </div>
                    <div class="appointment-status" aria-label="予約確定"></div>
                </div>

                <div class="appointment-card" onclick="viewAppointmentDetail('apt-103')" style="cursor: pointer;">
                    <div class="time-slot">
                        <div class="time">14:00</div>
                        <div class="duration">60分</div>
                    </div>
                    <div class="appointment-info">
                        <div class="customer-name" onclick="viewCustomerDetail('6')" style="color: var(--primary); text-decoration: underline;">新規 様</div>
                        <div class="service-name">カット</div>
                    </div>
                    <div class="appointment-status" aria-label="予約確定"></div>
                </div>
            </div>
        </section>
        </div>

        <!-- Appointments Page -->
        <div class="page" id="appointments">
            <header class="header">
                <h1 class="page-title">予約管理</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" id="addAppointmentBtn">
                        <span>➕ 新規予約</span>
                    </button>
                    <button class="btn btn-secondary" onclick="refreshCalendar()">
                        <span>🔄 更新</span>
                    </button>
                </div>
            </header>
            <div class="content-area">
                <!-- Today's Schedule Overview -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    <!-- Time Slot 1 -->
                    <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border-left: 4px solid #10b981;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--text-dark);">10:00</div>
                            <div style="background: #ecfdf5; color: #065f46; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">確定</div>
                        </div>
                        <h3 style="margin: 0 0 0.5rem 0; color: var(--text-dark);">山田 花子 様</h3>
                        <p style="margin: 0 0 1rem 0; color: var(--text-light); font-size: 0.9rem;">📱 090-1234-5678</p>
                        <div style="background: var(--gray-50); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="font-weight: 500; margin-bottom: 0.5rem;">🎨 カット + カラー + トリートメント</div>
                            <div style="font-size: 0.9rem; color: var(--text-medium);">⏰ 90分 | 💰 ¥12,000 | 👨‍💼 田中スタッフ</div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">📞 連絡</button>
                            <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">✏️ 編集</button>
                        </div>
                    </div>
                    
                    <!-- Time Slot 2 -->
                    <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border-left: 4px solid #3b82f6;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--text-dark);">13:00</div>
                            <div style="background: #dbeafe; color: #1e40af; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">確定</div>
                        </div>
                        <h3 style="margin: 0 0 0.5rem 0; color: var(--text-dark);">佐藤 美咲 様</h3>
                        <p style="margin: 0 0 1rem 0; color: var(--text-light); font-size: 0.9rem;">📱 080-9876-5432</p>
                        <div style="background: var(--gray-50); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="font-weight: 500; margin-bottom: 0.5rem;">🌊 パーマ + トリートメント</div>
                            <div style="font-size: 0.9rem; color: var(--text-medium);">⏰ 120分 | 💰 ¥17,000 | 👨‍💼 佐藤スタッフ</div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">📞 連絡</button>
                            <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">✏️ 編集</button>
                        </div>
                    </div>
                    
                    <!-- Time Slot 3 -->
                    <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border-left: 4px solid #f59e0b;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--text-dark);">15:30</div>
                            <div style="background: #fef3c7; color: #92400e; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">待機</div>
                        </div>
                        <h3 style="margin: 0 0 0.5rem 0; color: var(--text-dark);">高橋 由紀 様</h3>
                        <p style="margin: 0 0 1rem 0; color: var(--text-light); font-size: 0.9rem;">📱 090-3333-4444</p>
                        <div style="background: var(--gray-50); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="font-weight: 500; margin-bottom: 0.5rem;">✂️ カット</div>
                            <div style="font-size: 0.9rem; color: var(--text-medium);">⏰ 60分 | 💰 ¥4,500 | 👨‍💼 山田スタッフ</div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">📞 連絡</button>
                            <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">✏️ 編集</button>
                        </div>
                    </div>
                </div>
                
                <!-- Weekly Calendar View -->
                <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="margin: 0; color: var(--text-dark);">📅 今週の予約状況</h2>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary">← 前週</button>
                            <button class="btn btn-secondary">次週 →</button>
                        </div>
                    </div>
                    
                    <!-- Calendar Grid -->
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: var(--gray-200); border-radius: 8px; overflow: hidden;">
                        <!-- Day Headers -->
                        <div style="background: var(--primary); color: white; padding: 1rem; text-align: center; font-weight: 500;">月</div>
                        <div style="background: var(--primary); color: white; padding: 1rem; text-align: center; font-weight: 500;">火</div>
                        <div style="background: var(--primary); color: white; padding: 1rem; text-align: center; font-weight: 500;">水</div>
                        <div style="background: var(--primary); color: white; padding: 1rem; text-align: center; font-weight: 500;">木</div>
                        <div style="background: var(--primary); color: white; padding: 1rem; text-align: center; font-weight: 500;">金</div>
                        <div style="background: var(--primary); color: white; padding: 1rem; text-align: center; font-weight: 500;">土</div>
                        <div style="background: var(--gray-400); color: white; padding: 1rem; text-align: center; font-weight: 500;">日</div>
                        
                        <!-- Day Cells -->
                        <div style="background: var(--white); padding: 0.75rem; min-height: 120px;">
                            <div style="font-weight: bold; margin-bottom: 0.5rem;">11</div>
                            <div style="font-size: 0.8rem; background: #ecfdf5; color: #065f46; padding: 2px 6px; border-radius: 4px; margin-bottom: 2px;">10:00 山田様</div>
                            <div style="font-size: 0.8rem; background: #dbeafe; color: #1e40af; padding: 2px 6px; border-radius: 4px;">15:00 田中様</div>
                        </div>
                        <div style="background: var(--white); padding: 0.75rem; min-height: 120px;">
                            <div style="font-weight: bold; margin-bottom: 0.5rem;">12</div>
                            <div style="font-size: 0.8rem; background: #fef3c7; color: #92400e; padding: 2px 6px; border-radius: 4px; margin-bottom: 2px;">11:00 佐藤様</div>
                        </div>
                        <div style="background: var(--white); padding: 0.75rem; min-height: 120px;">
                            <div style="font-weight: bold; margin-bottom: 0.5rem;">13</div>
                            <div style="font-size: 0.8rem; background: #ecfdf5; color: #065f46; padding: 2px 6px; border-radius: 4px;">14:00 鈴木様</div>
                        </div>
                        <div style="background: var(--white); padding: 0.75rem; min-height: 120px;">
                            <div style="font-weight: bold; margin-bottom: 0.5rem; color: var(--primary);">14</div>
                            <div style="font-size: 0.8rem; background: #ecfdf5; color: #065f46; padding: 2px 6px; border-radius: 4px; margin-bottom: 2px;">10:00 山田様</div>
                            <div style="font-size: 0.8rem; background: #dbeafe; color: #1e40af; padding: 2px 6px; border-radius: 4px; margin-bottom: 2px;">13:00 佐藤様</div>
                            <div style="font-size: 0.8rem; background: #fef3c7; color: #92400e; padding: 2px 6px; border-radius: 4px;">15:30 高橋様</div>
                        </div>
                        <div style="background: var(--white); padding: 0.75rem; min-height: 120px;">
                            <div style="font-weight: bold; margin-bottom: 0.5rem;">15</div>
                            <div style="font-size: 0.8rem; background: #dbeafe; color: #1e40af; padding: 2px 6px; border-radius: 4px;">09:30 中村様</div>
                        </div>
                        <div style="background: var(--white); padding: 0.75rem; min-height: 120px;">
                            <div style="font-weight: bold; margin-bottom: 0.5rem;">16</div>
                            <div style="font-size: 0.8rem; background: #ecfdf5; color: #065f46; padding: 2px 6px; border-radius: 4px; margin-bottom: 2px;">10:00 新規様</div>
                            <div style="font-size: 0.8rem; background: #fef3c7; color: #92400e; padding: 2px 6px; border-radius: 4px;">14:00 伊藤様</div>
                        </div>
                        <div style="background: var(--gray-100); padding: 0.75rem; min-height: 120px;">
                            <div style="font-weight: bold; margin-bottom: 0.5rem; color: var(--text-light);">17</div>
                            <div style="font-size: 0.8rem; color: var(--text-light);">定休日</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Messages Page -->
        <div class="page" id="messages">
            <header class="header" style="background: var(--gradient-1); border-radius: 12px; margin-bottom: 1.5rem; box-shadow: var(--shadow-sm);">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div style="background: var(--primary); border-radius: 12px; padding: 12px; color: white; font-size: 1.5rem;">💬</div>
                    <div>
                        <h1 class="page-title" style="margin: 0; color: var(--text-dark);">メッセージ送信</h1>
                        <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">お客様へのメッセージを送信・管理</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" id="historyBtn" style="display: flex; align-items: center; gap: 0.5rem;">
                        <span>📋</span>
                        送信履歴
                    </button>
                    <button class="btn btn-primary" id="quickSendBtn" style="display: flex; align-items: center; gap: 0.5rem;">
                        <span>⚡</span>
                        かんたん送信
                    </button>
                </div>
            </header>
            
            <div class="content-area">
                <!-- Quick Action Cards -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div class="quick-action-card" onclick="selectQuickAction('reminder')" style="
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 1.5rem;
                        border-radius: 16px;
                        cursor: pointer;
                        transition: transform 0.2s;
                        box-shadow: var(--shadow-md);
                    ">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">📅</div>
                        <h3 style="margin: 0 0 0.5rem 0; font-size: 1.1rem;">予約リマインダー</h3>
                        <p style="margin: 0; opacity: 0.9; font-size: 0.9rem;">明日の予約のお客様にリマインド</p>
                    </div>
                    
                    <div class="quick-action-card" onclick="selectQuickAction('thanks')" style="
                        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                        color: white;
                        padding: 1.5rem;
                        border-radius: 16px;
                        cursor: pointer;
                        transition: transform 0.2s;
                        box-shadow: var(--shadow-md);
                    ">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">🙏</div>
                        <h3 style="margin: 0 0 0.5rem 0; font-size: 1.1rem;">来店お礼</h3>
                        <p style="margin: 0; opacity: 0.9; font-size: 0.9rem;">今日来店されたお客様にお礼</p>
                    </div>
                    
                    <div class="quick-action-card" onclick="selectQuickAction('followup')" style="
                        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                        color: white;
                        padding: 1.5rem;
                        border-radius: 16px;
                        cursor: pointer;
                        transition: transform 0.2s;
                        box-shadow: var(--shadow-md);
                    ">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">💫</div>
                        <h3 style="margin: 0 0 0.5rem 0; font-size: 1.1rem;">アフターフォロー</h3>
                        <p style="margin: 0; opacity: 0.9; font-size: 0.9rem;">施術後のお客様にフォローアップ</p>
                    </div>
                </div>

                <!-- Main Message Compose Area -->
                <div class="message-compose-area" style="
                    background: var(--white);
                    border-radius: 16px;
                    box-shadow: var(--shadow-md);
                    overflow: hidden;
                    border: 1px solid var(--border-color);
                ">

                <!-- Step-by-Step Message Creation -->
                <div class="message-creation-steps">
                    <!-- Step 1: Customer Selection -->
                    <div class="step-section active" id="step-customer-dashboard" style="padding: 2rem;">
                        <div class="step-header" style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                            <div style="background: var(--primary); color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold;">1</div>
                            <div>
                                <h2 style="margin: 0; color: var(--text-dark); font-size: 1.3rem;">送信先のお客様を選択</h2>
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">メッセージを送信するお客様を選んでください</p>
                            </div>
                        </div>
                        
                        <!-- Customer Search -->
                        <div style="margin-bottom: 1.5rem;">
                            <div style="position: relative;">
                                <input type="text" id="customerSearchDashboard" placeholder="お客様名または電話番号で検索..." style="
                                    width: 100%;
                                    padding: 1rem 1rem 1rem 3rem;
                                    border: 2px solid var(--border-color);
                                    border-radius: 12px;
                                    font-size: 1rem;
                                    transition: border-color 0.2s;
                                ">
                                <div style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-light); font-size: 1.2rem;">🔍</div>
                            </div>
                        </div>
                        
                        <!-- Customer Cards -->
                        <div class="customer-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div class="customer-card" onclick="selectCustomerDashboard('1')" style="
                                background: var(--white);
                                border: 2px solid var(--border-color);
                                border-radius: 12px;
                                padding: 1.5rem;
                                cursor: pointer;
                                transition: all 0.2s;
                                box-shadow: var(--shadow-sm);
                            ">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="width: 60px; height: 60px; background: var(--gradient-2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">山</div>
                                    <div style="flex: 1;">
                                        <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">山田 花子 様</h3>
                                        <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">📱 090-1234-5678</p>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; color: var(--text-light);">
                                    <span>💅 最終来店: 2024/03/10</span>
                                    <span>🎨 カット+カラー</span>
                                </div>
                            </div>
                            
                            <div class="customer-card" onclick="selectCustomerDashboard('2')" style="
                                background: var(--white);
                                border: 2px solid var(--border-color);
                                border-radius: 12px;
                                padding: 1.5rem;
                                cursor: pointer;
                                transition: all 0.2s;
                                box-shadow: var(--shadow-sm);
                            ">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="width: 60px; height: 60px; background: var(--gradient-2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">佐</div>
                                    <div style="flex: 1;">
                                        <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">佐藤 美咲 様</h3>
                                        <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">📱 080-9876-5432</p>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; color: var(--text-light);">
                                    <span>💅 最終来店: 2024/03/08</span>
                                    <span>🌊 パーマ+トリートメント</span>
                                </div>
                            </div>
                            
                            <div class="customer-card" onclick="selectCustomerDashboard('3')" style="
                                background: var(--white);
                                border: 2px solid var(--border-color);
                                border-radius: 12px;
                                padding: 1.5rem;
                                cursor: pointer;
                                transition: all 0.2s;
                                box-shadow: var(--shadow-sm);
                            ">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="width: 60px; height: 60px; background: var(--gradient-2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">鈴</div>
                                    <div style="flex: 1;">
                                        <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">鈴木 真由美 様</h3>
                                        <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">📱 070-1111-2222</p>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; color: var(--text-light);">
                                    <span>💅 最終来店: 2024/03/05</span>
                                    <span>💆 ヘッドスパ+トリートメント</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-primary" id="nextToTemplateDashboard" style="
                                padding: 1rem 2rem;
                                font-size: 1rem;
                                border-radius: 12px;
                                display: inline-flex;
                                align-items: center;
                                gap: 0.5rem;
                            " disabled>
                                次へ：メッセージ作成 <span>→</span>
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Template Selection -->
                    <div class="step-section" id="step-template-dashboard" style="padding: 2rem; display: none;">
                        <div class="step-header" style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                            <div style="background: var(--primary); color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold;">2</div>
                            <div>
                                <h2 style="margin: 0; color: var(--text-dark); font-size: 1.3rem;">メッセージテンプレートを選択</h2>
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">用途に合わせてテンプレートを選んでください</p>
                            </div>
                        </div>
                        
                        <!-- Template Cards -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                            <div class="template-card" onclick="selectTemplateDashboard('reminder')" style="
                                background: var(--white);
                                border: 2px solid var(--border-color);
                                border-radius: 12px;
                                padding: 1.5rem;
                                cursor: pointer;
                                transition: all 0.2s;
                                box-shadow: var(--shadow-sm);
                            ">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 12px; font-size: 1.5rem;">📅</div>
                                    <div>
                                        <h3 style="margin: 0; color: var(--text-dark); font-size: 1.1rem;">予約リマインダー</h3>
                                        <p style="margin: 0; color: var(--text-light); font-size: 0.85rem;">明日の予約確認</p>
                                    </div>
                                </div>
                                <div style="background: var(--gray-50); border-radius: 8px; padding: 1rem; font-size: 0.9rem; color: var(--text-medium); line-height: 1.4;">
                                    "{customer_name}様、明日{date} {time}からのご予約を確認いたします。カット+カラーでお待ちしております。変更がございましたらお気軽にご連絡ください。"
                                </div>
                            </div>
                            
                            <div class="template-card" onclick="selectTemplateDashboard('thanks')" style="
                                background: var(--white);
                                border: 2px solid var(--border-color);
                                border-radius: 12px;
                                padding: 1.5rem;
                                cursor: pointer;
                                transition: all 0.2s;
                                box-shadow: var(--shadow-sm);
                            ">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; padding: 12px; font-size: 1.5rem;">🙏</div>
                                    <div>
                                        <h3 style="margin: 0; color: var(--text-dark); font-size: 1.1rem;">来店お礼</h3>
                                        <p style="margin: 0; color: var(--text-light); font-size: 0.85rem;">本日のご来店に感謝</p>
                                    </div>
                                </div>
                                <div style="background: var(--gray-50); border-radius: 8px; padding: 1rem; font-size: 0.9rem; color: var(--text-medium); line-height: 1.4;">
                                    "{customer_name}様、本日はご来店ありがとうございました。{service}の仕上がりはいかがでしょうか？またのお越しをお待ちしております。"
                                </div>
                            </div>
                            
                            <div class="template-card" onclick="selectTemplateDashboard('followup')" style="
                                background: var(--white);
                                border: 2px solid var(--border-color);
                                border-radius: 12px;
                                padding: 1.5rem;
                                cursor: pointer;
                                transition: all 0.2s;
                                box-shadow: var(--shadow-sm);
                            ">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 12px; padding: 12px; font-size: 1.5rem;">💫</div>
                                    <div>
                                        <h3 style="margin: 0; color: var(--text-dark); font-size: 1.1rem;">アフターフォロー</h3>
                                        <p style="margin: 0; color: var(--text-light); font-size: 0.85rem;">施術後のフォローアップ</p>
                                    </div>
                                </div>
                                <div style="background: var(--gray-50); border-radius: 8px; padding: 1rem; font-size: 0.9rem; color: var(--text-medium); line-height: 1.4;">
                                    "{customer_name}様、先日は{service}をご利用いただきありがとうございました。髪の調子はいかがですか？何かご質問がございましたらお気軽にご連絡ください。"
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <button class="btn btn-secondary" onclick="goBackToCustomerDashboard()" style="display: inline-flex; align-items: center; gap: 0.5rem;">
                                <span>←</span> 戻る
                            </button>
                            <button class="btn btn-primary" id="nextToComposeDashboard" style="
                                padding: 1rem 2rem;
                                font-size: 1rem;
                                border-radius: 12px;
                                display: inline-flex;
                                align-items: center;
                                gap: 0.5rem;
                            " disabled>
                                次へ：メッセージ編集 <span>→</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 3: Compose & Send -->
                    <div class="step-section" id="step-compose-dashboard" style="padding: 2rem; display: none;">
                        <div class="step-header" style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                            <div style="background: var(--primary); color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold;">3</div>
                            <div>
                                <h2 style="margin: 0; color: var(--text-dark); font-size: 1.3rem;">メッセージを確認・送信</h2>
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">内容を確認して送信してください</p>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 300px; gap: 2rem;">
                            <!-- Message Edit Area -->
                            <div>
                                <div style="margin-bottom: 1.5rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-dark);">メッセージ内容</label>
                                    <textarea id="messageContentDashboard" placeholder="メッセージを入力してください..." style="
                                        width: 100%;
                                        min-height: 120px;
                                        padding: 1rem;
                                        border: 2px solid var(--border-color);
                                        border-radius: 12px;
                                        font-size: 1rem;
                                        font-family: var(--font-family-primary);
                                        resize: vertical;
                                        transition: border-color 0.2s;
                                    " maxlength="160"></textarea>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-light);">
                                        <span>💡 {customer_name}, {date}, {time}, {service} が使用できます</span>
                                        <span id="charCountDashboard">0/160文字</span>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 1.5rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-dark);">送信タイミング</label>
                                    <div style="display: flex; gap: 1rem;">
                                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1rem; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; background: var(--white);">
                                            <input type="radio" name="sendTimingDashboard" value="now" checked>
                                            <span>⚡ 今すぐ送信</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1rem; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; background: var(--white);">
                                            <input type="radio" name="sendTimingDashboard" value="schedule">
                                            <span>⏰ 予約送信</span>
                                        </label>
                                    </div>
                                    <div id="scheduleInputDashboard" style="display: none; margin-top: 1rem;">
                                        <input type="datetime-local" id="scheduleTimeDashboard" style="
                                            padding: 0.75rem;
                                            border: 2px solid var(--border-color);
                                            border-radius: 8px;
                                            font-size: 1rem;
                                        ">
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: 1rem;">
                                    <button class="btn btn-secondary" onclick="goBackToTemplateDashboard()" style="display: inline-flex; align-items: center; gap: 0.5rem;">
                                        <span>←</span> 戻る
                                    </button>
                                    <button class="btn btn-secondary" id="saveDraftBtnDashboard" style="display: inline-flex; align-items: center; gap: 0.5rem;">
                                        <span>💾</span> 下書き保存
                                    </button>
                                    <button class="btn btn-primary" id="sendMessageBtnDashboard" style="
                                        flex: 1;
                                        padding: 1rem 2rem;
                                        font-size: 1rem;
                                        border-radius: 12px;
                                        display: inline-flex;
                                        align-items: center;
                                        justify-content: center;
                                        gap: 0.5rem;
                                    ">
                                        <span>📱</span> 送信する
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Preview Area -->
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-dark);">プレビュー</label>
                                <div style="
                                    background: var(--gray-900);
                                    border-radius: 24px;
                                    padding: 1.5rem;
                                    color: white;
                                    position: relative;
                                    margin-bottom: 1rem;
                                ">
                                    <div style="background: var(--primary); border-radius: 18px; padding: 1rem; margin-bottom: 1rem;">
                                        <div style="font-weight: 500; margin-bottom: 0.5rem;">Salon Lumière</div>
                                        <div id="previewContentDashboard" style="line-height: 1.4; font-size: 0.95rem;">
                                            メッセージを入力するとプレビューが表示されます
                                        </div>
                                        <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.5rem;" id="previewTimeDashboard">今</div>
                                    </div>
                                    
                                    <!-- Selected Customer Info -->
                                    <div id="selectedCustomerInfoDashboard" style="
                                        background: rgba(255,255,255,0.1);
                                        border-radius: 12px;
                                        padding: 1rem;
                                        font-size: 0.9rem;
                                    ">
                                        <div style="font-weight: 500; margin-bottom: 0.5rem;">送信先</div>
                                        <div id="selectedCustomerDisplayDashboard">顧客を選択してください</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Staff Page -->
        <div class="page" id="staff">
            <header class="header">
                <h1 class="page-title">👨‍💼 スタッフ管理</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" id="addStaffBtn">
                        <span>➕ 新規スタッフ追加</span>
                    </button>
                    <button class="btn btn-secondary" onclick="exportStaffData()">
                        <span>📊 データ出力</span>
                    </button>
                </div>
            </header>
            
            <div class="content-area">
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
                    <!-- Staff Card 1 -->
                    <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color);">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="width: 60px; height: 60px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">田</div>
                            <div style="flex: 1;">
                                <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">田中 美穂</h3>
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">シニアスタッフ</p>
                            </div>
                            <div style="color: #10b981; background: #ecfdf5; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">在席中</div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem; font-size: 0.9rem;">
                            <div><strong>📱 電話:</strong> 080-1234-5678</div>
                            <div><strong>💼 勤務歴:</strong> 5年</div>
                            <div><strong>⭐ 評価:</strong> 4.8/5.0</div>
                            <div><strong>📅 今月:</strong> 85件</div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">スケジュール</button>
                            <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">詳細・編集</button>
                        </div>
                    </div>
                    
                    <!-- Staff Card 2 -->
                    <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color);">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="width: 60px; height: 60px; background: var(--secondary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">佐</div>
                            <div style="flex: 1;">
                                <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">佐藤 健太</h3>
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">スタッフ</p>
                            </div>
                            <div style="color: #f59e0b; background: #fef3c7; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">休憩中</div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem; font-size: 0.9rem;">
                            <div><strong>📱 電話:</strong> 090-9876-5432</div>
                            <div><strong>💼 勤務歴:</strong> 3年</div>
                            <div><strong>⭐ 評価:</strong> 4.6/5.0</div>
                            <div><strong>📅 今月:</strong> 68件</div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">スケジュール</button>
                            <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">詳細・編集</button>
                        </div>
                    </div>
                    
                    <!-- Staff Card 3 -->
                    <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color);">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="width: 60px; height: 60px; background: var(--gradient-2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">山</div>
                            <div style="flex: 1;">
                                <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">山田 さやか</h3>
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">スタッフ</p>
                            </div>
                            <div style="color: #ef4444; background: #fee2e2; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">休日</div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem; font-size: 0.9rem;">
                            <div><strong>📱 電話:</strong> 070-5555-1111</div>
                            <div><strong>💼 勤務歴:</strong> 2年</div>
                            <div><strong>⭐ 評価:</strong> 4.5/5.0</div>
                            <div><strong>📅 今月:</strong> 55件</div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">スケジュール</button>
                            <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">詳細・編集</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Services Page -->
        <div class="page" id="services">
            <header class="header">
                <h1 class="page-title">✂️ サービス管理</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" id="addServiceBtn">
                        <span>➕ 新規サービス追加</span>
                    </button>
                    <button class="btn btn-secondary" onclick="exportServiceData()">
                        <span>📊 メニュー出力</span>
                    </button>
                </div>
            </header>
            
            <div class="content-area">
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem;">
                    <!-- Service Card 1 -->
                    <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color);">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 12px; font-size: 1.5rem;">✂️</div>
                            <div style="flex: 1;">
                                <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">カット</h3>
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">基本コース</p>
                            </div>
                            <div style="color: var(--primary); font-weight: bold; font-size: 1.1rem;">¥4,500</div>
                        </div>
                        <div style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-medium);">
                            <p style="margin: 0;">⏰ 所要時間: 60分</p>
                            <p style="margin: 0.25rem 0 0 0;">📊 今月実績: 134件</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">統計</button>
                            <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">編集</button>
                        </div>
                    </div>
                    
                    <!-- Service Card 2 -->
                    <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color);">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; padding: 12px; font-size: 1.5rem;">🎨</div>
                            <div style="flex: 1;">
                                <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">カラー</h3>
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">染髪・ブリーチ</p>
                            </div>
                            <div style="color: var(--primary); font-weight: bold; font-size: 1.1rem;">¥8,000</div>
                        </div>
                        <div style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-medium);">
                            <p style="margin: 0;">⏰ 所要時間: 90分</p>
                            <p style="margin: 0.25rem 0 0 0;">📊 今月実績: 89件</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">統計</button>
                            <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">編集</button>
                        </div>
                    </div>
                    
                    <!-- Service Card 3 -->
                    <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color);">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 12px; padding: 12px; font-size: 1.5rem;">🌊</div>
                            <div style="flex: 1;">
                                <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">パーマ</h3>
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">デジタル・コールド</p>
                            </div>
                            <div style="color: var(--primary); font-weight: bold; font-size: 1.1rem;">¥12,000</div>
                        </div>
                        <div style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-medium);">
                            <p style="margin: 0;">⏰ 所要時間: 120分</p>
                            <p style="margin: 0.25rem 0 0 0;">📊 今月実績: 45件</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">統計</button>
                            <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">編集</button>
                        </div>
                    </div>
                    
                    <!-- Service Card 4 -->
                    <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color);">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); border-radius: 12px; padding: 12px; font-size: 1.5rem;">💆</div>
                            <div style="flex: 1;">
                                <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">ヘッドスパ</h3>
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">リラクゼーション</p>
                            </div>
                            <div style="color: var(--primary); font-weight: bold; font-size: 1.1rem;">¥6,000</div>
                        </div>
                        <div style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-medium);">
                            <p style="margin: 0;">⏰ 所要時間: 45分</p>
                            <p style="margin: 0.25rem 0 0 0;">📊 今月実績: 67件</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">統計</button>
                            <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">編集</button>
                        </div>
                    </div>
                    
                    <!-- Service Card 5 -->
                    <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color);">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); border-radius: 12px; padding: 12px; font-size: 1.5rem;">✨</div>
                            <div style="flex: 1;">
                                <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">トリートメント</h3>
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">毛髪補修・保湿</p>
                            </div>
                            <div style="color: var(--primary); font-weight: bold; font-size: 1.1rem;">¥5,000</div>
                        </div>
                        <div style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-medium);">
                            <p style="margin: 0;">⏰ 所要時間: 30分</p>
                            <p style="margin: 0.25rem 0 0 0;">📊 今月実績: 78件</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">統計</button>
                            <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">編集</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Page -->
        <div class="page" id="analytics">
            <header class="header">
                <h1 class="page-title">分析・レポート</h1>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="exportReport()">
                        <span class="nav-icon">📊</span>
                        レポート出力
                    </button>
                    <select id="analyticsDateRange" onchange="updateAnalytics()" style="padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
                        <option value="7">過去7日</option>
                        <option value="30" selected>過去30日</option>
                        <option value="90">過去3ヶ月</option>
                        <option value="365">過去1年</option>
                    </select>
                </div>
            </header>
            
            <div class="content-area">
                <!-- KPI Cards -->
                <div class="analytics-kpis" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    <div class="kpi-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 16px;">
                        <div class="kpi-icon" style="font-size: 2rem; margin-bottom: 0.5rem;">💰</div>
                        <div class="kpi-value" id="totalRevenue" style="font-size: 2rem; font-weight: bold;">¥485,000</div>
                        <div class="kpi-label" style="opacity: 0.9;">総売上</div>
                        <div class="kpi-change" style="font-size: 0.9rem; margin-top: 0.5rem;">
                            <span style="color: #4ade80;">↗️ +12.5%</span> 前月比
                        </div>
                    </div>
                    
                    <div class="kpi-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 1.5rem; border-radius: 16px;">
                        <div class="kpi-icon" style="font-size: 2rem; margin-bottom: 0.5rem;">👥</div>
                        <div class="kpi-value" id="totalCustomers" style="font-size: 2rem; font-weight: bold;">156</div>
                        <div class="kpi-label" style="opacity: 0.9;">総顧客数</div>
                        <div class="kpi-change" style="font-size: 0.9rem; margin-top: 0.5rem;">
                            <span style="color: #4ade80;">↗️ +8</span> 新規顧客
                        </div>
                    </div>
                    
                    <div class="kpi-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 1.5rem; border-radius: 16px;">
                        <div class="kpi-icon" style="font-size: 2rem; margin-bottom: 0.5rem;">📅</div>
                        <div class="kpi-value" id="totalAppointments" style="font-size: 2rem; font-weight: bold;">89</div>
                        <div class="kpi-label" style="opacity: 0.9;">総予約数</div>
                        <div class="kpi-change" style="font-size: 0.9rem; margin-top: 0.5rem;">
                            <span style="color: #4ade80;">↗️ +15%</span> 前月比
                        </div>
                    </div>
                    
                    <div class="kpi-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; padding: 1.5rem; border-radius: 16px;">
                        <div class="kpi-icon" style="font-size: 2rem; margin-bottom: 0.5rem;">⭐</div>
                        <div class="kpi-value" id="avgRating" style="font-size: 2rem; font-weight: bold;">4.8</div>
                        <div class="kpi-label" style="opacity: 0.9;">平均満足度</div>
                        <div class="kpi-change" style="font-size: 0.9rem; margin-top: 0.5rem;">
                            <span style="color: #4ade80;">↗️ +0.2</span> 前月比
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="charts-row" style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                    <div class="chart-container" style="background: white; padding: 1.5rem; border-radius: 16px; box-shadow: var(--shadow-md);">
                        <h3 style="margin-bottom: 1rem; color: var(--text-dark);">売上推移</h3>
                        <canvas id="revenueChart" width="400" height="200"></canvas>
                    </div>
                    
                    <div class="chart-container" style="background: white; padding: 1.5rem; border-radius: 16px; box-shadow: var(--shadow-md);">
                        <h3 style="margin-bottom: 1rem; color: var(--text-dark);">サービス別売上</h3>
                        <canvas id="serviceChart" width="300" height="200"></canvas>
                    </div>
                </div>

                <!-- Analytics Tables -->
                <div class="analytics-tables" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div class="analytics-table" style="background: white; border-radius: 16px; box-shadow: var(--shadow-md); overflow: hidden;">
                        <div class="table-header" style="padding: 1rem 1.5rem; background: var(--gradient-1); border-bottom: 1px solid #e2e8f0;">
                            <h3 style="margin: 0; color: var(--text-dark);">人気サービスランキング</h3>
                        </div>
                        <div class="table-body" style="padding: 0;">
                            <div class="service-rank-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; border-bottom: 1px solid #f1f5f9;">
                                <div class="rank-info">
                                    <span class="rank-number" style="display: inline-block; width: 24px; height: 24px; background: #fbbf24; color: white; border-radius: 50%; text-align: center; line-height: 24px; font-size: 0.8rem; font-weight: bold; margin-right: 0.5rem;">1</span>
                                    <span class="service-name" style="font-weight: 500;">カット + カラー</span>
                                </div>
                                <div class="service-stats" style="text-align: right;">
                                    <div class="service-count" style="font-weight: bold; color: var(--primary);">34件</div>
                                    <div class="service-revenue" style="font-size: 0.9rem; color: #666;">¥272,000</div>
                                </div>
                            </div>
                            
                            <div class="service-rank-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; border-bottom: 1px solid #f1f5f9;">
                                <div class="rank-info">
                                    <span class="rank-number" style="display: inline-block; width: 24px; height: 24px; background: #9ca3af; color: white; border-radius: 50%; text-align: center; line-height: 24px; font-size: 0.8rem; font-weight: bold; margin-right: 0.5rem;">2</span>
                                    <span class="service-name" style="font-weight: 500;">カット</span>
                                </div>
                                <div class="service-stats" style="text-align: right;">
                                    <div class="service-count" style="font-weight: bold; color: var(--primary);">28件</div>
                                    <div class="service-revenue" style="font-size: 0.9rem; color: #666;">¥112,000</div>
                                </div>
                            </div>
                            
                            <div class="service-rank-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; border-bottom: 1px solid #f1f5f9;">
                                <div class="rank-info">
                                    <span class="rank-number" style="display: inline-block; width: 24px; height: 24px; background: #cd7f32; color: white; border-radius: 50%; text-align: center; line-height: 24px; font-size: 0.8rem; font-weight: bold; margin-right: 0.5rem;">3</span>
                                    <span class="service-name" style="font-weight: 500;">トリートメント</span>
                                </div>
                                <div class="service-stats" style="text-align: right;">
                                    <div class="service-count" style="font-weight: bold; color: var(--primary);">18件</div>
                                    <div class="service-revenue" style="font-size: 0.9rem; color: #666;">¥90,000</div>
                                </div>
                            </div>

                            <div class="service-rank-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; border-bottom: 1px solid #f1f5f9;">
                                <div class="rank-info">
                                    <span class="rank-number" style="display: inline-block; width: 24px; height: 24px; background: #6b7280; color: white; border-radius: 50%; text-align: center; line-height: 24px; font-size: 0.8rem; font-weight: bold; margin-right: 0.5rem;">4</span>
                                    <span class="service-name" style="font-weight: 500;">パーマ</span>
                                </div>
                                <div class="service-stats" style="text-align: right;">
                                    <div class="service-count" style="font-weight: bold; color: var(--primary);">15件</div>
                                    <div class="service-revenue" style="font-size: 0.9rem; color: #666;">¥105,000</div>
                                </div>
                            </div>

                            <div class="service-rank-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem;">
                                <div class="rank-info">
                                    <span class="rank-number" style="display: inline-block; width: 24px; height: 24px; background: #9ca3af; color: white; border-radius: 50%; text-align: center; line-height: 24px; font-size: 0.8rem; font-weight: bold; margin-right: 0.5rem;">5</span>
                                    <span class="service-name" style="font-weight: 500;">ヘッドスパ</span>
                                </div>
                                <div class="service-stats" style="text-align: right;">
                                    <div class="service-count" style="font-weight: bold; color: var(--primary);">12件</div>
                                    <div class="service-revenue" style="font-size: 0.9rem; color: #666;">¥72,000</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="analytics-table" style="background: white; border-radius: 16px; box-shadow: var(--shadow-md); overflow: hidden;">
                        <div class="table-header" style="padding: 1rem 1.5rem; background: var(--gradient-1); border-bottom: 1px solid #e2e8f0;">
                            <h3 style="margin: 0; color: var(--text-dark);">スタッフ別パフォーマンス</h3>
                        </div>
                        <div class="table-body" style="padding: 0;">
                            <div class="staff-performance-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; border-bottom: 1px solid #f1f5f9;">
                                <div class="staff-info">
                                    <div class="staff-name" style="font-weight: 500;">田中 美穂</div>
                                    <div class="staff-role" style="font-size: 0.9rem; color: #666;">シニアスタッフ</div>
                                </div>
                                <div class="staff-stats" style="text-align: right;">
                                    <div class="staff-appointments" style="font-weight: bold; color: var(--primary);">42件</div>
                                    <div class="staff-revenue" style="font-size: 0.9rem; color: #666;">¥210,000</div>
                                </div>
                            </div>
                            
                            <div class="staff-performance-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; border-bottom: 1px solid #f1f5f9;">
                                <div class="staff-info">
                                    <div class="staff-name" style="font-weight: 500;">佐藤 健太</div>
                                    <div class="staff-role" style="font-size: 0.9rem; color: #666;">スタッフ</div>
                                </div>
                                <div class="staff-stats" style="text-align: right;">
                                    <div class="staff-appointments" style="font-weight: bold; color: var(--primary);">35件</div>
                                    <div class="staff-revenue" style="font-size: 0.9rem; color: #666;">¥175,000</div>
                                </div>
                            </div>
                            
                            <div class="staff-performance-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem;">
                                <div class="staff-info">
                                    <div class="staff-name" style="font-weight: 500;">山田 さやか</div>
                                    <div class="staff-role" style="font-size: 0.9rem; color: #666;">スタッフ</div>
                                </div>
                                <div class="staff-stats" style="text-align: right;">
                                    <div class="staff-appointments" style="font-weight: bold; color: var(--primary);">29件</div>
                                    <div class="staff-revenue" style="font-size: 0.9rem; color: #666;">¥145,000</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div class="page" id="settings">
            <header class="header">
                <h1 class="page-title">設定</h1>
            </header>
            <div class="content-area">
                <div class="settings-container">
                    <div class="settings-nav">
                        <div class="settings-nav-item active" data-tab="general">
                            <i>🏪</i>
                            <span>基本設定</span>
                        </div>
                        <div class="settings-nav-item" data-tab="services">
                            <i>✂️</i>
                            <span>サービス管理</span>
                        </div>
                        <div class="settings-nav-item" data-tab="staff">
                            <i>👨‍💼</i>
                            <span>スタッフ管理</span>
                        </div>
                        <div class="settings-nav-item" data-tab="business-hours">
                            <i>🕒</i>
                            <span>営業時間設定</span>
                        </div>
                        <div class="settings-nav-item" data-tab="channels">
                            <i>💬</i>
                            <span>メッセージ設定</span>
                        </div>
                        <div class="settings-nav-item" data-tab="notifications">
                            <i>🔔</i>
                            <span>通知設定</span>
                        </div>
                        <div class="settings-nav-item" data-tab="integrations">
                            <i>🔗</i>
                            <span>外部連携</span>
                        </div>
                        <div class="settings-nav-item" data-tab="security">
                            <i>🔒</i>
                            <span>セキュリティ</span>
                        </div>
                    </div>
                    
                    <div class="settings-content">
                        <!-- General Settings Tab -->
                        <div class="settings-tab active" id="general-tab">
                            <div class="settings-section">
                                <h3>基本設定</h3>
                                <p>サロンの基本情報と営業設定を管理します。</p>
                                <div class="form-group">
                                    <label>サロン名</label>
                                    <input type="text" class="form-control" value="Salon Lumière" placeholder="サロン名を入力">
                                </div>
                                <div class="form-group">
                                    <label>電話番号</label>
                                    <input type="tel" class="form-control" value="03-1234-5678" placeholder="電話番号を入力">
                                </div>
                                <div class="form-group">
                                    <label>住所</label>
                                    <input type="text" class="form-control" value="東京都渋谷区表参道1-2-3" placeholder="住所を入力">
                                </div>
                                <div class="form-group">
                                    <label>営業日</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" checked> 月曜日</label>
                                        <label><input type="checkbox" checked> 火曜日</label>
                                        <label><input type="checkbox" checked> 水曜日</label>
                                        <label><input type="checkbox" checked> 木曜日</label>
                                        <label><input type="checkbox" checked> 金曜日</label>
                                        <label><input type="checkbox" checked> 土曜日</label>
                                        <label><input type="checkbox"> 日曜日</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Services Settings Tab -->
                        <div class="settings-tab" id="services-tab">
                            <div class="settings-section">
                                <h3>サービス管理</h3>
                                <p>提供するサービス・メニューの設定を管理します。</p>
                                <div class="service-management">
                                    <button class="btn btn-primary" onclick="showCreateServiceModal()">➕ 新規サービス追加</button>
                                    <div class="services-list">
                                        <!-- Services configuration will be loaded here -->
                                        <div class="service-item">
                                            <div class="service-info">
                                                <h4>カット</h4>
                                                <p>60分 / ¥4,500</p>
                                            </div>
                                            <div class="service-actions">
                                                <button class="btn-edit">編集</button>
                                                <button class="btn-delete">削除</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Staff Settings Tab -->
                        <div class="settings-tab" id="staff-tab">
                            <div class="settings-section">
                                <h3>スタッフ管理</h3>
                                <p>スタッフの登録・管理とスケジュール設定を行います。</p>
                                <div class="staff-management">
                                    <button class="btn btn-primary" onclick="showCreateStaffModal()">➕ 新規スタッフ追加</button>
                                    <div class="staff-list">
                                        <!-- Staff configuration will be loaded here -->
                                        <div class="staff-item">
                                            <div class="staff-info">
                                                <h4>田中 美穂</h4>
                                                <p>シニアスタッフ</p>
                                            </div>
                                            <div class="staff-actions">
                                                <button class="btn-edit">編集</button>
                                                <button class="btn-schedule">スケジュール</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Business Hours Tab -->
                        <div class="settings-tab" id="business-hours-tab">
                            <div class="settings-section">
                                <h3>営業時間設定</h3>
                                <p>曜日別の営業時間と休憩時間を設定します。</p>
                                <div class="business-hours">
                                    <div class="hours-item">
                                        <div class="day-label">月曜日</div>
                                        <div class="time-settings">
                                            <label>開始時間: <input type="time" value="09:00" class="form-control"></label>
                                            <label>終了時間: <input type="time" value="19:00" class="form-control"></label>
                                            <label><input type="checkbox"> 定休日</label>
                                        </div>
                                    </div>
                                    <div class="hours-item">
                                        <div class="day-label">火曜日</div>
                                        <div class="time-settings">
                                            <label>開始時間: <input type="time" value="09:00" class="form-control"></label>
                                            <label>終了時間: <input type="time" value="19:00" class="form-control"></label>
                                            <label><input type="checkbox"> 定休日</label>
                                        </div>
                                    </div>
                                    <!-- Additional days would follow the same pattern -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Channel Settings Tab -->
                        <div class="settings-tab" id="channels-tab">
                            <div class="settings-section">
                                <h3>メッセージ設定</h3>
                                <p>SMS、メール、LINE、Instagramの設定を管理します。</p>
                                <div id="channel-config-container" class="channel-config-container">
                                    <div class="channel-item">
                                        <h4>📱 SMS設定</h4>
                                        <div class="form-group">
                                            <label>送信者名</label>
                                            <input type="text" class="form-control" value="Salon Lumière" placeholder="送信者名を入力">
                                        </div>
                                        <div class="form-group">
                                            <label><input type="checkbox" checked> SMS機能を有効にする</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Notifications Tab -->
                        <div class="settings-tab" id="notifications-tab">
                            <div class="settings-section">
                                <h3>通知設定</h3>
                                <p>自動リマインダーやシステム通知の設定を管理します。</p>
                                <div class="notification-settings">
                                    <div class="notification-item">
                                        <h4>予約リマインダー</h4>
                                        <label><input type="checkbox" checked> 予約前日にリマインダーを送信</label>
                                        <label><input type="checkbox" checked> 予約当日にリマインダーを送信</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Integrations Tab -->
                        <div class="settings-tab" id="integrations-tab">
                            <div class="settings-section">
                                <h3>外部サービス連携</h3>
                                <p>ホットペッパービューティーやその他の外部サービスとの連携を設定します。</p>
                                <div id="integrations-config-container" class="integrations-config-container">
                                    <div class="integration-item">
                                        <h4>🔗 ホットペッパービューティー</h4>
                                        <p>予約情報を自動同期します</p>
                                        <button class="btn btn-secondary">連携設定</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Security Tab -->
                        <div class="settings-tab" id="security-tab">
                            <div class="settings-section">
                                <h3>セキュリティ設定</h3>
                                <p>アクセス権限とセキュリティ関連の設定を管理します。</p>
                                <div class="security-settings">
                                    <div class="form-group">
                                        <label>パスワード変更</label>
                                        <input type="password" class="form-control" placeholder="現在のパスワード">
                                        <input type="password" class="form-control" placeholder="新しいパスワード">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customers Page -->
        <div class="page" id="customers">
            <header class="header">
                <h1 class="page-title">👥 顧客管理</h1>
                <div class="header-actions">
                    <!-- 表示切り替えボタン -->
                    <div class="view-toggle-buttons" style="display: flex; gap: 0.5rem; margin-right: 1rem;">
                        <button class="btn btn-secondary active" id="cardViewBtn" onclick="switchCustomerView('card')" style="
                            display: flex;
                            align-items: center;
                            gap: 0.5rem;
                            padding: 0.5rem 1rem;
                            border-radius: 8px;
                            border: 2px solid #d4a574;
                            background: #d4a574;
                            color: white;
                            font-weight: 500;
                            cursor: pointer;
                            transition: all 0.2s;
                        ">
                            <span>🔲</span>
                            カード表示
                        </button>
                        <button class="btn btn-secondary" id="listViewBtn" onclick="switchCustomerView('list')" style="
                            display: flex;
                            align-items: center;
                            gap: 0.5rem;
                            padding: 0.5rem 1rem;
                            border-radius: 8px;
                            border: 2px solid #d4a574;
                            background: transparent;
                            color: #d4a574;
                            font-weight: 500;
                            cursor: pointer;
                            transition: all 0.2s;
                        ">
                            <span>📋</span>
                            リスト表示
                        </button>
                    </div>
                    <button class="btn btn-primary" id="newCustomerBtn" onclick="showCreateCustomerModal()">
                        <i class="fas fa-plus"></i>
                        新規顧客登録
                    </button>
                </div>
            </header>
            
            <div class="search-controls">
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="顧客名、電話番号、メールアドレスで検索..." id="customerSearch">
                    <button class="btn btn-secondary" id="searchCustomers">
                        <i class="fas fa-search"></i>
                        検索
                    </button>
                </div>
            </div>

            <div class="customers-container" id="customersContainer">
                <div class="content-area">
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;">
                        <!-- Customer Card 1 -->
                        <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color); transition: transform 0.2s;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="width: 60px; height: 60px; background: var(--gradient-2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">山</div>
                                <div style="flex: 1;">
                                    <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">山田 花子 様</h3>
                                    <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">📱 090-1234-5678</p>
                                </div>
                                <div style="color: #10b981; background: #ecfdf5; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">VIP</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem; font-size: 0.9rem;">
                                <div><strong>📧 メール:</strong> yamada@email.com</div>
                                <div><strong>💅 最終来店:</strong> 2024/03/10</div>
                                <div><strong>🎨 前回施術:</strong> カット+カラー</div>
                                <div><strong>💰 累計金額:</strong> ¥128,000</div>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 4px;">来店回数</div>
                                <div style="background: var(--gray-200); height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div style="background: var(--primary); height: 100%; width: 85%; border-radius: 3px;"></div>
                                </div>
                                <div style="font-size: 0.8rem; color: var(--text-light); margin-top: 2px;">23回</div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">📞 連絡</button>
                                <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">📝 詳細</button>
                            </div>
                        </div>
                        
                        <!-- Customer Card 2 -->
                        <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color); transition: transform 0.2s;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="width: 60px; height: 60px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">佐</div>
                                <div style="flex: 1;">
                                    <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">佐藤 美咲 様</h3>
                                    <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">📱 080-9876-5432</p>
                                </div>
                                <div style="color: #3b82f6; background: #dbeafe; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">常連</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem; font-size: 0.9rem;">
                                <div><strong>📧 メール:</strong> sato@email.com</div>
                                <div><strong>💅 最終来店:</strong> 2024/03/08</div>
                                <div><strong>🌊 前回施術:</strong> パーマ+トリートメント</div>
                                <div><strong>💰 累計金額:</strong> ¥89,500</div>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 4px;">来店回数</div>
                                <div style="background: var(--gray-200); height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div style="background: var(--primary); height: 100%; width: 65%; border-radius: 3px;"></div>
                                </div>
                                <div style="font-size: 0.8rem; color: var(--text-light); margin-top: 2px;">16回</div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">📞 連絡</button>
                                <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">📝 詳細</button>
                            </div>
                        </div>
                        
                        <!-- Customer Card 3 -->
                        <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color); transition: transform 0.2s;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="width: 60px; height: 60px; background: var(--secondary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">鈴</div>
                                <div style="flex: 1;">
                                    <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">鈴木 真由美 様</h3>
                                    <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">📱 070-1111-2222</p>
                                </div>
                                <div style="color: #f59e0b; background: #fef3c7; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">新規</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem; font-size: 0.9rem;">
                                <div><strong>📧 メール:</strong> suzuki@email.com</div>
                                <div><strong>💅 最終来店:</strong> 2024/03/05</div>
                                <div><strong>💆 前回施術:</strong> ヘッドスパ+トリートメント</div>
                                <div><strong>💰 累計金額:</strong> ¥23,000</div>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 4px;">来店回数</div>
                                <div style="background: var(--gray-200); height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div style="background: var(--primary); height: 100%; width: 25%; border-radius: 3px;"></div>
                                </div>
                                <div style="font-size: 0.8rem; color: var(--text-light); margin-top: 2px;">3回</div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">📞 連絡</button>
                                <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">📝 詳細</button>
                            </div>
                        </div>
                        
                        <!-- Customer Card 4 -->
                        <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color); transition: transform 0.2s;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">田</div>
                                <div style="flex: 1;">
                                    <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">田中 麻衣 様</h3>
                                    <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">📱 080-7777-8888</p>
                                </div>
                                <div style="color: #10b981; background: #ecfdf5; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">常連</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem; font-size: 0.9rem;">
                                <div><strong>📧 メール:</strong> mai@email.com</div>
                                <div><strong>💅 最終来店:</strong> 2024/03/12</div>
                                <div><strong>✂️ 前回施術:</strong> カット</div>
                                <div><strong>💰 累計金額:</strong> ¥67,500</div>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 4px;">来店回数</div>
                                <div style="background: var(--gray-200); height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div style="background: var(--primary); height: 100%; width: 45%; border-radius: 3px;"></div>
                                </div>
                                <div style="font-size: 0.8rem; color: var(--text-light); margin-top: 2px;">12回</div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">📞 連絡</button>
                                <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">📝 詳細</button>
                            </div>
                        </div>
                        
                        <!-- Customer Card 5 -->
                        <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color); transition: transform 0.2s;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">高</div>
                                <div style="flex: 1;">
                                    <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">高橋 由紀 様</h3>
                                    <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">📱 090-3333-4444</p>
                                </div>
                                <div style="color: #3b82f6; background: #dbeafe; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">VIP</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem; font-size: 0.9rem;">
                                <div><strong>📧 メール:</strong> yuki@email.com</div>
                                <div><strong>💅 最終来店:</strong> 2024/03/14</div>
                                <div><strong>🎨 前回施術:</strong> カット+カラー+パーマ</div>
                                <div><strong>💰 累計金額:</strong> ¥195,000</div>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 4px;">来店回数</div>
                                <div style="background: var(--gray-200); height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div style="background: var(--primary); height: 100%; width: 95%; border-radius: 3px;"></div>
                                </div>
                                <div style="font-size: 0.8rem; color: var(--text-light); margin-top: 2px;">31回</div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">📞 連絡</button>
                                <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">📝 詳細</button>
                            </div>
                        </div>
                        
                        <!-- Customer Card 6 -->
                        <div style="background: var(--white); border-radius: 16px; box-shadow: var(--shadow-md); padding: 1.5rem; border: 1px solid var(--border-color); transition: transform 0.2s;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">中</div>
                                <div style="flex: 1;">
                                    <h3 style="margin: 0 0 0.25rem 0; color: var(--text-dark); font-size: 1.1rem;">中村 恵美 様</h3>
                                    <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">📱 070-9999-0000</p>
                                </div>
                                <div style="color: #f59e0b; background: #fef3c7; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">休眠</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem; font-size: 0.9rem;">
                                <div><strong>📧 メール:</strong> emi@email.com</div>
                                <div><strong>💅 最終来店:</strong> 2023/12/20</div>
                                <div><strong>✨ 前回施術:</strong> トリートメント</div>
                                <div><strong>💰 累計金額:</strong> ¥45,000</div>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 4px;">来店回数</div>
                                <div style="background: var(--gray-200); height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div style="background: var(--primary); height: 100%; width: 35%; border-radius: 3px;"></div>
                                </div>
                                <div style="font-size: 0.8rem; color: var(--text-light); margin-top: 2px;">8回</div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-secondary" style="flex: 1; font-size: 0.9rem;">📞 連絡</button>
                                <button class="btn btn-primary" style="flex: 1; font-size: 0.9rem;">📝 詳細</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- モバイル底部ナビゲーション -->
    <nav class="mobile-bottom-nav" role="navigation" aria-label="メインナビゲーション">
        <div class="mobile-nav-items">
            <a href="/dashboard.html" class="mobile-nav-item active" aria-current="page">
                <div class="mobile-nav-icon">🏠</div>
                <div class="mobile-nav-label">ホーム</div>
            </a>
            <a href="/appointments.html" class="mobile-nav-item">
                <div class="mobile-nav-icon">📅</div>
                <div class="mobile-nav-label">予約</div>
            </a>
            <a href="/customers.html" class="mobile-nav-item">
                <div class="mobile-nav-icon">👥</div>
                <div class="mobile-nav-label">顧客</div>
            </a>
            <a href="/messages.html" class="mobile-nav-item">
                <div class="mobile-nav-icon">💬</div>
                <div class="mobile-nav-label">連絡</div>
            </a>
            <a href="/settings.html" class="mobile-nav-item">
                <div class="mobile-nav-icon">⚙️</div>
                <div class="mobile-nav-label">設定</div>
            </a>
        </div>
    </nav>

    <!-- Include app-new.js for authentication and API handling -->
    <script src="/js/calendar.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/app-new.js"></script>
    <script src="/js/settings.js"></script>
    
    <script>
        // デバッグ用：関数が利用可能かテスト
        window.testCustomerFunctions = function() {
            console.log('switchCustomerView function:', typeof window.switchCustomerView);
            console.log('renderCustomers function:', typeof window.renderCustomers);
            console.log('loadCustomers function:', typeof window.loadCustomers);
            console.log('customersData:', window.customersData);
        };

        // Dashboard Message Page Functionality
        let selectedCustomerDashboard = null;
        let selectedTemplateDashboard = null;
        
        // Quick Action Functions for Dashboard
        window.selectQuickAction = function(type) {
            // Auto-select template based on quick action
            selectedTemplateDashboard = type;
            showStepDashboard('template');
            // Highlight the corresponding template
            setTimeout(() => {
                const templateCard = document.querySelector(`[onclick="selectTemplateDashboard('${type}')"]`);
                if (templateCard) {
                    templateCard.click();
                }
            }, 100);
        };
        
        // Customer Selection for Dashboard
        window.selectCustomerDashboard = function(customerId) {
            selectedCustomerDashboard = customerId;
            
            // Remove previous selection
            document.querySelectorAll('[onclick*="selectCustomerDashboard"]').forEach(card => {
                card.style.border = '2px solid var(--border-color)';
                card.style.background = 'var(--white)';
            });
            
            // Highlight selected customer
            const selectedCard = document.querySelector(`[onclick="selectCustomerDashboard('${customerId}')"]`);
            if (selectedCard) {
                selectedCard.style.border = '2px solid var(--primary)';
                selectedCard.style.background = 'var(--primary-50)';
            }
            
            // Enable next button
            const nextBtn = document.getElementById('nextToTemplateDashboard');
            if (nextBtn) nextBtn.disabled = false;
            
            // Update preview
            updateSelectedCustomerDisplayDashboard();
        };
        
        // Template Selection for Dashboard
        window.selectTemplateDashboard = function(templateType) {
            selectedTemplateDashboard = templateType;
            
            // Remove previous selection
            document.querySelectorAll('[onclick*="selectTemplateDashboard"]').forEach(card => {
                card.style.border = '2px solid var(--border-color)';
                card.style.background = 'var(--white)';
            });
            
            // Highlight selected template
            const selectedCard = document.querySelector(`[onclick="selectTemplateDashboard('${templateType}')"]`);
            if (selectedCard) {
                selectedCard.style.border = '2px solid var(--primary)';
                selectedCard.style.background = 'var(--primary-50)';
            }
            
            // Enable next button
            const nextBtn = document.getElementById('nextToComposeDashboard');
            if (nextBtn) nextBtn.disabled = false;
            
            // Load template content
            loadTemplateContentDashboard(templateType);
        };
        
        // Step Navigation for Dashboard
        function showStepDashboard(stepName) {
            // Hide all steps in dashboard
            const steps = ['step-customer-dashboard', 'step-template-dashboard', 'step-compose-dashboard'];
            steps.forEach(stepId => {
                const element = document.getElementById(stepId);
                if (element) element.style.display = 'none';
            });
            
            // Show selected step
            const targetStep = document.getElementById(`step-${stepName}-dashboard`);
            if (targetStep) targetStep.style.display = 'block';
        }
        
        window.goBackToCustomerDashboard = function() {
            showStepDashboard('customer');
        };
        
        window.goBackToTemplateDashboard = function() {
            showStepDashboard('template');
        };
        
        // Template Content Loading for Dashboard
        function loadTemplateContentDashboard(templateType) {
            const templates = {
                'reminder': '{customer_name}様、明日{date} {time}からのご予約を確認いたします。カット+カラーでお待ちしております。変更がございましたらお気軽にご連絡ください。',
                'thanks': '{customer_name}様、本日はご来店ありがとうございました。{service}の仕上がりはいかがでしょうか？またのお越しをお待ちしております。',
                'followup': '{customer_name}様、先日は{service}をご利用いただきありがとうございました。髪の調子はいかがですか？何かご質問がございましたらお気軽にご連絡ください。'
            };
            
            const content = templates[templateType] || '';
            const messageContent = document.getElementById('messageContentDashboard');
            if (messageContent) {
                messageContent.value = content;
                updatePreviewDashboard();
            }
        }
        
        // Customer Display Update for Dashboard
        function updateSelectedCustomerDisplayDashboard() {
            const customers = {
                '1': { name: '山田 花子 様', phone: '090-1234-5678', service: 'カット+カラー' },
                '2': { name: '佐藤 美咲 様', phone: '080-9876-5432', service: 'パーマ+トリートメント' },
                '3': { name: '鈴木 真由美 様', phone: '070-1111-2222', service: 'ヘッドスパ+トリートメント' }
            };
            
            const customer = customers[selectedCustomerDashboard];
            const displayElement = document.getElementById('selectedCustomerDisplayDashboard');
            if (customer && displayElement) {
                displayElement.innerHTML = `
                    <div>${customer.name}</div>
                    <div style="opacity: 0.8;">${customer.phone}</div>
                `;
            }
        }
        
        // Preview Update for Dashboard
        function updatePreviewDashboard() {
            const messageContent = document.getElementById('messageContentDashboard');
            const charCount = document.getElementById('charCountDashboard');
            const previewContent = document.getElementById('previewContentDashboard');
            
            if (!messageContent) return;
            
            const content = messageContent.value;
            const charLength = content.length;
            
            // Update character count
            if (charCount) {
                charCount.textContent = `${charLength}/160文字`;
            }
            
            // Update preview content
            let preview = content || 'メッセージを入力するとプレビューが表示されます';
            
            // Replace placeholders with sample data
            if (selectedCustomerDashboard) {
                const customers = {
                    '1': { name: '山田 花子', service: 'カット+カラー' },
                    '2': { name: '佐藤 美咲', service: 'パーマ+トリートメント' },
                    '3': { name: '鈴木 真由美', service: 'ヘッドスパ+トリートメント' }
                };
                const customer = customers[selectedCustomerDashboard];
                preview = preview
                    .replace(/{customer_name}/g, customer.name)
                    .replace(/{service}/g, customer.service)
                    .replace(/{date}/g, '3月16日')
                    .replace(/{time}/g, '10:00');
            }
            
            if (previewContent) {
                previewContent.textContent = preview;
            }
        }
        
        // Initialize Dashboard Message functionality when messages page is shown
        function initializeDashboardMessages() {
            // Next buttons
            const nextToTemplate = document.getElementById('nextToTemplateDashboard');
            if (nextToTemplate) {
                nextToTemplate.addEventListener('click', function() {
                    showStepDashboard('template');
                });
            }
            
            const nextToCompose = document.getElementById('nextToComposeDashboard');
            if (nextToCompose) {
                nextToCompose.addEventListener('click', function() {
                    showStepDashboard('compose');
                    updateSelectedCustomerDisplayDashboard();
                });
            }
            
            // Message content change
            const messageContent = document.getElementById('messageContentDashboard');
            if (messageContent) {
                messageContent.addEventListener('input', updatePreviewDashboard);
            }
            
            // Schedule timing
            const timingRadios = document.querySelectorAll('input[name="sendTimingDashboard"]');
            timingRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const scheduleInput = document.getElementById('scheduleInputDashboard');
                    if (scheduleInput) {
                        if (this.value === 'schedule') {
                            scheduleInput.style.display = 'block';
                        } else {
                            scheduleInput.style.display = 'none';
                        }
                    }
                });
            });
            
            // Customer search
            const customerSearch = document.getElementById('customerSearchDashboard');
            if (customerSearch) {
                customerSearch.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    document.querySelectorAll('[onclick*="selectCustomerDashboard"] .customer-card').forEach(card => {
                        const text = card.textContent.toLowerCase();
                        if (text.includes(searchTerm)) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = searchTerm ? 'none' : 'block';
                        }
                    });
                });
            }
            
            // Hover effects for cards
            document.querySelectorAll('[onclick*="selectQuickAction"], [onclick*="selectCustomerDashboard"], [onclick*="selectTemplateDashboard"]').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                    this.style.boxShadow = 'var(--shadow-lg)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'var(--shadow-sm)';
                });
            });
        }
        
        // Initialize when messages page becomes active
        document.addEventListener('DOMContentLoaded', function() {
            // Observer for when messages page is shown
            const messagesPage = document.getElementById('messages');
            if (messagesPage) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                            if (messagesPage.classList.contains('active')) {
                                setTimeout(initializeDashboardMessages, 100);
                            }
                        }
                    });
                });
                
                observer.observe(messagesPage, {
                    attributes: true,
                    attributeFilter: ['class']
                });
                
                // Initialize immediately if already active
                if (messagesPage.classList.contains('active')) {
                    initializeDashboardMessages();
                }
            }
        });
        
        // 右上ボタンの機能実装
        window.openSearch = function() {
            window.location.href = '/customers.html?search=true';
        };
        
        window.openNotifications = function() {
            alert('📢 新着通知\n\n• 山田様から予約変更の連絡\n• 明日の予約リマインダー送信完了\n• 今月の売上目標達成！');
        };
        
        window.openNewBooking = function() {
            window.location.href = '/appointments.html?new=true';
        };
        
        // ダッシュボード機能
        window.showTodayAppointments = function() {
            window.location.href = '/appointments.html?filter=today';
        };
        
        window.viewAppointmentDetail = function(appointmentId) {
            // 予約詳細情報を表示（本番仕様）
            const appointments = {
                'apt-001': { customer: '山田花子様', time: '10:00-11:30', service: 'カット+カラー+トリートメント', staff: '田中', phone: '090-1234-5678', price: 12000, notes: '前回と同じカラーリング希望' },
                'apt-002': { customer: '佐藤美咲様', time: '13:00-14:00', service: 'カット+パーマ', staff: '佐藤', phone: '080-9876-5432', price: 15000, notes: 'デジタルパーマ、ゆるめのカール' },
                'apt-003': { customer: '鈴木真由美様', time: '15:00-17:00', service: 'フルコース', staff: '山田', phone: '070-1111-2222', price: 18000, notes: 'リラックスコース、ヘッドスパ重点' },
                'apt-101': { customer: '中村恵美様', time: '9:30-10:15', service: 'ヘッドスパ', staff: '田中', phone: '070-9999-0000', price: 6000, notes: '頭皮の乾燥が気になる' },
                'apt-102': { customer: '伊藤真理様', time: '11:00-12:30', service: 'カット+カラー', staff: '佐藤', phone: '090-2222-2222', price: 10000, notes: '明るめのブラウン希望' },
                'apt-103': { customer: '新規様', time: '14:00-15:00', service: 'カット', staff: '山田', phone: '080-1111-1111', price: 4500, notes: '初回来店、カウンセリング重要' }
            };
            
            const apt = appointments[appointmentId];
            if (apt) {
                alert(`📅 予約詳細情報\n\n` +
                      `お客様: ${apt.customer}\n` +
                      `時間: ${apt.time}\n` +
                      `サービス: ${apt.service}\n` +
                      `担当: ${apt.staff}スタッフ\n` +
                      `料金: ¥${apt.price.toLocaleString()}\n` +
                      `備考: ${apt.notes}\n` +
                      `電話: ${apt.phone}`);
            }
        };
        
        window.viewCustomerDetail = function(customerId) {
            // 顧客詳細情報とカルテを表示
            const customers = {
                '1': { name: '山田花子', phone: '090-1234-5678', email: 'yamada@email.com', lastVisit: '2024-03-14', totalSpent: 128000, visitCount: 23 },
                '2': { name: '佐藤美咲', phone: '080-9876-5432', email: 'sato@email.com', lastVisit: '2024-03-13', totalSpent: 89500, visitCount: 16 },
                '3': { name: '鈴木真由美', phone: '070-1111-2222', email: 'suzuki@email.com', lastVisit: '2024-03-12', totalSpent: 23000, visitCount: 3 },
                '4': { name: '中村恵美', phone: '070-9999-0000', email: 'emi@email.com', lastVisit: '2024-03-05', totalSpent: 45000, visitCount: 8 },
                '5': { name: '伊藤真理', phone: '090-2222-2222', email: 'ito@email.com', lastVisit: '2024-03-11', totalSpent: 67000, visitCount: 12 },
                '6': { name: '新規様', phone: '080-1111-1111', email: 'new@email.com', lastVisit: '初回', totalSpent: 0, visitCount: 0 }
            };
            
            const customer = customers[customerId];
            if (customer) {
                const message = `👤 ${customer.name} 様の詳細情報\n\n` +
                      `📱 電話: ${customer.phone}\n` +
                      `📧 メール: ${customer.email}\n` +
                      `📅 最終来店: ${customer.lastVisit}\n` +
                      `💰 累計金額: ¥${customer.totalSpent.toLocaleString()}\n` +
                      `🔄 来店回数: ${customer.visitCount}回\n\n` +
                      `詳細なカルテを確認しますか？`;
                
                if (confirm(message)) {
                    // カルテ表示
                    showCustomerMedicalRecord(customerId);
                }
            }
        };
        
        window.showCustomerMedicalRecord = function(customerId) {
            const medicalRecords = {
                '1': { allergies: 'ジアミン系カラー剤アレルギー', notes: '敏感肌、パッチテスト必須', treatments: '前回: カット+カラー+トリートメント (3/14)' },
                '2': { allergies: 'なし', notes: '髪質細め、カール持ちが良い', treatments: '前回: パーマ+トリートメント (3/13)' },
                '3': { allergies: 'なし', notes: '新規顧客、要丁寧対応', treatments: '前回: ヘッドスパ+トリートメント (3/12)' }
            };
            
            const record = medicalRecords[customerId] || { allergies: '記録なし', notes: '新規顧客', treatments: '施術履歴なし' };
            
            alert(`📋 カルテ情報\n\n` +
                  `⚠️ アレルギー: ${record.allergies}\n` +
                  `📝 注意事項: ${record.notes}\n` +
                  `💉 施術履歴: ${record.treatments}`);
        };
        
        window.viewMessage = function(messageId) {
            // メッセージの詳細とやりとり履歴を表示
            const messages = {
                'msg-001': { customer: '田中さくら', channel: 'LINE', history: ['こんにちは', '明日の予約時間を30分遅らせていただけますか？', 'ありがとうございます'] },
                'msg-002': { customer: '高橋恵子', channel: 'SMS', history: ['お疲れ様です', '来週の予約をお願いしたいです'] },
                'msg-003': { customer: '吉田美穂', channel: 'Instagram', history: ['施術ありがとうございました', 'カラーの色が思ったより暗くて...', 'また相談させてください'] }
            };
            
            const msg = messages[messageId];
            if (msg) {
                const historyText = msg.history.map((text, index) => `${index + 1}. ${text}`).join('\n');
                
                if (confirm(`💬 ${msg.customer}様との${msg.channel}やりとり履歴\n\n${historyText}\n\nメッセージ画面で返信しますか？`)) {
                    window.location.href = `/messages.html?customer=${msg.customer}`;
                }
            }
        };
        
        // 顧客管理の新規顧客ボタン用
        window.showCreateCustomerModal = function() {
            console.log('新規顧客ボタンがクリックされました');
            alert('新規顧客登録機能 - 実装中です');
        };

        // Customer cards hover effects
        function initializeCustomerHoverEffects() {
            const customerCards = document.querySelectorAll('#customers .content-area > div > div');
            customerCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-4px)';
                    this.style.boxShadow = 'var(--shadow-lg)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'var(--shadow-md)';
                });
            });
        }

        // Initialize customer hover effects when customers page is shown
        function initializeCustomersPage() {
            setTimeout(initializeCustomerHoverEffects, 100);
        }

        // Add observer for customers page
        document.addEventListener('DOMContentLoaded', function() {
            const customersPage = document.getElementById('customers');
            if (customersPage) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                            if (customersPage.classList.contains('active')) {
                                initializeCustomersPage();
                            }
                        }
                    });
                });
                
                observer.observe(customersPage, {
                    attributes: true,
                    attributeFilter: ['class']
                });
                
                // Initialize immediately if already active
                if (customersPage.classList.contains('active')) {
                    initializeCustomersPage();
                }
            }
        });
    </script>
    
    <script>
        // Mobile menu toggle with improved accessibility
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        if (mobileMenuToggle && sidebar && sidebarOverlay) {
            // Set up ARIA attributes for accessibility
            mobileMenuToggle.setAttribute('aria-label', 'メニューを開く');
            mobileMenuToggle.setAttribute('aria-expanded', 'false');
            sidebar.setAttribute('role', 'navigation');
            sidebar.setAttribute('aria-label', 'メインナビゲーション');

            function closeSidebar() {
                sidebar.classList.remove('mobile-open');
                sidebarOverlay.classList.remove('active');
                mobileMenuToggle.setAttribute('aria-expanded', 'false');
                mobileMenuToggle.setAttribute('aria-label', 'メニューを開く');
                document.body.style.overflow = '';
            }

            function openSidebar() {
                sidebar.classList.add('mobile-open');
                sidebarOverlay.classList.add('active');
                mobileMenuToggle.setAttribute('aria-expanded', 'true');
                mobileMenuToggle.setAttribute('aria-label', 'メニューを閉じる');
                document.body.style.overflow = 'hidden';
            }

            mobileMenuToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = sidebar.classList.contains('mobile-open');
                
                if (isOpen) {
                    closeSidebar();
                } else {
                    openSidebar();
                }
            });

            // Close sidebar when clicking overlay
            sidebarOverlay.addEventListener('click', closeSidebar);

            // Close sidebar when clicking outside
            document.addEventListener('click', (e) => {
                if (!sidebar.contains(e.target) && !mobileMenuToggle.contains(e.target) && sidebar.classList.contains('mobile-open')) {
                    closeSidebar();
                }
            });

            // Close sidebar on escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && sidebar.classList.contains('mobile-open')) {
                    closeSidebar();
                    mobileMenuToggle.focus(); // Return focus to toggle button
                }
            });
        }

        // Navigation is handled by app-new.js
        // This prevents duplicate event listeners

        // Logout - handled by app-new.js, this is a fallback
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn && !logoutBtn.hasAttribute('data-logout-handler')) {
            logoutBtn.setAttribute('data-logout-handler', 'true');
            logoutBtn.addEventListener('click', () => {
                localStorage.removeItem('salon_token');
                localStorage.removeItem('salon_user');
                sessionStorage.removeItem('salon_token');
                sessionStorage.removeItem('salon_user');
                window.location.href = '/login.html';
            });
        }

        // Authentication is fully handled by app-new.js
        // Removing fallback to prevent conflicts and race conditions

        // Add hover effect to cards
        document.querySelectorAll('.stat-card, .appointment-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-4px)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
    </script>
    
</body>
</html>